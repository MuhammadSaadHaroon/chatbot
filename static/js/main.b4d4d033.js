/*! For license information please see main.b4d4d033.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{n(288)},288:(e,t)=>{var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),p=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function y(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||g}function w(){}function _(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||g}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=y.prototype;var b=_.prototype=new w;b.constructor=_,m(b,y.prototype),b.isPureReactComponent=!0;var E=Array.isArray;function I(){}var S={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function A(e,t,r){var s=r.ref;return{$$typeof:n,type:e,key:t,ref:void 0!==s?s:null,props:r}}function k(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function O(e,t,s,i,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c,l,u=!1;if(null===e)u=!0;else switch(a){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case d:return O((u=e._init)(e._payload),t,s,i,o)}}if(u)return o=o(e),u=""===i?"."+R(e,0):i,E(o)?(s="",null!=u&&(s=u.replace(C,"$&/")+"/"),O(o,t,s,"",function(e){return e})):null!=o&&(k(o)&&(c=o,l=s+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+u,o=A(c.type,l,c.props)),t.push(o)),1;u=0;var h,f=""===i?".":i+":";if(E(e))for(var g=0;g<e.length;g++)u+=O(i=e[g],t,s,a=f+R(i,g),o);else if("function"===typeof(g=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=p&&h[p]||h["@@iterator"])?h:null))for(e=g.call(e),g=0;!(i=e.next()).done;)u+=O(i=i.value,t,s,a=f+R(i,g++),o);else if("object"===a){if("function"===typeof e.then)return O(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(I,I):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,s,i,o);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function N(e,t,n){if(null==e)return e;var r=[],s=0;return O(e,r,"","",function(e){return t.call(n,e,s++)}),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)}},579:(e,t,n)=>{n(799)},799:(e,t)=>{var n=Symbol.for("react.transitional.element");function r(e,t,r){var s=null;if(void 0!==r&&(s=""+r),void 0!==t.key&&(s=""+t.key),"key"in t)for(var i in r={},t)"key"!==i&&(r[i]=t[i]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:s,ref:void 0!==t?t:null,props:r}}Symbol.for("react.fragment")}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();n(43);function r(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function i(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}function o(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const l=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<e.length;s+=3){const t=e[s],i=s+1<e.length,o=i?e[s+1]:0,a=s+2<e.length,c=a?e[s+2]:0,l=t>>2,u=(3&t)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),r.push(n[l],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(l(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],i=s<e.length?n[e.charAt(s)]:0;++s;const o=s<e.length?n[e.charAt(s)]:64;++s;const a=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==i||null==o||null==a)throw new h;const c=t<<2|i>>4;if(r.push(c),64!==o){const e=i<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const d=function(e){return function(e){const t=l(e);return u.encodeByteArray(t,!0)}(e).replace(/\./g,"")},f=function(e){try{return u.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function p(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}const g=()=>{try{return p().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/chatbot",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&f(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},m=e=>{var t;return null===(t=g())||void 0===t||null===(t=t.emulatorHosts)||void 0===t?void 0:t[e]},v=()=>{var e;return null===(e=g())||void 0===e?void 0:e.config},y=e=>{var t;return null===(t=g())||void 0===t?void 0:t["_".concat(e)]};class w{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function _(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function b(e){return(await fetch(e,{credentials:"include"})).ok}const E={};let I=!1;function S(e,t){if("undefined"===typeof window||"undefined"===typeof document||!_(window.location.host)||E[e]===t||E[e]||I)return;function n(e){return"__firebase__banner__".concat(e)}E[e]=t;const r="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(E))E[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{I=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(r),t=n("text"),o=document.getElementById(t)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),l=n("preprendIcon"),u=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(c,a);const n=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,l),t.append(u,o,c,n),document.body.appendChild(t)}s?(o.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function T(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function A(){var e;const t=null===(e=g())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function k(){return!A()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function C(){try{return"object"===typeof indexedDB}catch(e){return!1}}class R extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,O.prototype.create)}}class O{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],s=r?function(e,t){return e.replace(N,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",i="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new R(n,i,t)}}const N=/\{\$([^}]+)}/g;function P(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(x(n)&&x(i)){if(!P(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function x(e){return null!==e&&"object"===typeof e}function D(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function L(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function M(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class U{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=V),void 0===r.error&&(r.error=V),void 0===r.complete&&(r.complete=V);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function V(){}function j(e){return e&&e._delegate?e._delegate:e}class F{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const B="[DEFAULT]";class q{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new w;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:B})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&i.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===B?void 0:s),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(i){}var s;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;return this.component?this.component.multipleInstances?e:B:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class H{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new q(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const W=[];var K;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(K||(K={}));const z={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},G=K.INFO,X={[K.DEBUG]:"log",[K.VERBOSE]:"log",[K.INFO]:"info",[K.WARN]:"warn",[K.ERROR]:"error"},J=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=X[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var s=arguments.length,i=new Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(e.name,":"),...i)};class Q{constructor(e){this.name=e,this._logLevel=G,this._logHandler=J,this._userLogHandler=null,W.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in K))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?z[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,K.DEBUG,...t),this._logHandler(this,K.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,K.VERBOSE,...t),this._logHandler(this,K.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,K.INFO,...t),this._logHandler(this,K.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,K.WARN,...t),this._logHandler(this,K.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,K.ERROR,...t),this._logHandler(this,K.ERROR,...t)}}let Y,$;const Z=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,re=new WeakMap;let se={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ee.get(e);if("objectStoreNames"===t)return e.objectStoreNames||te.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ae(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ie(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?($||($=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(ce(this),n),ae(Z.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ae(e.apply(ce(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];const i=e.call(ce(this),t,...r);return te.set(i,t.sort?t.sort():[t]),ae(i)}}function oe(e){return"function"===typeof e?ie(e):(e instanceof IDBTransaction&&function(e){if(ee.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});ee.set(e,t)}(e),t=e,(Y||(Y=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,se):e);var t}function ae(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(ae(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&Z.set(t,e)}).catch(()=>{}),re.set(t,e),t}(e);if(ne.has(e))return ne.get(e);const t=oe(e);return t!==e&&(ne.set(e,t),re.set(t,e)),t}const ce=e=>re.get(e);const le=["get","getKey","getAll","getAllKeys","count"],ue=["put","add","delete","clear"],he=new Map;function de(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(he.get(t))return he.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=ue.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!le.includes(n))return;const i=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let i=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return r&&(i=i.index(a.shift())),(await Promise.all([i[n](...a),s&&t.done]))[0]};return he.set(t,i),i}se=(e=>c(c({},e),{},{get:(t,n,r)=>de(t,n)||e.get(t,n,r),has:(t,n)=>!!de(t,n)||e.has(t,n)}))(se);class fe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const pe="@firebase/app",ge="0.14.6",me=new Q("@firebase/app"),ve="@firebase/app-compat",ye="@firebase/analytics-compat",we="@firebase/analytics",_e="@firebase/app-check-compat",be="@firebase/app-check",Ee="@firebase/auth",Ie="@firebase/auth-compat",Se="@firebase/database",Te="@firebase/data-connect",Ae="@firebase/database-compat",ke="@firebase/functions",Ce="@firebase/functions-compat",Re="@firebase/installations",Oe="@firebase/installations-compat",Ne="@firebase/messaging",Pe="@firebase/messaging-compat",xe="@firebase/performance",De="@firebase/performance-compat",Le="@firebase/remote-config",Me="@firebase/remote-config-compat",Ue="@firebase/storage",Ve="@firebase/storage-compat",je="@firebase/firestore",Fe="@firebase/ai",Be="@firebase/firestore-compat",qe="firebase",He="[DEFAULT]",We={[pe]:"fire-core",[ve]:"fire-core-compat",[we]:"fire-analytics",[ye]:"fire-analytics-compat",[be]:"fire-app-check",[_e]:"fire-app-check-compat",[Ee]:"fire-auth",[Ie]:"fire-auth-compat",[Se]:"fire-rtdb",[Te]:"fire-data-connect",[Ae]:"fire-rtdb-compat",[ke]:"fire-fn",[Ce]:"fire-fn-compat",[Re]:"fire-iid",[Oe]:"fire-iid-compat",[Ne]:"fire-fcm",[Pe]:"fire-fcm-compat",[xe]:"fire-perf",[De]:"fire-perf-compat",[Le]:"fire-rc",[Me]:"fire-rc-compat",[Ue]:"fire-gcs",[Ve]:"fire-gcs-compat",[je]:"fire-fst",[Be]:"fire-fst-compat",[Fe]:"fire-vertex","fire-js":"fire-js",[qe]:"fire-js-all"},Ke=new Map,ze=new Map,Ge=new Map;function Xe(e,t){try{e.container.addComponent(t)}catch(n){me.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function Je(e){const t=e.name;if(Ge.has(t))return me.debug("There were multiple attempts to register component ".concat(t,".")),!1;Ge.set(t,e);for(const n of Ke.values())Xe(n,e);for(const n of ze.values())Xe(n,e);return!0}function Qe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Ye(e){return null!==e&&void 0!==e&&void 0!==e.settings}const $e=new O("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Ze{constructor(e,t,n){this._isDeleted=!1,this._options=c({},e),this._config=c({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new F("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $e.create("app-deleted",{appName:this._name})}}const et="12.6.0";function tt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=c({name:He,automaticDataCollectionEnabled:!0},t),s=r.name;if("string"!==typeof s||!s)throw $e.create("bad-app-name",{appName:String(s)});if(n||(n=v()),!n)throw $e.create("no-options");const i=Ke.get(s);if(i){if(P(n,i.options)&&P(r,i.config))return i;throw $e.create("duplicate-app",{appName:s})}const o=new H(s);for(const c of Ge.values())o.addComponent(c);const a=new Ze(n,r,o);return Ke.set(s,a),a}function nt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:He;const t=Ke.get(e);if(!t&&e===He&&v())return tt();if(!t)throw $e.create("no-app",{appName:e});return t}function rt(e,t,n){var r;let s=null!==(r=We[e])&&void 0!==r?r:e;n&&(s+="-".concat(n));const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return i&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),i&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void me.warn(e.join(" "))}Je(new F("".concat(s,"-version"),()=>({library:s,version:t}),"VERSION"))}const st="firebase-heartbeat-store";let it=null;function ot(){return it||(it=function(e,t){let{blocked:n,upgrade:r,blocking:s,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=ae(o);return r&&o.addEventListener("upgradeneeded",e=>{r(ae(o.result),e.oldVersion,e.newVersion,ae(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(st)}catch(n){console.warn(n)}}}).catch(e=>{throw $e.create("idb-open",{originalErrorMessage:e.message})})),it}async function at(e,t){try{const n=(await ot()).transaction(st,"readwrite"),r=n.objectStore(st);await r.put(t,ct(e)),await n.done}catch(n){if(n instanceof R)me.warn(n.message);else{const e=$e.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});me.warn(e.message)}}}function ct(e){return"".concat(e.name,"!").concat(e.options.appId)}class lt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ht(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ut();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){me.warn(n)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ut(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),dt(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),dt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=d(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return me.warn(t),""}}}function ut(){return(new Date).toISOString().substring(0,10)}class ht{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!C()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ot()).transaction(st),n=await t.objectStore(st).get(ct(e));return await t.done,n}catch(t){if(t instanceof R)me.warn(t.message);else{const e=$e.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});me.warn(e.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return at(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const n=await this.read();return at(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function dt(e){return d(JSON.stringify({version:2,heartbeats:e})).length}var ft;ft="",Je(new F("platform-logger",e=>new fe(e),"PRIVATE")),Je(new F("heartbeat",e=>new lt(e),"PRIVATE")),rt(pe,ge,ft),rt(pe,ge,"esm2020"),rt("fire-js","");const pt=["providerId"],gt=["uid","auth","stsTokenManager"],mt=["providerId","signInMethod"];function vt(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const yt=vt,wt=new O("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),_t=new Q("@firebase/auth");function bt(e){if(_t.logLevel<=K.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];_t.error("Auth (".concat(et,"): ").concat(e),...n)}}function Et(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw At(e,...n)}function It(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return At(e,...n)}function St(e,t,n){const r=c(c({},yt()),{},{[t]:n});return new O("auth","Firebase",r).create(t,{appName:e.name})}function Tt(e){return St(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function At(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return wt.create(e,...n)}function kt(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];throw At(t,...r)}}function Ct(e){const t="INTERNAL ASSERTION FAILED: "+e;throw bt(t),new Error(t)}function Rt(e,t){e||Ct(t)}function Ot(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Nt(){return"http:"===Pt()||"https:"===Pt()}function Pt(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function xt(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Nt()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Dt{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(T())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return xt()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Lt(e,t){Rt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class Mt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Ct("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Ct("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Ct("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ut={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Vt=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],jt=new Dt(3e4,6e4);function Ft(e,t){return e.tenantId&&!t.tenantId?c(c({},t),{},{tenantId:e.tenantId}):t}async function Bt(e,t,n,r){return qt(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let s={},i={};r&&("GET"===t?i=r:s={body:JSON.stringify(r)});const o=D(c({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const l=c({method:t,headers:a},s);return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&_(e.emulatorConfig.host)&&(l.credentials="include"),Mt.fetch()(await Wt(e,e.config.apiHost,n,o),l)})}async function qt(e,t,n){e._canInitEmulator=!1;const r=c(c({},Ut),t);try{const t=new zt(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw Gt(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Gt(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Gt(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Gt(e,"user-disabled",i);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw St(e,a,o);Et(e,a)}}catch(s){if(s instanceof R)throw s;Et(e,"network-request-failed",{message:String(s)})}}async function Ht(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const i=await Bt(e,t,n,r,s);return"mfaPendingCredential"in i&&Et(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function Wt(e,t,n,r){const s="".concat(t).concat(n,"?").concat(r),i=e,o=i.config.emulator?Lt(e.config,s):"".concat(e.config.apiScheme,"://").concat(s);if(Vt.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())){return i._getPersistence()._getFinalTarget(o).toString()}return o}function Kt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class zt{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(It(this.auth,"network-request-failed")),jt.get())})}}function Gt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=It(e,t,r);return s.customData._tokenResponse=n,s}function Xt(e){return void 0!==e&&void 0!==e.enterprise}class Jt{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Kt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Qt(e,t){return Bt(e,"GET","/v2/recaptchaConfig",Ft(e,t))}async function Yt(e,t){return Bt(e,"POST","/v1/accounts:lookup",t)}function $t(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Zt(e){return 1e3*Number(e)}function en(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return bt("JWT malformed, contained fewer than 3 sections"),null;try{const e=f(n);return e?JSON.parse(e):(bt("Failed to decode base64 JWT payload"),null)}catch(s){return bt("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}function tn(e){const t=en(e);return kt(t,"internal-error"),kt("undefined"!==typeof t.exp,"internal-error"),kt("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function nn(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof R&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class rn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{var t;this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class sn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=$t(this.lastLoginAt),this.creationTime=$t(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function on(e){var t;const n=e.auth,r=await e.getIdToken(),s=await nn(e,Yt(n,{idToken:r}));kt(null===s||void 0===s?void 0:s.users.length,n,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=null!==(t=i.providerUserInfo)&&void 0!==t&&t.length?an(i.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter(e=>!l.some(t=>t.providerId===e.providerId)),...l]);var c,l;const u=e.isAnonymous,h=!(e.email&&i.passwordHash)&&!(null!==a&&void 0!==a&&a.length),d=!!u&&h,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new sn(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function an(e){return e.map(e=>{let{providerId:t}=e,n=r(e,pt);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class cn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){kt(e.idToken,"internal-error"),kt("undefined"!==typeof e.idToken,"internal-error"),kt("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):tn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){kt(0!==e.length,"internal-error");const t=tn(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(kt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await qt(e,{},async()=>{const n=D({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=await Wt(e,r,"/v1/token","key=".concat(s)),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&_(e.emulatorConfig.host)&&(a.credentials="include"),Mt.fetch()(i,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new cn;return n&&(kt("string"===typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(kt("string"===typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(kt("number"===typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new cn,this.toJSON())}_performRefresh(){return Ct("not implemented")}}function ln(e,t){kt("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class un{constructor(e){let{uid:t,auth:n,stsTokenManager:s}=e,i=r(e,gt);this.providerId="firebase",this.proactiveRefresh=new rn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new sn(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await nn(this,this.stsTokenManager.getToken(this.auth,e));return kt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=j(e),r=await n.getIdToken(t),s=en(r);kt(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"===typeof s.firebase?s.firebase:void 0,o=null===i||void 0===i?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:$t(Zt(s.auth_time)),issuedAtTime:$t(Zt(s.iat)),expirationTime:$t(Zt(s.exp)),signInProvider:o||null,signInSecondFactor:(null===i||void 0===i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=j(e);await on(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(kt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>c({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new un(c(c({},this),{},{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){kt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await on(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ye(this.auth.app))return Promise.reject(Tt(this.auth));const e=await this.getIdToken();return await nn(this,async function(e,t){return Bt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return c(c({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>c({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{},{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,s,i,o,a,l,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,f=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,p=null!==(i=t.photoURL)&&void 0!==i?i:void 0,g=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,v=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:_,isAnonymous:b,providerData:E,stsTokenManager:I}=t;kt(w&&I,e,"internal-error");const S=cn.fromJSON(this.name,I);kt("string"===typeof w,e,"internal-error"),ln(h,e.name),ln(d,e.name),kt("boolean"===typeof _,e,"internal-error"),kt("boolean"===typeof b,e,"internal-error"),ln(f,e.name),ln(p,e.name),ln(g,e.name),ln(m,e.name),ln(v,e.name),ln(y,e.name);const T=new un({uid:w,auth:e,email:d,emailVerified:_,displayName:h,isAnonymous:b,photoURL:p,phoneNumber:f,tenantId:g,stsTokenManager:S,createdAt:v,lastLoginAt:y});return E&&Array.isArray(E)&&(T.providerData=E.map(e=>c({},e))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new cn;r.updateFromServerResponse(t);const s=new un({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await on(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];kt(void 0!==r.localId,"internal-error");const s=void 0!==r.providerUserInfo?an(r.providerUserInfo):[],i=!(r.email&&r.passwordHash)&&!(null!==s&&void 0!==s&&s.length),o=new cn;o.updateFromIdToken(n);const a=new un({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:i}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new sn(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null!==s&&void 0!==s&&s.length)};return Object.assign(a,c),a}}const hn=new Map;function dn(e){Rt(e instanceof Function,"Expected a class definition");let t=hn.get(e);return t?(Rt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,hn.set(e,t),t)}class fn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}fn.type="NONE";const pn=fn;function gn(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class mn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=gn(this.userKey,r.apiKey,s),this.fullPersistenceKey=gn("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await Yt(this.auth,{idToken:e}).catch(()=>{});return t?un._fromGetAccountInfoResponse(this.auth,t,e):null}return un._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new mn(dn(pn),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=r[0]||dn(pn);const i=gn(n,e.config.apiKey,e.name);let o=null;for(const l of t)try{const t=await l._get(i);if(t){let n;if("string"===typeof t){const r=await Yt(e,{idToken:t}).catch(()=>{});if(!r)break;n=await un._fromGetAccountInfoResponse(e,r,t)}else n=un._fromJSON(e,t);l!==s&&(o=n),s=l;break}}catch(c){}const a=r.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch(t){}})),new mn(s,e,n)):new mn(s,e,n)}}function vn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(bn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(yn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(In(t))return"Blackberry";if(Sn(t))return"Webos";if(wn(t))return"Safari";if((t.includes("chrome/")||_n(t))&&!t.includes("edge/"))return"Chrome";if(En(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function yn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/firefox\//i.test(e)}function wn(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:T()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/crios\//i.test(e)}function bn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/iemobile/i.test(e)}function En(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/android/i.test(e)}function In(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/blackberry/i.test(e)}function Sn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/webos/i.test(e)}function Tn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function An(){return function(){const e=T();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function kn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T();return Tn(e)||En(e)||Sn(e)||In(e)||/windows phone/i.test(e)||bn(e)}function Cn(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=vn(T());break;case"Worker":t="".concat(vn(T()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(et,"/").concat(r)}class Rn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(s){r(s)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class On{constructor(e){var t,n,r,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,s,i,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsNumericCharacter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Nn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xn(this),this.idTokenSubscription=new xn(this),this.beforeStateQueue=new Rn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=wt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=dn(t)),this._initializationPromise=this.queue(async()=>{var n,r,s;if(!this._deleted&&(this.persistenceManager=await mn.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null!==(r=this._popupRedirectResolver)&&void 0!==r&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Yt(this,{idToken:e}),n=await un._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Ye(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){var s,i;await this.getOrInitRedirectPersistenceManager();const t=null===(s=this.redirectUser)||void 0===s?void 0:s._redirectEventId,o=null===(i=n)||void 0===i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);t&&t!==o||null===a||void 0===a||!a.user||(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(o){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return kt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await on(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ye(this.app))return Promise.reject(Tt(this));const t=e?j(e):null;return t&&kt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&kt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ye(this.app)?Promise.reject(Tt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ye(this.app)?Promise.reject(Tt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(dn(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return Bt(e,"GET","/v2/passwordPolicy",Ft(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new On(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new O("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Bt(e,"POST","/v2/accounts:revokeToken",Ft(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&dn(e)||this._popupRedirectResolver;kt(t,this,"argument-error"),this.redirectPersistenceManager=await mn.create(this,[dn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(kt(o,this,"internal-error"),o.then(()=>{i||s(this.currentUser)}),"function"===typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return kt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Cn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if(Ye(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return null!==t&&void 0!==t&&t.error&&function(e){if(_t.logLevel<=K.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];_t.warn("Auth (".concat(et,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Pn(e){return j(e)}class xn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new U(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return kt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Dn={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ln(e){return Dn.loadJS(e)}function Mn(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Un{constructor(){this.enterprise=new Vn}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Vn{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const jn="NO_RECAPTCHA";class Fn{constructor(e){this.type="recaptcha-enterprise",this.auth=Pn(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const s=window.grecaptcha;Xt(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(jn)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Un).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Qt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Jt(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&Xt(window.grecaptcha))n(s,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Dn.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Ln(t).then(()=>{n(s,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function Bn(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=new Fn(e);let o;if(s)o=jn;else try{o=await i.verify(n)}catch(l){o=await i.verify(n,!0)}const a=c({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function qn(e,t,n,r,s){if("EMAIL_PASSWORD_PROVIDER"===s){var i;if(null!==(i=e._getRecaptchaConfig())&&void 0!==i&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Bn(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch(async s=>{if(s.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const s=await Bn(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)})}if("PHONE_PROVIDER"===s){var o;if(null!==(o=e._getRecaptchaConfig())&&void 0!==o&&o.isProviderEnabled("PHONE_PROVIDER")){const s=await Bn(e,t,n);return r(e,s).catch(async s=>{var i;if("AUDIT"===(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.getProviderEnforcementState("PHONE_PROVIDER"))&&(s.code==="auth/".concat("missing-recaptcha-token")||s.code==="auth/".concat("invalid-app-credential"))){console.log("Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ".concat(n," flow."));const s=await Bn(e,t,n,!1,!0);return r(e,s)}return Promise.reject(s)})}{const s=await Bn(e,t,n,!1,!0);return r(e,s)}}return Promise.reject(s+" provider is not supported.")}async function Hn(e){const t=Pn(e),n=await Qt(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new Jt(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new Fn(t).verify()}}function Wn(e,t,n){const r=Pn(e);kt(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!(null===n||void 0===n||!n.disableWarnings),i=Kn(t),{host:o,port:a}=function(e){const t=Kn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:zn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:zn(t)}}}(t),c=null===a?"":":".concat(a),l={url:"".concat(i,"//").concat(o).concat(c,"/")},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator)return kt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void kt(P(l,r.config.emulator)&&P(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=l,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,_(o)?(b("".concat(i,"//").concat(o).concat(c)),S("Auth",!0)):s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Kn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function zn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Gn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ct("not implemented")}_getIdTokenResponse(e){return Ct("not implemented")}_linkToIdToken(e,t){return Ct("not implemented")}_getReauthenticationResolver(e){return Ct("not implemented")}}async function Xn(e,t){return Bt(e,"POST","/v1/accounts:signUp",t)}async function Jn(e,t){return Ht(e,"POST","/v1/accounts:signInWithPassword",Ft(e,t))}class Qn extends Gn{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Qn(e,t,"password")}static _fromEmailAndCode(e,t){return new Qn(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if(null!==t&&void 0!==t&&t.email&&null!==t&&void 0!==t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return qn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Jn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Ht(e,"POST","/v1/accounts:signInWithEmailLink",Ft(e,t))}(e,{email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return qn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Xn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return Ht(e,"POST","/v1/accounts:signInWithEmailLink",Ft(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Yn(e,t){return Ht(e,"POST","/v1/accounts:signInWithIdp",Ft(e,t))}class $n extends Gn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new $n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Et("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s}=t,i=r(t,mt);if(!n||!s)return null;const o=new $n(n,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return Yn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Yn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Yn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=D(t)}return e}}async function Zn(e,t){return Bt(e,"POST","/v1/accounts:sendVerificationCode",Ft(e,t))}const er={USER_NOT_FOUND:"user-not-found"};class tr extends Gn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new tr({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new tr({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ht(e,"POST","/v1/accounts:signInWithPhoneNumber",Ft(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Ht(e,"POST","/v1/accounts:signInWithPhoneNumber",Ft(e,t));if(n.temporaryProof)throw Gt(e,"account-exists-with-different-credential",n);return n}(e,c({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ht(e,"POST","/v1/accounts:signInWithPhoneNumber",Ft(e,c(c({},t),{},{operation:"REAUTH"})),er)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new tr({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class nr{constructor(e){var t,n,r,s,i,o;const a=L(M(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);kt(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.lang)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=L(M(e)).link,n=t?L(M(t)).deep_link_id:null,r=L(M(e)).deep_link_id;return(r?L(M(r)).link:null)||r||n||t||e}(e);try{return new nr(t)}catch(n){return null}}}class rr{constructor(){this.providerId=rr.PROVIDER_ID}static credential(e,t){return Qn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=nr.parseLink(t);return kt(n,"argument-error"),Qn._fromEmailAndCode(e,n.code,n.tenantId)}}rr.PROVIDER_ID="password",rr.EMAIL_PASSWORD_SIGN_IN_METHOD="password",rr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class sr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ir extends sr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class or extends ir{constructor(){super("facebook.com")}static credential(e){return $n._fromParams({providerId:or.PROVIDER_ID,signInMethod:or.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return or.credentialFromTaggedObject(e)}static credentialFromError(e){return or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return or.credential(t.oauthAccessToken)}catch(n){return null}}}or.FACEBOOK_SIGN_IN_METHOD="facebook.com",or.PROVIDER_ID="facebook.com";class ar extends ir{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return $n._fromParams({providerId:ar.PROVIDER_ID,signInMethod:ar.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ar.credentialFromTaggedObject(e)}static credentialFromError(e){return ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return ar.credential(n,r)}catch(s){return null}}}ar.GOOGLE_SIGN_IN_METHOD="google.com",ar.PROVIDER_ID="google.com";class cr extends ir{constructor(){super("github.com")}static credential(e){return $n._fromParams({providerId:cr.PROVIDER_ID,signInMethod:cr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cr.credentialFromTaggedObject(e)}static credentialFromError(e){return cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return cr.credential(t.oauthAccessToken)}catch(n){return null}}}cr.GITHUB_SIGN_IN_METHOD="github.com",cr.PROVIDER_ID="github.com";class lr extends ir{constructor(){super("twitter.com")}static credential(e,t){return $n._fromParams({providerId:lr.PROVIDER_ID,signInMethod:lr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return lr.credentialFromTaggedObject(e)}static credentialFromError(e){return lr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return lr.credential(n,r)}catch(s){return null}}}lr.TWITTER_SIGN_IN_METHOD="twitter.com",lr.PROVIDER_ID="twitter.com";class ur{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await un._fromIdTokenResponse(e,n,r),i=hr(n);return new ur({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=hr(n);return new ur({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function hr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class dr extends R{constructor(e,t,n,r){var s;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,dr.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new dr(e,t,n,r)}}function fr(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw dr._fromErrorAndOperation(e,n,t,r);throw n})}async function pr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await nn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ur._forOperation(e,"link",r)}async function gr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(Ye(r.app))return Promise.reject(Tt(r));const s="reauthenticate";try{const i=await nn(e,fr(r,s,t,e),n);kt(i.idToken,r,"internal-error");const o=en(i.idToken);kt(o,r,"internal-error");const{sub:a}=o;return kt(e.uid===a,r,"user-mismatch"),ur._forOperation(e,s,i)}catch(i){throw(null===i||void 0===i?void 0:i.code)==="auth/".concat("user-not-found")&&Et(r,"user-mismatch"),i}}async function mr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ye(e.app))return Promise.reject(Tt(e));const r="signIn",s=await fr(e,r,t),i=await ur._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(i.user),i}function vr(e,t){return Bt(e,"POST","/v2/accounts/mfaEnrollment:start",Ft(e,t))}new WeakMap;const yr="__sak";class wr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yr,"1"),this.storage.removeItem(yr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class _r extends wr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=kn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);An()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}_r.type="LOCAL";const br=_r;function Er(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),s=RegExp("".concat(r,"=([^;]+)"));return null!==(t=null===(n=document.cookie.match(s))||void 0===n?void 0:n[1])&&void 0!==t?t:null}function Ir(e){const t="http:"===window.location.protocol;return"".concat(t?"__dev_":"__HOST-","FIREBASE_").concat(e.split(":")[3])}class Sr{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL("".concat(window.location.origin,"/__cookies__"));return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Ir(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return Er(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=Ir(e);document.cookie="".concat(t,"=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High"),await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const n=Ir(e);if(window.cookieStore){const e=e=>{const r=e.changed.find(e=>e.name===n);r&&t(r.value);e.deleted.find(e=>e.name===n)&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=Er(n);const s=setInterval(()=>{const e=Er(n);e!==r&&(t(e),r=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(s))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Sr.type="COOKIE";class Tr extends wr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Tr.type="SESSION";const Ar=Tr;class kr{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new kr(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(null===i||void 0===i||!i.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Cr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}kr.receivers=[];class Rr{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise((o,a)=>{const c=Cr("",20);r.port1.start();const l=setTimeout(()=>{a(new Error("unsupported_event"))},n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(l),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Or(){return window}function Nr(){return"undefined"!==typeof Or().WorkerGlobalScope&&"function"===typeof Or().importScripts}const Pr="firebaseLocalStorageDb",xr="firebaseLocalStorage",Dr="fbase_key";class Lr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Mr(e,t){return e.transaction([xr],t?"readwrite":"readonly").objectStore(xr)}function Ur(){const e=indexedDB.open(Pr,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(xr,{keyPath:Dr})}catch(r){n(r)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(xr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Pr);return new Lr(e).toPromise()}(),t(await Ur()))})})}async function Vr(e,t,n){const r=Mr(e,!0).put({[Dr]:t,value:n});return new Lr(r).toPromise()}function jr(e,t){const n=Mr(e,!0).delete(t);return new Lr(n).toPromise()}class Fr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ur()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Nr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=kr._getInstance(Nr()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){var e;if(null===(e=navigator)||void 0===e||!e.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new Rr(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=navigator)||void 0===e||null===(e=e.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ur();return await Vr(e,yr,"1"),await jr(e,yr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Vr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Mr(e,!1).get(t),r=await new Lr(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>jr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Mr(e,!1).getAll();return new Lr(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Fr.type="LOCAL";const Br=Fr;function qr(e,t){return Bt(e,"POST","/v2/accounts/mfaSignIn:start",Ft(e,t))}Mn("rcb"),new Dt(3e4,6e4);const Hr="recaptcha";async function Wr(e,t,n){if(!e._getRecaptchaConfig())try{await Hn(e)}catch(s){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){kt("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},i=qn(e,r,"mfaSmsEnrollment",async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===jn){kt((null===n||void 0===n?void 0:n.type)===Hr,e,"argument-error");return vr(e,await Kr(e,t,n))}return vr(e,t)},"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{var r;kt("signin"===t.type,e,"internal-error");const i=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;kt(i,e,"missing-multi-factor-info");const o={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=qn(e,o,"mfaSmsSignIn",async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===jn){kt((null===n||void 0===n?void 0:n.type)===Hr,e,"argument-error");return qr(e,await Kr(e,t,n))}return qr(e,t)},"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=qn(e,t,"sendVerificationCode",async(e,t)=>{if(t.captchaResponse===jn){kt((null===n||void 0===n?void 0:n.type)===Hr,e,"argument-error");return Zn(e,await Kr(e,t,n))}return Zn(e,t)},"PHONE_PROVIDER");return(await r.catch(e=>Promise.reject(e))).sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function Kr(e,t,n){kt(n.type===Hr,e,"argument-error");const r=await n.verify();kt("string"===typeof r,e,"argument-error");const s=c({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:i}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:r}),s}class zr{constructor(e){this.providerId=zr.PROVIDER_ID,this.auth=Pn(e)}verifyPhoneNumber(e,t){return Wr(this.auth,e,j(t))}static credential(e,t){return tr._fromVerification(e,t)}static credentialFromResult(e){const t=e;return zr.credentialFromTaggedObject(t)}static credentialFromError(e){return zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?tr._fromTokenResponse(n,r):null}}function Gr(e,t){return t?dn(t):(kt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}zr.PROVIDER_ID="phone",zr.PHONE_SIGN_IN_METHOD="phone";class Xr extends Gn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Yn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Yn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Yn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Jr(e){return mr(e.auth,new Xr(e),e.bypassAuthState)}function Qr(e){const{auth:t,user:n}=e;return kt(n,t,"internal-error"),gr(n,new Xr(e),e.bypassAuthState)}async function Yr(e){const{auth:t,user:n}=e;return kt(n,t,"internal-error"),pr(n,new Xr(e),e.bypassAuthState)}class $r{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jr;case"linkViaPopup":case"linkViaRedirect":return Yr;case"reauthViaPopup":case"reauthViaRedirect":return Qr;default:Et(this.auth,"internal-error")}}resolve(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Zr=new Dt(2e3,1e4);class es extends $r{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,es.currentPopupAction&&es.currentPopupAction.cancel(),es.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return kt(e,this.auth,"internal-error"),e}async onExecution(){Rt(1===this.filter.length,"Popup operations only handle one event");const e=Cr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(It(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(It(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,es.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t;null!==(t=this.authWindow)&&void 0!==t&&null!==(t=t.window)&&void 0!==t&&t.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(It(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Zr.get())};e()}}es.currentPopupAction=null;const ts=new Map;class ns extends $r{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=ts.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=is(t),r=ss(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}ts.set(this.auth._key(),e)}return this.bypassAuthState||ts.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function rs(e,t){ts.set(e._key(),t)}function ss(e){return dn(e._redirectPersistence)}function is(e){return gn("pendingRedirect",e.config.apiKey,e.name)}async function os(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ye(e.app))return Promise.reject(Tt(e));const r=Pn(e),s=Gr(r,t),i=new ns(r,s,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class as{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ls(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!ls(e)){var n;const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(It(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(cs(e))}saveEventToCache(e){this.cachedEventUids.add(cs(e)),this.lastProcessedEventTime=Date.now()}}function cs(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ls(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const us=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hs=/^https?/;async function ds(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Bt(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(fs(r))return}catch(n){}Et(e,"unauthorized-domain")}function fs(e){const t=Ot(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!hs.test(n))return!1;if(us.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const ps=new Dt(3e4,6e4);function gs(){const e=Or().___jsl;if(null!==e&&void 0!==e&&e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function ms(e){return new Promise((t,n)=>{var r,s;function i(){gs(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{gs(),n(It(e,"network-request-failed"))},timeout:ps.get()})}if(null!==(r=Or().gapi)&&void 0!==r&&null!==(r=r.iframes)&&void 0!==r&&r.Iframe)t(gapi.iframes.getContext());else{if(null===(s=Or().gapi)||void 0===s||!s.load){const t=Mn("iframefcb");return Or()[t]=()=>{gapi.load?i():n(It(e,"network-request-failed"))},Ln("".concat(Dn.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}i()}}).catch(e=>{throw vs=null,e})}let vs=null;const ys=new Dt(5e3,15e3),ws={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_s=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bs(e){const t=e.config;kt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Lt(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:et},s=_s.get(e.config.apiHost);s&&(r.eid=s);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),"".concat(n,"?").concat(D(r).slice(1))}async function Es(e){const t=await function(e){return vs=vs||ms(e),vs}(e),n=Or().gapi;return kt(n,e,"internal-error"),t.open({where:document.body,url:bs(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ws,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=It(e,"network-request-failed"),i=Or().setTimeout(()=>{r(s)},ys.get());function o(){Or().clearTimeout(i),n(t)}t.ping(o).then(o,()=>{r(s)})}))}const Is={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ss{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ts(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=c(c({},Is),{},{width:r.toString(),height:s.toString(),top:i,left:o}),u=T().toLowerCase();n&&(a=_n(u)?"_blank":n),yn(u)&&(t=t||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return Tn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:T())&&!(null===(e=window.navigator)||void 0===e||!e.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Ss(null);const d=window.open(t||"",a,h);kt(d,e,"popup-blocked");try{d.focus()}catch(f){}return new Ss(d)}const As="__/auth/handler",ks="emulator/auth/handler",Cs=encodeURIComponent("fac");async function Rs(e,t,n,r,s,i){kt(e.config.authDomain,e,"auth-domain-config-required"),kt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:et,eventId:s};if(t instanceof sr){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof ir){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const c=await e._getAppCheckToken(),l=c?"#".concat(Cs,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(As);return Lt(t,ks)}(e),"?").concat(D(a).slice(1)).concat(l)}const Os="webStorageSupport";const Ns=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ar,this._completeRedirectFn=os,this._overrideRedirectResult=rs}async _openPopup(e,t,n,r){var s;Rt(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return Ts(e,await Rs(e,t,n,Ot(),r),Cr())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Or().location.href=e}(await Rs(e,t,n,Ot(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Rt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Es(e),n=new as(e);return t.register("authEvent",t=>{kt(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Os,{type:Os},n=>{var r;const s=null===n||void 0===n||null===(r=n[0])||void 0===r?void 0:r[Os];void 0!==s&&t(!!s),Et(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ds(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return kn()||wn()||Tn()}};var Ps="@firebase/auth",xs="1.11.1";class Ds{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){kt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ls=y("authIdTokenMaxAge")||300;let Ms=null;var Us;Dn={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=It("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Us="Browser",Je(new F("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;kt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:Us,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Cn(Us)},l=new Nn(r,s,i,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(dn);null!==t&&void 0!==t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Je(new F("auth-internal",e=>(e=>new Ds(e))(Pn(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),rt(Ps,xs,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Us)),rt(Ps,xs,"esm2020");rt("firebase","12.6.0","app");var Vs,js="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Fs={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const r=Array(16);if("string"===typeof t)for(var s=0;s<16;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;s<16;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];let i,o=e.g[3];i=t+(o^n&(s^o))+r[0]+3614090360&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[1]+3905402710&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[2]+606105819&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[3]+3250441966&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[4]+4118548399&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[5]+1200080426&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[6]+2821735955&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[7]+4249261313&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[8]+1770035416&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[9]+2336552879&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[10]+4294925233&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[11]+2304563134&4294967295,i=t+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[12]+1804603682&4294967295,i=o+(s^(t=n+(i<<7&4294967295|i>>>25))&(n^s))+r[13]+4254626195&4294967295,o=t+(i<<12&4294967295|i>>>20),i=s+(n^o&(t^n))+r[14]+2792965006&4294967295,i=n+(t^(s=o+(i<<17&4294967295|i>>>15))&(o^t))+r[15]+1236535329&4294967295,i=t+(s^o&((n=s+(i<<22&4294967295|i>>>10))^s))+r[1]+4129170786&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[6]+3225465664&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[11]+643717713&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[0]+3921069994&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[5]+3593408605&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[10]+38016083&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[15]+3634488961&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[4]+3889429448&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[9]+568446438&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[14]+3275163606&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[3]+4107603335&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[8]+1163531501&4294967295,i=t+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[13]+2850285829&4294967295,i=o+(n^s&((t=n+(i<<5&4294967295|i>>>27))^n))+r[2]+4243563512&4294967295,o=t+(i<<9&4294967295|i>>>23),i=s+(t^n&(o^t))+r[7]+1735328473&4294967295,i=n+(o^t&((s=o+(i<<14&4294967295|i>>>18))^o))+r[12]+2368359562&4294967295,i=t+((n=s+(i<<20&4294967295|i>>>12))^s^o)+r[5]+4294588738&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[8]+2272392833&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[11]+1839030562&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[14]+4259657740&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[1]+2763975236&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[4]+1272893353&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[7]+4139469664&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[10]+3200236656&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[13]+681279174&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[0]+3936430074&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[3]+3572445317&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[6]+76029189&4294967295,i=t+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[9]+3654602809&4294967295,i=o+((t=n+(i<<4&4294967295|i>>>28))^n^s)+r[12]+3873151461&4294967295,o=t+(i<<11&4294967295|i>>>21),i=s+(o^t^n)+r[15]+530742520&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^t)+r[2]+3299628645&4294967295,i=t+(s^((n=s+(i<<23&4294967295|i>>>9))|~o))+r[0]+4096336452&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[7]+1126891415&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[14]+2878612391&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[5]+4237533241&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[12]+1700485571&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[3]+2399980690&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[10]+4293915773&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[1]+2240044497&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[8]+1873313359&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[15]+4264355552&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[6]+2734768916&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[13]+1309151649&4294967295,i=t+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[4]+4149444226&4294967295,i=o+(n^((t=n+(i<<6&4294967295|i>>>26))|~s))+r[11]+3174756917&4294967295,o=t+(i<<10&4294967295|i>>>22),i=s+(t^(o|~n))+r[2]+718787259&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+o&4294967295}function r(e,t){this.h=t;const n=[];let r=!0;for(let s=e.length-1;s>=0;s--){const i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,s=this.C;let i=this.h,o=0;for(;o<t;){if(0==i)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"===typeof e){for(;o<t;)if(s[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<t;)if(s[i++]=e[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s={};function i(e){return-128<=e&&e<128?function(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],e<0?-1:0)}):new r([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(e<0)return d(o(-e));const t=[];let n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new r(t,0)}var a=i(0),c=i(1),l=i(16777216);function u(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new r(n,~e.h).add(c)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(u(t))throw Error("division by zero");if(u(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(e.g.length>30){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;r.l(e)<=0;)n=v(n),r=v(r);var s=y(n,1),i=y(r,1);for(r=y(r,2),n=y(n,2);!u(r);){var l=i.add(r);l.l(e)<=0&&(s=s.add(n),i=l),r=y(r,1),n=y(n,1)}return t=f(e,s.j(t)),new g(s,t)}for(s=a;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),l=(i=o(n)).j(t);h(l)||l.l(e)>0;)l=(i=o(n-=r)).j(t);u(i)&&(i=c),s=s.add(i),e=f(e,l)}return new g(s,e)}function v(e){const t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(n,e.h)}function y(e,t){const n=t>>5;t%=32;const s=e.g.length-n,i=[];for(let r=0;r<s;r++)i[r]=t>0?e.i(r+n)>>>t|e.i(r+n+1)<<32-t:e.i(r+n);return new r(i,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);const t=o(Math.pow(e,6));var n=this;let r="";for(;;){const s=m(n,t).g;let i=(((n=f(n,s.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(u(n=s))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let s=0;for(let r=0;r<=t;r++){let t=s+(65535&this.i(r))+(65535&e.i(r)),i=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);s=i>>>16,t&=65535,i&=65535,n[r]=i<<16|t}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(this.l(l)<0&&e.l(l)<0)return o(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var s=0;s<2*t;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(let t=0;t<e.g.length;t++){const r=this.i(s)>>>16,i=65535&this.i(s),o=e.i(t)>>>16,a=65535&e.i(t);n[2*s+2*t]+=i*a,p(n,2*s+2*t),n[2*s+2*t+1]+=r*a,p(n,2*s+2*t+1),n[2*s+2*t+1]+=i*o,p(n,2*s+2*t+1),n[2*s+2*t+2]+=r*o,p(n,2*s+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new r(n,0)},e.B=function(e){return m(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new r(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new r(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Fs.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=o(Math.pow(n,8));let s=a;for(let a=0;a<t.length;a+=8){var i=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+i),n);i<8?(i=o(Math.pow(n,i)),s=s.j(i).add(o(e))):(s=s.j(r),s=s.add(o(e)))}return s},Vs=Fs.Integer=r}).apply("undefined"!==typeof js?js:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Bs,qs,Hs,Ws,Ks,zs,Gs,Xs,Js="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Qs={};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Js&&Js];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in s))break e;s=s[o]}(r=r(i=s[e=e[e.length-1]]))!=i&&null!=r&&t(s,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},i=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=a).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}var h="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const r=t.length||0;e.length=n+r;for(let s=0;s<r;s++)e[n+s]=t[s]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function g(){var e=_;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var m=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new v,e=>e.reset());class v{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,w=!1,_=new class{constructor(){this.h=this.g=null}add(e,t){const n=m.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},b=()=>{const e=Promise.resolve(void 0);y=()=>{e.then(E)}};function E(){for(var e;e=g();){try{e.h.call(e.g)}catch(n){p(n)}var t=m;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}w=!1}function I(){this.u=this.u,this.C=this.C}function S(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},S.prototype.h=function(){this.defaultPrevented=!0};var T=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function A(e){return/^[\s\xa0]*$/.test(e)}function k(e,t){S.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(k,S),k.prototype.init=function(e,t){const n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&k.Z.h.call(this)},k.prototype.h=function(){k.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var C="closure_listenable_"+(1e6*Math.random()|0),R=0;function O(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++R,this.da=this.fa=!1}function N(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function x(e){const t={};for(const n in e)t[n]=e[n];return t}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)e[n]=r[n];for(let t=0;t<D.length;t++)n=D[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function M(e){this.src=e,this.g={},this.h=0}function U(e,t){const n=t.type;if(n in e.g){var r,s=e.g[n],i=Array.prototype.indexOf.call(s,t,void 0);(r=i>=0)&&Array.prototype.splice.call(s,i,1),r&&(N(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function V(e,t,n,r){for(let s=0;s<e.length;++s){const i=e[s];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}M.prototype.add=function(e,t,n,r,s){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const o=V(e,t,r,s);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new O(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var j="closure_lm_"+(1e6*Math.random()|0),F={};function B(e,t,n,r,s){if(r&&r.once)return H(e,t,n,r,s);if(Array.isArray(t)){for(let i=0;i<t.length;i++)B(e,t[i],n,r,s);return null}return n=Q(n),e&&e[C]?e.J(t,n,o(r)?!!r.capture:!!r,s):q(e,t,n,!1,r,s)}function q(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=X(e);if(c||(e[j]=c=new M(e)),(n=c.add(t,n,r,a,i)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=G;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)T||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(z(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function H(e,t,n,r,s){if(Array.isArray(t)){for(let i=0;i<t.length;i++)H(e,t[i],n,r,s);return null}return n=Q(n),e&&e[C]?e.K(t,n,o(r)?!!r.capture:!!r,s):q(e,t,n,!0,r,s)}function W(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)W(e,t[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=Q(n),e&&e[C]?(e=e.i,(i=String(t).toString())in e.g&&((n=V(t=e.g[i],n,r,s))>-1&&(N(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--)))):e&&(e=X(e))&&(t=e.g[t.toString()],e=-1,t&&(e=V(t,n,r,s)),(n=e>-1?t[e]:null)&&K(n))}function K(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[C])U(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(z(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=X(t))?(U(n,e),0==n.h&&(n.src=null,t[j]=null)):N(e)}}}function z(e){return e in F?F[e]:F[e]="on"+e}function G(e,t){if(e.da)e=!0;else{t=new k(t,this);const n=e.listener,r=e.ha||e.src;e.fa&&K(e),e=n.call(r,t)}return e}function X(e){return(e=e[j])instanceof M?e:null}var J="__closure_events_fn_"+(1e9*Math.random()>>>0);function Q(e){return"function"===typeof e?e:(e[J]||(e[J]=function(t){return e.handleEvent(t)}),e[J])}function Y(){I.call(this),this.i=new M(this),this.M=this,this.G=null}function $(e,t){var n,r=e.G;if(r)for(n=[];r;r=r.G)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new S(t,e);else if(t instanceof S)t.target=t.target||e;else{var s=t;L(t=new S(r,e),s)}let i,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)i=t.g=n[o],s=Z(i,r,!0,t)&&s;if(i=t.g=e,s=Z(i,r,!0,t)&&s,s=Z(i,r,!1,t)&&s,n)for(o=0;o<n.length;o++)i=t.g=n[o],s=Z(i,r,!1,t)&&s}function Z(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let i=0;i<t.length;++i){const o=t[i];if(o&&!o.da&&o.capture==n){const t=o.listener,n=o.ha||o.src;o.fa&&U(e.i,o),s=!1!==t.call(n,r)&&s}}return s&&!r.defaultPrevented}function ee(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,ee(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(Y,I),Y.prototype[C]=!0,Y.prototype.removeEventListener=function(e,t,n,r){W(this,e,t,n,r)},Y.prototype.N=function(){if(Y.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)N(n[e]);delete e.g[t],e.h--}}this.G=null},Y.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Y.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class te extends I{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ee(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ne(e){I.call(this),this.h=e,this.g={}}u(ne,I);var re=[];function se(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&K(e)},e),e.g={}}ne.prototype.N=function(){ne.Z.N.call(this),se(this)},ne.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ie=i.JSON.stringify,oe=i.JSON.parse,ae=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ce(){}function le(){}var ue={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function he(){S.call(this,"d")}function de(){S.call(this,"c")}u(he,S),u(de,S);var fe={},pe=null;function ge(){return pe=pe||new Y}function me(e){S.call(this,fe.Ia,e)}function ve(e){const t=ge();$(t,new me(t))}function ye(e,t){S.call(this,fe.STAT_EVENT,e),this.stat=t}function we(e){const t=ge();$(t,new ye(t,e))}function _e(e,t){S.call(this,fe.Ja,e),this.size=t}function be(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Ee(){this.g=!0}function Ie(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<r.length;e++)r[e]=""}}}return ie(i)}catch(i){return t}}(e,n)+(r?" "+r:"")})}fe.Ia="serverreachability",u(me,S),fe.STAT_EVENT="statevent",u(ye,S),fe.Ja="timingevent",u(_e,S),Ee.prototype.ua=function(){this.g=!1},Ee.prototype.info=function(){};var Se,Te={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ae={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ke(){}function Ce(e){return encodeURIComponent(String(e))}function Re(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Oe(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new ne(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ne}function Ne(){this.i=null,this.g="",this.h=!1}u(ke,ce),ke.prototype.g=function(){return new XMLHttpRequest},Se=new ke;var Pe={},xe={};function De(e,t,n){e.M=1,e.A=it(et(t)),e.u=n,e.R=!0,Le(e,null)}function Le(e,t){e.F=Date.now(),Ve(e),e.B=et(e.A);var n=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),wt(n.i,"t",r),e.C=0,n=e.j.L,e.h=new Ne,e.g=on(e.j,n?t:null,!e.u),e.P>0&&(e.O=new te(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,r=e.ba;var s="readystatechange";Array.isArray(s)||(s&&(re[0]=s.toString()),s=re);for(let i=0;i<s.length;i++){const e=B(n,s[i],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?x(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ve(),function(e,t,n,r,s,i){e.info(function(){if(e.g)if(i){var o="",a=i.split("&");for(let e=0;e<a.length;e++){var c=a[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+c+"&":o+(e+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Me(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Ue(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?xe:(n=Number(t.substring(n,r)),isNaN(n)?Pe:(r+=1)+n>t.length?xe:(t=t.slice(r,r+n),e.C=r+n,t))}function Ve(e){e.T=Date.now()+e.H,je(e,e.H)}function je(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=be(c(e.aa,e),t)}function Fe(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Be(e){0==e.j.I||e.K||en(e.j,e)}function qe(e){Fe(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,se(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function He(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||Xe(n.h,e)))if(!e.L&&Xe(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;Zt(n),Ht(n)}Qt(n),we(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=be(c(n.Va,n),6e3));Ge(n.h)<=1&&n.ta&&(n.ta=void 0)}else nn(n,11)}else if((e.L||n.g==e)&&Zt(n),!A(t))for(s=n.Ba.g.parse(t),t=0;t<s.length;t++){let c=s[t];const u=c[0];if(!(u<=n.K))if(n.K=u,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const u=c[5];null!=u&&"number"===typeof u&&u>0&&(r=1.5*u,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Je(i,i.h),i.h=null))}if(r.G){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,st(r.J,r.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=e;if((r=n).na=sn(r,r.L?r.ba:null,r.W),o.L){Qe(r.h,o);var a=o,l=r.O;l&&(a.H=l),a.D&&(Fe(a),Ve(a)),r.g=o}else Jt(r);n.i.length>0&&Kt(n)}else"stop"!=c[0]&&"close"!=c[0]||nn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?nn(n,7):qt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}ve()}catch(u){}}Oe.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Vt(e)?t.j():this.Y(e)},Oe.prototype.Y=function(e){try{if(e==this.g)e:{const c=Vt(this.g),l=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||jt(this.g)))){this.K||4!=c||7==l||ve(),Fe(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Me(e))return e.g.la();const t=jt(e.g);if(""===t)return"";let n="";const r=t.length,s=4==Vt(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return qe(e),Be(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<r;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(s&&i==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,r,s,i,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,s=this.g;if((r=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(r)){var o=r;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,we(12),qe(this),Be(this);break e}Ie(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,He(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Ue(this,n),t==xe){4==c&&(this.m=4,we(14),e=!1),Ie(this.i,this.l,null,"[Incomplete Response]");break}if(t==Pe){this.m=4,we(15),Ie(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}Ie(this.i,this.l,t,null),He(this,t)}if(Me(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,we(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yt(a),a.P=!0,we(11))}}else Ie(this.i,this.l,n,"[Invalid Chunked Response]"),qe(this),Be(this)}else Ie(this.i,this.l,n,null),He(this,n);4==c&&qe(this),this.o&&!this.K&&(4==c?en(this.j,this):(this.o=!1,Ve(this)))}else(function(e){const t={};e=(e.g&&Vt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(A(e[r]))continue;var n=Re(e[r]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,we(12)):(this.m=0,we(13)),qe(this),Be(this)}}}catch(Oi){}},Oe.prototype.cancel=function(){this.K=!0,qe(this)},Oe.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ve(),we(17)),qe(this),this.m=2,Be(this)):je(this,this.T-e)};var We=class{constructor(e,t){this.g=e,this.map=t}};function Ke(e){this.l=e||10,i.PerformanceNavigationTiming?e=(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ze(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ge(e){return e.h?1:e.g?e.g.size:0}function Xe(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Je(e,t){e.g?e.g.add(t):e.h=t}function Qe(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ye(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}Ke.prototype.cancel=function(){if(this.i=Ye(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var $e=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ze(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ze?(this.l=e.l,tt(this,e.j),this.o=e.o,this.g=e.g,nt(this,e.u),this.h=e.h,rt(this,_t(e.i)),this.m=e.m):e&&(t=String(e).match($e))?(this.l=!1,tt(this,t[1]||"",!0),this.o=ot(t[2]||""),this.g=ot(t[3]||"",!0),nt(this,t[4]),this.h=ot(t[5]||"",!0),rt(this,t[6]||"",!0),this.m=ot(t[7]||"")):(this.l=!1,this.i=new pt(null,this.l))}function et(e){return new Ze(e)}function tt(e,t,n){e.j=n?ot(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function rt(e,t,n){t instanceof pt?(e.i=t,function(e,t){t&&!e.j&&(gt(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(mt(this,t),wt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=at(t,dt)),e.i=new pt(t,e.l))}function st(e,t,n){e.i.set(t,n)}function it(e){return st(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ot(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function at(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,ct),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ct(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ze.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(at(t,lt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(at(t,lt,!0),"@"),e.push(Ce(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(at(n,"/"==n.charAt(0)?ht:ut,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",at(n,ft)),e.join("")},Ze.prototype.resolve=function(e){const t=et(this);let n=!!e.j;n?tt(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)nt(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var s=t.h.lastIndexOf("/");-1!=s&&(r=t.h.slice(0,s+1)+r)}if(".."==(s=r)||"."==s)r="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){r=0==s.lastIndexOf("/",0),s=s.split("/");const e=[];for(let t=0;t<s.length;){const n=s[t++];"."==n?r&&t==s.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==s.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=s}return n?t.h=r:n=""!==e.i.toString(),n?rt(t,_t(e.i)):n=!!e.m,n&&(t.m=e.m),t};var lt=/[#\/\?@]/g,ut=/[#\?:]/g,ht=/[#\?]/g,dt=/[#\?@]/g,ft=/#/g;function pt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function gt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const r=e[n].indexOf("=");let s,i=null;r>=0?(s=e[n].substring(0,r),i=e[n].substring(r+1)):s=e[n],t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function mt(e,t){gt(e),t=bt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function vt(e,t){return gt(e),t=bt(e,t),e.g.has(t)}function yt(e,t){gt(e);let n=[];if("string"===typeof t)vt(e,t)&&(n=n.concat(e.g.get(bt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function wt(e,t,n){mt(e,t),n.length>0&&(e.i=null,e.g.set(bt(e,t),d(n)),e.h+=n.length)}function _t(e){const t=new pt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function bt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Et(e,t,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(i){}}function It(){this.g=new ae}function St(e){this.i=e.Sb||null,this.h=e.ab||!1}function Tt(e,t){Y.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function At(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function kt(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Ct(e)}function Ct(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Rt(e){let t="";return P(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Ot(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Rt(n),"string"===typeof e?null!=n&&Ce(n):st(e,t,n))}function Nt(e){Y.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=pt.prototype).add=function(e,t){gt(this),this.i=null,e=bt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){gt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.set=function(e,t){return gt(this),this.i=null,vt(this,e=bt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=yt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];const s=Ce(n);n=yt(this,n);for(let t=0;t<n.length;t++){let r=s;""!==n[t]&&(r+="="+Ce(n[t])),e.push(r)}}return this.i=e.join("&")},u(St,ce),St.prototype.g=function(){return new Tt(this.i,this.h)},u(Tt,Y),(e=Tt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Ct(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,kt(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ct(this)),this.g&&(this.readyState=3,Ct(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;At(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?kt(this):Ct(this),3==this.readyState&&At(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,kt(this))},e.Na=function(e){this.g&&(this.response=e,kt(this))},e.ga=function(){this.g&&kt(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Tt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Nt,Y);var Pt=/^https?$/i,xt=["POST","PUT"];function Dt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Lt(e),Ut(e)}function Lt(e){e.A||(e.A=!0,$(e,"complete"),$(e,"error"))}function Mt(e){if(e.h&&"undefined"!=typeof s)if(e.v&&4==Vt(e))setTimeout(e.Ca.bind(e),0);else if($(e,"readystatechange"),4==Vt(e)){e.h=!1;try{const s=e.ca();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){let t=String(e.D).match($e)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),r=!Pt.test(t?t.toLowerCase():"")}n=r}if(n)$(e,"complete"),$(e,"success");else{e.o=6;try{var o=Vt(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Lt(e)}}finally{Ut(e)}}}function Ut(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||$(e,"ready");try{r.onreadystatechange=null}catch(n){}}}function Vt(e){return e.g?e.g.readyState:0}function jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ft(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Bt(e){this.za=0,this.i=[],this.j=new Ee,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ft("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ft("baseRetryDelayMs",5e3,e),this.Za=Ft("retryDelaySeedMs",1e4,e),this.Ta=Ft("forwardChannelMaxRetries",2,e),this.va=Ft("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new Ke(e&&e.concurrentRequestLimit),this.Ba=new It,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function qt(e){if(Wt(e),3==e.I){var t=e.V++,n=et(e.J);if(st(n,"SID",e.M),st(n,"RID",t),st(n,"TYPE","terminate"),Gt(e,n),(t=new Oe(e,e.j,t)).M=2,t.A=it(et(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=on(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Ve(t)}rn(e)}function Ht(e){e.g&&(Yt(e),e.g.cancel(),e.g=null)}function Wt(e){Ht(e),e.v&&(i.clearTimeout(e.v),e.v=null),Zt(e),e.h.cancel(),e.m&&("number"===typeof e.m&&i.clearTimeout(e.m),e.m=null)}function Kt(e){if(!ze(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||b(),w||(y(),w=!0),_.add(t,e),e.D=0}}function zt(e,t){var n;n=t?t.l:e.V++;const r=et(e.J);st(r,"SID",e.M),st(r,"RID",n),st(r,"AID",e.K),Gt(e,r),e.u&&e.o&&Ot(r,e.u,e.o),n=new Oe(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Xt(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Je(e.h,n),De(n,r,t)}function Gt(e,t){e.H&&P(e.H,function(e,n){st(t,n,e)}),e.l&&P({},function(e,n){st(t,n,e)})}function Xt(e,t,n){n=Math.min(e.i.length,n);const r=e.l?c(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let l=0;l<n;l++){var i=s[l].g;const n=s[l].map;if((i-=t)<0)t=Math.max(0,s[l].g-100),c=!1;else try{i="req"+i+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[t,n]of a){let r=n;o(n)&&(r=ie(n)),e.push(i+t+"="+encodeURIComponent(r))}}catch($s){throw e.push(i+"type="+encodeURIComponent("_badmap")),$s}}catch($s){r&&r(n)}}if(c){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,n),t.G=e,a}function Jt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||b(),w||(y(),w=!0),_.add(t,e),e.A=0}}function Qt(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=be(c(e.Da,e),tn(e,e.A)),e.A++,!0)}function Yt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function $t(e){e.g=new Oe(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=et(e.na);st(t,"RID","rpc"),st(t,"SID",e.M),st(t,"AID",e.K),st(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&st(t,"TO",e.ia),st(t,"TYPE","xmlhttp"),Gt(e,t),e.u&&e.o&&Ot(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=it(et(t)),n.u=null,n.R=!0,Le(n,e)}function Zt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function en(e,t){var n=null;if(e.g==t){Zt(e),Yt(e),e.g=null;var r=2}else{if(!Xe(e.h,t))return;n=t.G,Qe(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;$(r=ge(),new _e(r,n)),Kt(e)}else Jt(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==r&&function(e,t){return!(Ge(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=be(c(e.Ea,e,t),tn(e,e.D)),e.D++,!0))}(e,t)||2==r&&Qt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),s){case 1:nn(e,5);break;case 4:nn(e,10);break;case 3:nn(e,6);break;default:nn(e,2)}}function tn(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function nn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),r=e.Ua;const t=!r;r=new Ze(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||tt(r,"https"),it(r),t?function(e,t){const n=new Ee;if(i.Image){const r=new Image;r.onload=l(Et,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Et,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Et,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Et,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ee;const n=new AbortController,r=setTimeout(()=>{n.abort(),Et(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Et(0,0,!0,t):Et(0,0,!1,t)}).catch(()=>{clearTimeout(r),Et(0,0,!1,t)})}(r.toString(),n)}else we(2);e.I=0,e.l&&e.l.pa(t),rn(e),Wt(e)}function rn(e){if(e.I=0,e.ja=[],e.l){const t=Ye(e.h);0==t.length&&0==e.i.length||(f(e.ja,t),f(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function sn(e,t,n){var r=n instanceof Ze?et(n):new Ze(n);if(""!=r.g)t&&(r.g=t+"."+r.g),nt(r,r.u);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;const e=new Ze(null);r&&tt(e,r),t&&(e.g=t),s&&nt(e,s),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&st(r,n,t),st(r,"VER",e.ka),Gt(e,r),r}function on(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Nt(new St({ab:n})):new Nt(e.ma)).Fa(e.L),t}function an(){}function cn(){}function ln(e,t){Y.call(this),this.g=new Bt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!A(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!A(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new dn(this)}function un(e){he.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function hn(){de.call(this),this.status=1}function dn(e){this.g=e}(e=Nt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Se.g(),this.g.onreadystatechange=h(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Dt(this,o)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(xt,t,void 0)>=0)||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){Dt(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,$(this,"complete"),$(this,"abort"),Ut(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ut(this,!0)),Nt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Mt(this):this.Xa())},e.Xa=function(){Mt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Vt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),oe(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Bt.prototype).ka=8,e.I=1,e.connect=function(e,t,n,r){we(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=sn(this,null,this.W),Kt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const s=new Oe(this,this.j,e);let i=this.o;if(this.U&&(i?(i=x(i),L(i,this.U)):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Xt(this,s,t),st(n=et(this.J),"RID",e),st(n,"CVER",22),this.G&&st(n,"X-HTTP-Session-Id",this.G),Gt(this,n),i&&(this.R?t="headers="+Ce(Rt(i))+"&"+t:this.u&&Ot(n,this.u,i)),Je(this.h,s),this.Ra&&st(n,"TYPE","init"),this.S?(st(n,"$req",t),st(n,"SID","null"),s.U=!0,De(s,n,null)):De(s,n,t),this.I=2}}else 3==this.I&&(e?zt(this,e):0==this.i.length||ze(this.h)||zt(this))},e.Da=function(){if(this.v=null,$t(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=be(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,we(10),Ht(this),$t(this))},e.Va=function(){null!=this.C&&(this.C=null,Ht(this),Qt(this),we(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=an.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},cn.prototype.g=function(e,t){return new ln(e,t)},u(ln,Y),ln.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ln.prototype.close=function(){qt(this.g)},ln.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ie(e),e=n);t.i.push(new We(t.Ya++,e)),3==t.I&&Kt(t)},ln.prototype.N=function(){this.g.l=null,delete this.j,qt(this.g),delete this.g,ln.Z.N.call(this)},u(un,he),u(hn,de),u(dn,an),dn.prototype.ra=function(){$(this.g,"a")},dn.prototype.qa=function(e){$(this.g,new un(e))},dn.prototype.pa=function(e){$(this.g,new hn)},dn.prototype.oa=function(){$(this.g,"b")},cn.prototype.createWebChannel=cn.prototype.g,ln.prototype.send=ln.prototype.o,ln.prototype.open=ln.prototype.m,ln.prototype.close=ln.prototype.close,Xs=Qs.createWebChannelTransport=function(){return new cn},Gs=Qs.getStatEventTarget=function(){return ge()},zs=Qs.Event=fe,Ks=Qs.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,Ws=Qs.ErrorCode=Te,Ae.COMPLETE="complete",Hs=Qs.EventType=Ae,le.EventType=ue,ue.OPEN="a",ue.CLOSE="b",ue.ERROR="c",ue.MESSAGE="d",Y.prototype.listen=Y.prototype.J,qs=Qs.WebChannel=le,Qs.FetchXmlHttpFactory=St,Nt.prototype.listenOnce=Nt.prototype.K,Nt.prototype.getLastError=Nt.prototype.Ha,Nt.prototype.getLastErrorCode=Nt.prototype.ya,Nt.prototype.getStatus=Nt.prototype.ca,Nt.prototype.getResponseJson=Nt.prototype.La,Nt.prototype.getResponseText=Nt.prototype.la,Nt.prototype.send=Nt.prototype.ea,Nt.prototype.setWithCredentials=Nt.prototype.Fa,Bs=Qs.XhrIo=Nt}).apply("undefined"!==typeof Js?Js:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const Ys="@firebase/firestore",$s="4.9.2";class Zs{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Zs.UNAUTHENTICATED=new Zs(null),Zs.GOOGLE_CREDENTIALS=new Zs("google-credentials-uid"),Zs.FIRST_PARTY=new Zs("first-party-uid"),Zs.MOCK_USER=new Zs("mock-user");let ei="12.3.0";const ti=new Q("@firebase/firestore");function ni(){return ti.logLevel}function ri(e){if(ti.logLevel<=K.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.map(oi);ti.debug("Firestore (".concat(ei,"): ").concat(e),...s)}}function si(e){if(ti.logLevel<=K.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.map(oi);ti.error("Firestore (".concat(ei,"): ").concat(e),...s)}}function ii(e){if(ti.logLevel<=K.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=n.map(oi);ti.warn("Firestore (".concat(ei,"): ").concat(e),...s)}}function oi(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function ai(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,ci(e,r,n)}function ci(e,t,n){let r="FIRESTORE (".concat(ei,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw si(r),new Error(r)}function li(e,t,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,e||ci(t,s,r)}function ui(e,t){return e}const hi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class di extends R{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class fi{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class pi{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class gi{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Zs.UNAUTHENTICATED))}shutdown(){}}class mi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vi{constructor(e){this.t=e,this.currentUser=Zs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){li(void 0===this.o,42304);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new fi;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new fi,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{ri("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ri("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new fi)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ri("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(li("string"==typeof t.accessToken,31837,{l:t}),new pi(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return li(null===e||"string"==typeof e,2055,{h:e}),new Zs(e)}}class yi{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Zs.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class wi{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new yi(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Zs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class _i{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bi{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ye(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){li(void 0===this.o,3512);const n=e=>{null!=e.error&&ri("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.m;return this.m=e.token,ri("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{ri("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):ri("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new _i(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(li("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new _i(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ei(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class Ii{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Ei(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function Si(e,t){return e<t?-1:e>t?1:0}function Ti(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),s=t.charAt(r);if(n!==s)return Ci(n)===Ci(s)?Si(n,s):Ci(n)?1:-1}return Si(e.length,t.length)}const Ai=55296,ki=57343;function Ci(e){const t=e.charCodeAt(0);return t>=Ai&&t<=ki}function Ri(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}const Oi="__name__";class Ni{constructor(e,t,n){void 0===t?t=0:t>e.length&&ai(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&ai(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ni.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ni?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=Ni.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Si(e.length,t.length)}static compareSegments(e,t){const n=Ni.isNumericId(e),r=Ni.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?Ni.extractNumericId(e).compare(Ni.extractNumericId(t)):Ti(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vs.fromString(e.substring(4,e.length-2))}}class Pi extends Ni{construct(e,t,n){return new Pi(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const s of n){if(s.indexOf("//")>=0)throw new di(hi.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push(...s.split("/").filter(e=>e.length>0))}return new Pi(e)}static emptyPath(){return new Pi([])}}const xi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Di extends Ni{construct(e,t,n){return new Di(e,t,n)}static isValidIdentifier(e){return xi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Di.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Oi}static keyField(){return new Di([Oi])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new di(hi.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new di(hi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new di(hi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new di(hi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Di(t)}static emptyPath(){return new Di([])}}class Li{constructor(e){this.path=e}static fromPath(e){return new Li(Pi.fromString(e))}static fromName(e){return new Li(Pi.fromString(e).popFirst(5))}static empty(){return new Li(Pi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Pi.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Pi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Li(new Pi(e.slice()))}}function Mi(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Ui(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":ai(12329,{type:typeof e})}function Vi(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new di(hi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Ui(e);throw new di(hi.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function ji(e,t){const n={typeString:e};return t&&(n.value=t),n}function Fi(e,t){if(!Mi(e))throw new di(hi.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const s=t[r].typeString,i="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n="JSON missing required field: '".concat(r,"'");break}const o=e[r];if(s&&typeof o!==s){n="JSON field '".concat(r,"' must be a ").concat(s,".");break}if(void 0!==i&&o!==i.value){n="Expected '".concat(r,"' field to equal '").concat(i.value,"'");break}}if(n)throw new di(hi.INVALID_ARGUMENT,n);return!0}const Bi=-62135596800,qi=1e6;class Hi{static now(){return Hi.fromMillis(Date.now())}static fromDate(e){return Hi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*qi);return new Hi(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new di(hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new di(hi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Bi)throw new di(hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new di(hi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/qi}_compareTo(e){return this.seconds===e.seconds?Si(this.nanoseconds,e.nanoseconds):Si(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Hi._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Fi(e,Hi._jsonSchema))return new Hi(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Bi;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Hi._jsonSchemaVersion="firestore/timestamp/1.0",Hi._jsonSchema={type:ji("string",Hi._jsonSchemaVersion),seconds:ji("number"),nanoseconds:ji("number")};class Wi{static fromTimestamp(e){return new Wi(e)}static min(){return new Wi(new Hi(0,0))}static max(){return new Wi(new Hi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ki=-1;class zi{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}zi.UNKNOWN_ID=-1;function Gi(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=Wi.fromTimestamp(1e9===r?new Hi(n+1,0):new Hi(n,r));return new Ji(s,Li.empty(),t)}function Xi(e){return new Ji(e.readTime,e.key,Ki)}class Ji{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ji(Wi.min(),Li.empty(),Ki)}static max(){return new Ji(Wi.max(),Li.empty(),Ki)}}function Qi(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Li.comparator(e.documentKey,t.documentKey),0!==n?n:Si(e.largestBatchId,t.largestBatchId))}class Yi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class $i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ai(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new $i((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof $i?t:$i.resolve(t)}catch(e){return $i.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):$i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):$i.reject(t)}static resolve(e){return new $i((t,n)=>{t(e)})}static reject(e){return new $i((t,n)=>{n(e)})}static waitFor(e){return new $i((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=$i.resolve(!1);for(const n of e)t=t.next(e=>e?$i.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new $i((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next(e=>{i[c]=e,++o,o===s&&n(i)},e=>r(e))}})}static doWhile(e,t){return new $i((n,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):n()};s()})}}function Zi(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function eo(e){return"IndexedDbTransactionError"===e.name}class to{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}to.ce=-1;const no=-1;function ro(e){return null==e}function so(e){return 0===e&&1/e==-1/0}const io="remoteDocuments",oo="owner",ao="mutationQueues",co="mutations";const lo="documentMutations",uo="remoteDocumentsV14",ho="remoteDocumentGlobal",fo="targets",po="targetDocuments",go="targetGlobal",mo="collectionParents",vo="clientMetadata",yo="bundles",wo="namedQueries",_o="indexConfiguration",bo="indexState",Eo="indexEntries",Io="documentOverlays",So="globals",To=[ao,co,lo,io,fo,oo,go,po,vo,ho,mo,yo,wo],Ao=[ao,co,lo,uo,fo,oo,go,po,vo,ho,mo,yo,wo,Io],ko=Ao,Co=[...ko,_o,bo,Eo];function Ro(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Oo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function No(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Po{constructor(e,t){this.comparator=e,this.root=t||Do.EMPTY}insert(e,t){return new Po(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Do.BLACK,null,null))}remove(e){return new Po(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Do.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xo(this.root,e,this.comparator,!1)}getReverseIterator(){return new xo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xo(this.root,e,this.comparator,!0)}}class xo{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Do{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Do.RED,this.left=null!=r?r:Do.EMPTY,this.right=null!=s?s:Do.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Do(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Do.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Do.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Do.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Do.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ai(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ai(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ai(27949);return e+(this.isRed()?0:1)}}Do.EMPTY=null,Do.RED=!0,Do.BLACK=!1,Do.EMPTY=new class{constructor(){this.size=0}get key(){throw ai(57766)}get value(){throw ai(16141)}get color(){throw ai(16727)}get left(){throw ai(29726)}get right(){throw ai(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new Do(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Lo{constructor(e){this.comparator=e,this.data=new Po(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Mo(this.data.getIterator())}getIteratorFrom(e){return new Mo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Lo))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Lo(this.comparator);return t.data=e,t}}class Mo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Uo{constructor(e){this.fields=e,e.sort(Di.comparator)}static empty(){return new Uo([])}unionWith(e){let t=new Lo(Di.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Uo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ri(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Vo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class jo{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Vo("Invalid base64 string: "+e):e}}(e);return new jo(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new jo(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Si(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}jo.EMPTY_BYTE_STRING=new jo("");const Fo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bo(e){if(li(!!e,39018),"string"==typeof e){let t=0;const n=Fo.exec(e);if(li(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:qo(e.seconds),nanos:qo(e.nanos)}}function qo(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ho(e){return"string"==typeof e?jo.fromBase64String(e):jo.fromUint8Array(e)}const Wo="server_timestamp",Ko="__type__",zo="__previous_value__",Go="__local_write_time__";function Xo(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Ko])||void 0===t?void 0:t.stringValue)===Wo}function Jo(e){const t=e.mapValue.fields[zo];return Xo(t)?Jo(t):t}function Qo(e){const t=Bo(e.mapValue.fields[Go].timestampValue);return new Hi(t.seconds,t.nanos)}const Yo="(default)";class $o{constructor(e,t){this.projectId=e,this.database=t||Yo}static empty(){return new $o("","")}get isDefaultDatabase(){return this.database===Yo}isEqual(e){return e instanceof $o&&e.projectId===this.projectId&&e.database===this.database}}const Zo="__type__",ea="__max__",ta={mapValue:{fields:{__type__:{stringValue:ea}}}},na="__vector__",ra="value";function sa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Xo(e)?4:va(e)?9007199254740991:ga(e)?10:11:ai(28295,{value:e})}function ia(e,t){if(e===t)return!0;const n=sa(e);if(n!==sa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Qo(e).isEqual(Qo(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Bo(e.timestampValue),r=Bo(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ho(e.bytesValue).isEqual(Ho(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return qo(e.geoPointValue.latitude)===qo(t.geoPointValue.latitude)&&qo(e.geoPointValue.longitude)===qo(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return qo(e.integerValue)===qo(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=qo(e.doubleValue),r=qo(t.doubleValue);return n===r?so(n)===so(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Ri(e.arrayValue.values||[],t.arrayValue.values||[],ia);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Ro(n)!==Ro(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!ia(n[s],r[s])))return!1;return!0}(e,t);default:return ai(52216,{left:e})}}function oa(e,t){return void 0!==(e.values||[]).find(e=>ia(e,t))}function aa(e,t){if(e===t)return 0;const n=sa(e),r=sa(t);if(n!==r)return Si(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Si(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=qo(e.integerValue||e.doubleValue),r=qo(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ca(e.timestampValue,t.timestampValue);case 4:return ca(Qo(e),Qo(t));case 5:return Ti(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ho(e),r=Ho(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let s=0;s<n.length&&s<r.length;s++){const e=Si(n[s],r[s]);if(0!==e)return e}return Si(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Si(qo(e.latitude),qo(t.latitude));return 0!==n?n:Si(qo(e.longitude),qo(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return la(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,s,i;const o=e.fields||{},a=t.fields||{},c=null===(n=o[ra])||void 0===n?void 0:n.arrayValue,l=null===(r=a[ra])||void 0===r?void 0:r.arrayValue,u=Si((null===c||void 0===c||null===(s=c.values)||void 0===s?void 0:s.length)||0,(null===l||void 0===l||null===(i=l.values)||void 0===i?void 0:i.length)||0);return 0!==u?u:la(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===ta.mapValue&&t===ta.mapValue)return 0;if(e===ta.mapValue)return 1;if(t===ta.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const e=Ti(r[o],i[o]);if(0!==e)return e;const t=aa(n[r[o]],s[i[o]]);if(0!==t)return t}return Si(r.length,i.length)}(e.mapValue,t.mapValue);default:throw ai(23264,{he:n})}}function ca(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Si(e,t);const n=Bo(e),r=Bo(t),s=Si(n.seconds,r.seconds);return 0!==s?s:Si(n.nanos,r.nanos)}function la(e,t){const n=e.values||[],r=t.values||[];for(let s=0;s<n.length&&s<r.length;++s){const e=aa(n[s],r[s]);if(e)return e}return Si(n.length,r.length)}function ua(e){return ha(e)}function ha(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Bo(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Ho(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Li.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=ha(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+="".concat(s,":").concat(ha(e.fields[s]));return n+"}"}(e.mapValue):ai(61005,{value:e})}function da(e){return!!e&&"integerValue"in e}function fa(e){return!!e&&"arrayValue"in e}function pa(e){return!!e&&"mapValue"in e}function ga(e){var t,n;return(null===(t=((null===e||void 0===e||null===(n=e.mapValue)||void 0===n?void 0:n.fields)||{})[Zo])||void 0===t?void 0:t.stringValue)===na}function ma(e){if(e.geoPointValue)return{geoPointValue:c({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:c({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Oo(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ma(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ma(e.arrayValue.values[n]);return t}return c({},e)}function va(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ea}class ya{constructor(e){this.value=e}static empty(){return new ya({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!pa(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ma(t)}setAll(e){let t=Di.emptyPath(),n={},r=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=ma(e):r.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());pa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ia(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];pa(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Oo(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new ya(ma(this.value))}}class wa{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new wa(e,0,Wi.min(),Wi.min(),Wi.min(),ya.empty(),0)}static newFoundDocument(e,t,n,r){return new wa(e,1,t,Wi.min(),n,r,0)}static newNoDocument(e,t){return new wa(e,2,t,Wi.min(),Wi.min(),ya.empty(),0)}static newUnknownDocument(e,t){return new wa(e,3,t,Wi.min(),Wi.min(),ya.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Wi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ya.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ya.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Wi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof wa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class _a{constructor(e,t){this.position=e,this.inclusive=t}}function ba(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?Li.comparator(Li.fromName(o.referenceValue),n.key):aa(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Ea(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ia(e.position[n],t.position[n]))return!1;return!0}class Ia{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Sa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Ta{}class Aa extends Ta{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Da(e,t,n):"array-contains"===t?new Va(e,n):"in"===t?new ja(e,n):"not-in"===t?new Fa(e,n):"array-contains-any"===t?new Ba(e,n):new Aa(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new La(e,n):new Ma(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(aa(t,this.value)):null!==t&&sa(this.value)===sa(t)&&this.matchesComparison(aa(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ai(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ka extends Ta{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ka(e,t)}matches(e){return Ca(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ca(e){return"and"===e.op}function Ra(e){return Oa(e)&&Ca(e)}function Oa(e){for(const t of e.filters)if(t instanceof ka)return!1;return!0}function Na(e){if(e instanceof Aa)return e.field.canonicalString()+e.op.toString()+ua(e.value);if(Ra(e))return e.filters.map(e=>Na(e)).join(",");{const t=e.filters.map(e=>Na(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Pa(e,t){return e instanceof Aa?function(e,t){return t instanceof Aa&&e.op===t.op&&e.field.isEqual(t.field)&&ia(e.value,t.value)}(e,t):e instanceof ka?function(e,t){return t instanceof ka&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&Pa(n,t.filters[r]),!0)}(e,t):void ai(19439)}function xa(e){return e instanceof Aa?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(ua(e.value))}(e):e instanceof ka?function(e){return e.op.toString()+" {"+e.getFilters().map(xa).join(" ,")+"}"}(e):"Filter"}class Da extends Aa{constructor(e,t,n){super(e,t,n),this.key=Li.fromName(n.referenceValue)}matches(e){const t=Li.comparator(e.key,this.key);return this.matchesComparison(t)}}class La extends Aa{constructor(e,t){super(e,"in",t),this.keys=Ua("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ma extends Aa{constructor(e,t){super(e,"not-in",t),this.keys=Ua("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ua(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Li.fromName(e.referenceValue))}class Va extends Aa{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fa(t)&&oa(t.arrayValue,this.value)}}class ja extends Aa{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&oa(this.value.arrayValue,t)}}class Fa extends Aa{constructor(e,t){super(e,"not-in",t)}matches(e){if(oa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!oa(this.value.arrayValue,t)}}class Ba extends Aa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fa(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>oa(this.value.arrayValue,e))}}class qa{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.Te=null}}function Ha(e){return new qa(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Wa(e){const t=ui(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Na(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),ro(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>ua(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>ua(e)).join(",")),t.Te=e}return t.Te}function Ka(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Sa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Pa(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ea(e.startAt,t.startAt)&&Ea(e.endAt,t.endAt)}class za{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ga(e,t,n,r,s,i,o,a){return new za(e,t,n,r,s,i,o,a)}function Xa(e){return new za(e)}function Ja(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Qa(e){return null!==e.collectionGroup}function Ya(e){const t=ui(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Lo(Di.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Ia(r,n))}),e.has(Di.keyField().canonicalString())||t.Ie.push(new Ia(Di.keyField(),n))}return t.Ie}function $a(e){const t=ui(e);return t.Ee||(t.Ee=Za(t,Ya(e))),t.Ee}function Za(e,t){if("F"===e.limitType)return Ha(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Ia(e.field,t)});const n=e.endAt?new _a(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new _a(e.startAt.position,e.startAt.inclusive):null;return Ha(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function ec(e,t,n){return new za(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function tc(e,t){return Ka($a(e),$a(t))&&e.limitType===t.limitType}function nc(e){return"".concat(Wa($a(e)),"|lt:").concat(e.limitType)}function rc(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>xa(e)).join(", "),"]")),ro(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ua(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ua(e)).join(",")),"Target(".concat(t,")")}($a(e)),"; limitType=").concat(e.limitType,")")}function sc(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Li.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ya(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=ba(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Ya(e),t))&&!(e.endAt&&!function(e,t,n){const r=ba(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Ya(e),t))}(e,t)}function ic(e){return(t,n)=>{let r=!1;for(const s of Ya(e)){const e=oc(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function oc(e,t,n){const r=e.field.isKeyField()?Li.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?aa(r,s):ai(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return ai(19790,{direction:e.dir})}}class ac{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Oo(this.inner,(t,n)=>{for(const[r,s]of n)e(r,s)})}isEmpty(){return No(this.inner)}size(){return this.innerSize}}const cc=new Po(Li.comparator);function lc(){return cc}const uc=new Po(Li.comparator);function hc(){let e=uc;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const s of n)e=e.insert(s.key,s);return e}function dc(e){let t=uc;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function fc(){return gc()}function pc(){return gc()}function gc(){return new ac(e=>e.toString(),(e,t)=>e.isEqual(t))}new Po(Li.comparator);const mc=new Lo(Li.comparator);function vc(){let e=mc;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const s of n)e=e.add(s);return e}const yc=new Lo(Si);function wc(){return yc}function _c(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:so(t)?"-0":t}}function bc(e){return{integerValue:""+e}}class Ec{constructor(){this._=void 0}}function Ic(e,t,n){return e instanceof Ac?function(e,t){const n={fields:{[Ko]:{stringValue:Wo},[Go]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Xo(t)&&(t=Jo(t)),t&&(n.fields[zo]=t),{mapValue:n}}(n,t):e instanceof kc?Cc(e,t):e instanceof Rc?Oc(e,t):function(e,t){const n=Tc(e,t),r=Pc(n)+Pc(e.Ae);return da(n)&&da(e.Ae)?bc(r):_c(e.serializer,r)}(e,t)}function Sc(e,t,n){return e instanceof kc?Cc(e,t):e instanceof Rc?Oc(e,t):n}function Tc(e,t){return e instanceof Nc?function(e){return da(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Ac extends Ec{}class kc extends Ec{constructor(e){super(),this.elements=e}}function Cc(e,t){const n=xc(t);for(const r of e.elements)n.some(e=>ia(e,r))||n.push(r);return{arrayValue:{values:n}}}class Rc extends Ec{constructor(e){super(),this.elements=e}}function Oc(e,t){let n=xc(t);for(const r of e.elements)n=n.filter(e=>!ia(e,r));return{arrayValue:{values:n}}}class Nc extends Ec{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Pc(e){return qo(e.integerValue||e.doubleValue)}function xc(e){return fa(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Dc{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Dc}static exists(e){return new Dc(void 0,e)}static updateTime(e){return new Dc(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Lc(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Mc{}function Uc(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new zc(e.key,Dc.none()):new Bc(e.key,e.data,Dc.none());{const n=e.data,r=ya.empty();let s=new Lo(Di.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new qc(e.key,r,new Uo(s.toArray()),Dc.none())}}function Vc(e,t,n){e instanceof Bc?function(e,t,n){const r=e.value.clone(),s=Wc(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof qc?function(e,t,n){if(!Lc(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Wc(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Hc(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function jc(e,t,n,r){return e instanceof Bc?function(e,t,n,r){if(!Lc(e.precondition,t))return n;const s=e.value.clone(),i=Kc(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof qc?function(e,t,n,r){if(!Lc(e.precondition,t))return n;const s=Kc(e.fieldTransforms,r,t),i=t.data;return i.setAll(Hc(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return Lc(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Fc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Ri(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof kc&&t instanceof kc||e instanceof Rc&&t instanceof Rc?Ri(e.elements,t.elements,ia):e instanceof Nc&&t instanceof Nc?ia(e.Ae,t.Ae):e instanceof Ac&&t instanceof Ac}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Bc extends Mc{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class qc extends Mc{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Hc(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Wc(e,t,n){const r=new Map;li(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Sc(o,a,n[s]))}return r}function Kc(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,Ic(e,i,t))}return r}class zc extends Mc{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Gc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Vc(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=jc(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=jc(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=pc();return this.mutations.forEach(r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=Uc(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Wi.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),vc())}isEqual(e){return this.batchId===e.batchId&&Ri(this.mutations,e.mutations,(e,t)=>Fc(e,t))&&Ri(this.baseMutations,e.baseMutations,(e,t)=>Fc(e,t))}}class Xc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}var Jc,Qc;function Yc(e){if(void 0===e)return si("GRPC error has no .code"),hi.UNKNOWN;switch(e){case Jc.OK:return hi.OK;case Jc.CANCELLED:return hi.CANCELLED;case Jc.UNKNOWN:return hi.UNKNOWN;case Jc.DEADLINE_EXCEEDED:return hi.DEADLINE_EXCEEDED;case Jc.RESOURCE_EXHAUSTED:return hi.RESOURCE_EXHAUSTED;case Jc.INTERNAL:return hi.INTERNAL;case Jc.UNAVAILABLE:return hi.UNAVAILABLE;case Jc.UNAUTHENTICATED:return hi.UNAUTHENTICATED;case Jc.INVALID_ARGUMENT:return hi.INVALID_ARGUMENT;case Jc.NOT_FOUND:return hi.NOT_FOUND;case Jc.ALREADY_EXISTS:return hi.ALREADY_EXISTS;case Jc.PERMISSION_DENIED:return hi.PERMISSION_DENIED;case Jc.FAILED_PRECONDITION:return hi.FAILED_PRECONDITION;case Jc.ABORTED:return hi.ABORTED;case Jc.OUT_OF_RANGE:return hi.OUT_OF_RANGE;case Jc.UNIMPLEMENTED:return hi.UNIMPLEMENTED;case Jc.DATA_LOSS:return hi.DATA_LOSS;default:return ai(39323,{code:e})}}(Qc=Jc||(Jc={}))[Qc.OK=0]="OK",Qc[Qc.CANCELLED=1]="CANCELLED",Qc[Qc.UNKNOWN=2]="UNKNOWN",Qc[Qc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qc[Qc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qc[Qc.NOT_FOUND=5]="NOT_FOUND",Qc[Qc.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qc[Qc.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qc[Qc.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qc[Qc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qc[Qc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qc[Qc.ABORTED=10]="ABORTED",Qc[Qc.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qc[Qc.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qc[Qc.INTERNAL=13]="INTERNAL",Qc[Qc.UNAVAILABLE=14]="UNAVAILABLE",Qc[Qc.DATA_LOSS=15]="DATA_LOSS";new Vs([4294967295,4294967295],0);Error;class $c{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Zc(e){return li(!!e,49232),Wi.fromTimestamp(function(e){const t=Bo(e);return new Hi(t.seconds,t.nanos)}(e))}function el(e,t){const n=function(e){return new Pi(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function tl(e){const t=Pi.fromString(e);return li(al(t),10190,{key:t.toString()}),t}function nl(e){const t=tl(e);return 4===t.length?Pi.emptyPath():rl(t)}function rl(e){return li(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function sl(e){let t=nl(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){li(1===r,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=il(e);return t instanceof ka&&Ra(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map(e=>function(e){return new Ia(ol(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,ro(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new _a(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new _a(n,t)}(n.endAt)),Ga(t,s,o,i,a,"F",c,l)}function il(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ol(e.unaryFilter.field);return Aa.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=ol(e.unaryFilter.field);return Aa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ol(e.unaryFilter.field);return Aa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ol(e.unaryFilter.field);return Aa.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ai(61313);default:return ai(60726)}}(e):void 0!==e.fieldFilter?function(e){return Aa.create(ol(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ai(58110);default:return ai(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ka.create(e.compositeFilter.filters.map(e=>il(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ai(1026)}}(e.compositeFilter.op))}(e):ai(30097,{filter:e})}function ol(e){return Di.fromServerFormat(e.fieldPath)}function al(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class cl{constructor(e){this.yt=e}}function ll(e){const t=sl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ec(t,t.limit,"L"):t}class ul{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(qo(e.integerValue));else if("doubleValue"in e){const n=qo(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),so(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=Bo(n)),t.xt("".concat(n.seconds||"")),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ho(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?va(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):ga(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ai(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const r of Object.keys(n))this.Ot(r,t),this.Ct(n[r],t)}kt(e,t){var n;const r=e.fields||{};this.Ft(t,53);const s=ra,i=(null===(n=r[s].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(t,15),t.Mt(qo(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const r of n)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Li.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}ul.Kt=new ul;class hl{constructor(){this.Cn=new dl}addToCollectionParentIndex(e,t){return this.Cn.add(t),$i.resolve()}getCollectionParents(e,t){return $i.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return $i.resolve()}deleteFieldIndex(e,t){return $i.resolve()}deleteAllFieldIndexes(e){return $i.resolve()}createTargetIndexes(e,t){return $i.resolve()}getDocumentsMatchingTarget(e,t){return $i.resolve(null)}getIndexType(e,t){return $i.resolve(0)}getFieldIndexes(e,t){return $i.resolve([])}getNextCollectionGroupToUpdate(e){return $i.resolve(null)}getMinOffset(e,t){return $i.resolve(Ji.min())}getMinOffsetFromCollectionGroup(e,t){return $i.resolve(Ji.min())}updateCollectionGroup(e,t,n){return $i.resolve()}updateIndexEntries(e,t){return $i.resolve()}}class dl{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Lo(Pi.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Lo(Pi.comparator)).toArray()}}new Uint8Array(0);const fl=41943040;class pl{static withCacheSize(e){return new pl(e,pl.DEFAULT_COLLECTION_PERCENTILE,pl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}pl.DEFAULT_COLLECTION_PERCENTILE=10,pl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pl.DEFAULT=new pl(fl,pl.DEFAULT_COLLECTION_PERCENTILE,pl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pl.DISABLED=new pl(-1,0,0);class gl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new gl(0)}static cr(){return new gl(-1)}}const ml=1048576;class vl{constructor(){this.changes=new ac(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,wa.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?$i.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class yl{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class wl{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&jc(n.mutation,e,Uo.empty(),Hi.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,vc()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vc();const r=fc();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=hc();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=fc();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,vc()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let s=lc();const i=gc(),o=gc();return t.forEach((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof qc)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),jc(o.mutation,t,o.mutation.getFieldMask(),Hi.now())):i.set(t.key,Uo.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new yl(t,null!==(n=i.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=gc();let r=new Po((e,t)=>e-t),s=vc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Uo.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||vc()).add(e);r=r.insert(s.batchId,a)})}).next(()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,l=pc();c.forEach(e=>{if(!s.has(e)){const r=Uc(t.get(e),n.get(e));null!==r&&l.set(e,r),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,a,l))}return $i.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Li.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Qa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):$i.resolve(fc());let o=Ki,a=s;return i.next(t=>$i.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?$i.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,vc())).next(e=>({batchId:o,changes:dc(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Li(t)).next(e=>{let t=hc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=hc();return this.indexManager.getCollectionParents(e,s).next(o=>$i.forEach(o,o=>{const a=function(e,t){return new za(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r))).next(e=>{s.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,wa.newInvalidDocument(r)))});let n=hc();return e.forEach((e,r)=>{const i=s.get(e);void 0!==i&&jc(i.mutation,r,Uo.empty(),Hi.now()),sc(t,r)&&(n=n.insert(e,r))}),n})}}class _l{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return $i.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Zc(e.createTime)}}(t)),$i.resolve()}getNamedQuery(e,t){return $i.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:ll(e.bundledQuery),readTime:Zc(e.readTime)}}(t)),$i.resolve()}}class bl{constructor(){this.overlays=new Po(Li.comparator),this.qr=new Map}getOverlay(e,t){return $i.resolve(this.overlays.get(t))}getOverlays(e,t){const n=fc();return $i.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),$i.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),$i.resolve()}getOverlaysForCollection(e,t,n){const r=fc(),s=t.length+1,i=new Li(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return $i.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Po((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=fc(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=fc(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return $i.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Xc(t,n));let s=this.qr.get(t);void 0===s&&(s=vc(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class El{constructor(){this.sessionToken=jo.EMPTY_BYTE_STRING}getSessionToken(e){return $i.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,$i.resolve()}}class Il{constructor(){this.Qr=new Lo(Sl.$r),this.Ur=new Lo(Sl.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new Sl(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new Sl(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Li(new Pi([])),n=new Sl(t,e),r=new Sl(t,e+1),s=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),s.push(e.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Li(new Pi([])),n=new Sl(t,e),r=new Sl(t,e+1);let s=vc();return this.Ur.forEachInRange([n,r],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new Sl(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Sl{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Li.comparator(e.key,t.key)||Si(e.Yr,t.Yr)}static Kr(e,t){return Si(e.Yr,t.Yr)||Li.comparator(e.key,t.key)}}class Tl{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Lo(Sl.$r)}checkEmpty(e){return $i.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Gc(s,t,n,r);this.mutationQueue.push(i);for(const o of r)this.Zr=this.Zr.add(new Sl(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return $i.resolve(i)}lookupMutationBatch(e,t){return $i.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),s=r<0?0:r;return $i.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return $i.resolve(0===this.mutationQueue.length?no:this.tr-1)}getAllMutationBatches(e){return $i.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Sl(t,0),r=new Sl(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],e=>{const t=this.Xr(e.Yr);s.push(t)}),$i.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Lo(Si);return t.forEach(e=>{const t=new Sl(e,0),r=new Sl(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),$i.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Li.isDocumentKey(s)||(s=s.child(""));const i=new Sl(new Li(s),0);let o=new Lo(Si);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},i),$i.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){li(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return $i.forEach(t.mutations,r=>{const s=new Sl(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new Sl(t,0),r=this.Zr.firstAfterOrEqual(n);return $i.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,$i.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Al{constructor(e){this.ri=e,this.docs=new Po(Li.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return $i.resolve(n?n.document.mutableCopy():wa.newInvalidDocument(t))}getEntries(e,t){let n=lc();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():wa.newInvalidDocument(e))}),$i.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=lc();const i=t.path,o=new Li(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Qi(Xi(o),n)<=0||(r.has(o.key)||sc(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return $i.resolve(s)}getAllFromCollectionGroup(e,t,n,r){ai(9500)}ii(e,t){return $i.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new kl(this)}getSize(e){return $i.resolve(this.size)}}class kl extends vl{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),$i.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Cl{constructor(e){this.persistence=e,this.si=new ac(e=>Wa(e),Ka),this.lastRemoteSnapshotVersion=Wi.min(),this.highestTargetId=0,this.oi=0,this._i=new Il,this.targetCount=0,this.ai=gl.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),$i.resolve()}getLastRemoteSnapshotVersion(e){return $i.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $i.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),$i.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),$i.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new gl(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,$i.resolve()}updateTargetData(e,t){return this.Pr(t),$i.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,$i.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),$i.waitFor(s).next(()=>r)}getTargetCount(e){return $i.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return $i.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),$i.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(t=>{s.push(r.markPotentiallyOrphaned(e,t))}),$i.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),$i.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return $i.resolve(n)}containsKey(e,t){return $i.resolve(this._i.containsKey(t))}}class Rl{constructor(e,t){this.ui={},this.overlays={},this.ci=new to(0),this.li=!1,this.li=!0,this.hi=new El,this.referenceDelegate=e(this),this.Pi=new Cl(this),this.indexManager=new hl,this.remoteDocumentCache=function(e){return new Al(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new cl(t),this.Ii=new _l(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new bl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new Tl(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){ri("MemoryPersistence","Starting transaction:",e);const r=new Ol(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return $i.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class Ol extends Yi{constructor(e){super(),this.currentSequenceNumber=e}}class Nl{constructor(e){this.persistence=e,this.Ri=new Il,this.Vi=null}static mi(e){return new Nl(e)}get fi(){if(this.Vi)return this.Vi;throw ai(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),$i.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),$i.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),$i.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $i.forEach(this.fi,n=>{const r=Li.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,Wi.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return $i.or([()=>$i.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Pl{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=vc(),r=vc();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Pl(e,t.fromCache,n,r)}}class xl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Dl{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=k()?8:Zi(T())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ys(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ws(e,t,r,n).next(e=>{s.result=e})}).next(()=>{if(s.result)return;const n=new xl;return this.Ss(e,t,n).next(r=>{if(s.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>s.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(ni()<=K.DEBUG&&ri("QueryEngine","SDK will not create cache indexes for query:",rc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),$i.resolve()):(ni()<=K.DEBUG&&ri("QueryEngine","Query:",rc(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(ni()<=K.DEBUG&&ri("QueryEngine","The SDK decides to create cache indexes for query:",rc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$a(t))):$i.resolve())}ys(e,t){if(Ja(t))return $i.resolve(null);let n=$a(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=ec(t,null,"F"),n=$a(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const s=vc(...r);return this.ps.getDocuments(e,s).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.Ds(t,r);return this.Cs(t,i,s,n.readTime)?this.ys(e,ec(t,null,"F")):this.vs(e,i,t,n)}))})))}ws(e,t,n,r){return Ja(t)||r.isEqual(Wi.min())?$i.resolve(null):this.ps.getDocuments(e,n).next(s=>{const i=this.Ds(t,s);return this.Cs(t,i,n,r)?$i.resolve(null):(ni()<=K.DEBUG&&ri("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rc(t)),this.vs(e,i,t,Gi(r,Ki)).next(e=>e))})}Ds(e,t){let n=new Lo(ic(e));return t.forEach((t,r)=>{sc(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,n){return ni()<=K.DEBUG&&ri("QueryEngine","Using full collection scan to execute query:",rc(t)),this.ps.getDocumentsMatchingQuery(e,t,Ji.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const Ll="LocalStore";class Ml{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Po(Si),this.xs=new ac(e=>Wa(e),Ka),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wl(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Ul(e,t,n,r){return new Ml(e,t,n,r)}async function Vl(e,t){const n=ui(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(s=>(r=s,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],i=[];let o=vc();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:s,addedBatchIds:i}))})})}class jl{constructor(){this.activeTargetIds=wc()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fl{constructor(){this.Mo=new jl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new jl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Bl{Oo(e){}shutdown(){}}const ql="ConnectivityMonitor";class Hl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ri(ql,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ri(ql,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Wl=null;function Kl(){return null===Wl?Wl=268435456+Math.round(2147483648*Math.random()):Wl++,"0x"+Wl.toString(16)}const zl="RestConnection",Gl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xl{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===Yo?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Go(e,t,n,r,s){const i=Kl(),o=this.zo(e,t.toUriEncodedString());ri(zl,"Sending RPC '".concat(e,"' ").concat(i,":"),o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,s);const{host:c}=new URL(o),l=_(c);return this.Jo(e,o,a,n,l).then(t=>(ri(zl,"Received RPC '".concat(e,"' ").concat(i,": "),t),t),t=>{throw ii(zl,"RPC '".concat(e,"' ").concat(i," failed with error: "),t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,s,i){return this.Go(e,t,n,r,s)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ei,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=Gl[e];return"".concat(this.Uo,"/v1/").concat(t,":").concat(n)}terminate(){}}class Jl{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ql="WebChannelConnection";class Yl extends Xl{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,s){const i=Kl();return new Promise((s,o)=>{const a=new Bs;a.setWithCredentials(!0),a.listenOnce(Hs.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Ws.NO_ERROR:const n=a.getResponseJson();ri(Ql,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(n)),s(n);break;case Ws.TIMEOUT:ri(Ql,"RPC '".concat(e,"' ").concat(i," timed out")),o(new di(hi.DEADLINE_EXCEEDED,"Request time out"));break;case Ws.HTTP_ERROR:const r=a.getStatus();if(ri(Ql,"RPC '".concat(e,"' ").concat(i," failed with status:"),r,"response text:",a.getResponseText()),r>0){var t;let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const n=null===(t=e)||void 0===t?void 0:t.error;if(n&&n.status&&n.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(hi).indexOf(t)>=0?t:hi.UNKNOWN}(n.status);o(new di(e,n.message))}else o(new di(hi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new di(hi.UNAVAILABLE,"Connection failed."));break;default:ai(9055,{l_:e,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{ri(Ql,"RPC '".concat(e,"' ").concat(i," completed."))}});const c=JSON.stringify(r);ri(Ql,"RPC '".concat(e,"' ").concat(i," sending request:"),r),a.send(t,"POST",c,n,15)})}T_(e,t,n){const r=Kl(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Xs(),o=Gs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=s.join("");ri(Ql,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(l),a);const u=i.createWebChannel(l,a);this.I_(u);let h=!1,d=!1;const f=new Jl({Yo:t=>{d?ri(Ql,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(ri(Ql,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),u.open(),h=!0),ri(Ql,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,qs.EventType.OPEN,()=>{d||(ri(Ql,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),f.o_())}),p(u,qs.EventType.CLOSE,()=>{d||(d=!0,ri(Ql,"RPC '".concat(e,"' stream ").concat(r," transport closed")),f.a_(),this.E_(u))}),p(u,qs.EventType.ERROR,t=>{d||(d=!0,ii(Ql,"RPC '".concat(e,"' stream ").concat(r," transport errored. Name:"),t.name,"Message:",t.message),f.a_(new di(hi.UNAVAILABLE,"The operation could not be completed")))}),p(u,qs.EventType.MESSAGE,t=>{if(!d){var n;const s=t.data[0];li(!!s,16349);const i=s,o=(null===i||void 0===i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){ri(Ql,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);const t=o.status;let n=function(e){const t=Jc[e];if(void 0!==t)return Yc(t)}(t),s=o.message;void 0===n&&(n=hi.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.a_(new di(n,s)),u.close()}else ri(Ql,"RPC '".concat(e,"' stream ").concat(r," received:"),s),f.u_(s)}}),p(o,zs.STAT_EVENT,t=>{t.stat===Ks.PROXY?ri(Ql,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===Ks.NOPROXY&&ri(Ql,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function $l(){return"undefined"!=typeof document?document:null}function Zl(e){return new $c(e,!0)}class eu{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&ri("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}class tu{}class nu extends tu{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new di(hi.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[i,o]=s;return this.connection.Go(e,el(t,n),r,i,o)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new di(hi.UNKNOWN,e.toString())})}Ho(e,t,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[o,a]=i;return this.connection.Ho(e,el(t,n),r,o,a,s)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===hi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new di(hi.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class ru{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(si(t),this.aa=!1):ri("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const su="RemoteStore";class iu{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{cu(this)&&(ri(su,"Restarting streams for network reachability change."),await async function(e){const t=ui(e);t.Ea.add(4),await au(t),t.Ra.set("Unknown"),t.Ea.delete(4),await ou(t)}(this))})}),this.Ra=new ru(n,r)}}async function ou(e){if(cu(e))for(const t of e.da)await t(!0)}async function au(e){for(const t of e.da)await t(!1)}function cu(e){return 0===ui(e).Ea.size}async function lu(e,t){const n=ui(e);t?(n.Ea.delete(2),await ou(n)):t||(n.Ea.add(2),await au(n),n.Ra.set("Unknown"))}class uu{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new fi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new uu(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new di(hi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class hu{constructor(){this.queries=du(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=ui(e),r=n.queries;n.queries=du(),r.forEach((e,n)=>{for(const r of n.Sa)r.onError(t)})}(this,new di(hi.ABORTED,"Firestore shutting down"))}}function du(){return new ac(e=>nc(e),tc)}function fu(e){e.Ca.forEach(e=>{e.next()})}var pu,gu;(gu=pu||(pu={})).Ma="default",gu.Cache="cache";const mu="SyncEngine";class vu{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new ac(e=>nc(e),tc),this.Iu=new Map,this.Eu=new Set,this.du=new Po(Li.comparator),this.Au=new Map,this.Ru=new Il,this.Vu={},this.mu=new Map,this.fu=gl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function yu(e,t,n){const r=ui(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach((n,r)=>{const s=r.view.va(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=ui(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const s of n.Sa)s.va(t)&&(r=!0)}),r&&fu(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function wu(e,t,n){const r=ui(e),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((e,a)=>{o.push(r.pu(a,t,n).then(e=>{if((e||n)&&r.isPrimaryClient){var t;const s=e?!e.fromCache:null===n||void 0===n||null===(t=n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=Pl.As(a.targetId,e);i.push(t)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(e,t){const n=ui(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>$i.forEach(t,t=>$i.forEach(t.Es,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>$i.forEach(t.ds,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!eo(e))throw e;ri(Ll,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ms.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(e,s)}}}(r.localStore,i))}async function _u(e,t){const n=ui(e);if(!n.currentUser.isEqual(t)){ri(mu,"User change. New user:",t.toKey());const e=await Vl(n.localStore,t);n.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new di(hi.CANCELLED,t))})}),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await wu(n,e.Ls)}}class bu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Zl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Ul(this.persistence,new Dl,e.initialUser,this.serializer)}Cu(e){return new Rl(Nl.mi,this.serializer)}Du(e){return new Fl}async terminate(){var e,t;null!==(e=this.gcScheduler)&&void 0!==e&&e.stop(),null!==(t=this.indexBackfillerScheduler)&&void 0!==t&&t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bu.provider={build:()=>new bu};class Eu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>yu(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=_u.bind(null,this.syncEngine),await lu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hu}createDatastore(e){const t=Zl(e.databaseInfo.databaseId),n=function(e){return new Yl(e)}(e.databaseInfo);return function(e,t,n,r){return new nu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new iu(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,e=>yu(this.syncEngine,e,0),Hl.v()?new Hl:new Bl)}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new vu(e,t,n,r,s,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=ui(e);ri(su,"RemoteStore shutting down."),t.Ea.add(5),await au(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),null!==(e=this.datastore)&&void 0!==e&&e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Eu.provider={build:()=>new Eu};function Iu(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Su=new Map,Tu="firestore.googleapis.com",Au=!0;class ku{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new di(hi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Tu,this.ssl=Au}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Au;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=fl;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<ml)throw new di(hi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new di(hi.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Iu(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new di(hi.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new di(hi.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new di(hi.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cu{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ku({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new di(hi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new di(hi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ku(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new gi;switch(e.type){case"firstParty":return new wi(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new di(hi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Su.get(e);t&&(ri("ComponentProvider","Removing Datastore"),Su.delete(e),t.terminate())}(this),Promise.resolve()}}function Ru(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Vi(e,Cu);const s=_(t),i=e._getSettings(),o=c(c({},i),{},{emulatorOptions:e._getEmulatorOptions()}),a="".concat(t,":").concat(n);s&&(b("https://".concat(a)),S("Firestore",!0)),i.host!==Tu&&i.host!==a&&ii("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=c(c({},i),{},{host:a,ssl:s,emulatorOptions:r});if(!P(l,o)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Zs.MOCK_USER;else{var u;t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=c({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[d(JSON.stringify({alg:"none",type:"JWT"})),d(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(u=e._app)||void 0===u?void 0:u.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new di(hi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Zs(s)}e._authCredentials=new mi(new pi(t,n))}}class Ou{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ou(this.firestore,e,this._query)}}class Nu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Nu(this.firestore,e,this._key)}toJSON(){return{type:Nu._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Fi(t,Nu._jsonSchema))return new Nu(e,n||null,new Li(Pi.fromString(t.referencePath)))}}Nu._jsonSchemaVersion="firestore/documentReference/1.0",Nu._jsonSchema={type:ji("string",Nu._jsonSchemaVersion),referencePath:ji("string")};class Pu extends Ou{constructor(e,t,n){super(e,t,Xa(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Nu(this.firestore,null,new Li(e))}withConverter(e){return new Pu(this.firestore,e,this._path)}}const xu="AsyncQueue";class Du{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new eu(this,"async_queue_retry"),this._c=()=>{const e=$l();e&&ri(xu,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=$l();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=$l();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new fi;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!eo(e))throw e;ri(xu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,si("INTERNAL UNHANDLED ERROR: ",Lu(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=uu.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&ai(47125,{Pc:Lu(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Lu(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Mu extends Cu{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Du,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Du(e),this._firestoreClient=void 0,await e}}}class Uu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Uu(jo.fromBase64String(e))}catch(e){throw new di(hi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Uu(jo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Uu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Fi(e,Uu._jsonSchema))return Uu.fromBase64String(e.bytes)}}Uu._jsonSchemaVersion="firestore/bytes/1.0",Uu._jsonSchema={type:ji("string",Uu._jsonSchemaVersion),bytes:ji("string")};class Vu{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new di(hi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Di(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ju{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new di(hi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new di(hi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Si(this._lat,e._lat)||Si(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ju._jsonSchemaVersion}}static fromJSON(e){if(Fi(e,ju._jsonSchema))return new ju(e.latitude,e.longitude)}}ju._jsonSchemaVersion="firestore/geoPoint/1.0",ju._jsonSchema={type:ji("string",ju._jsonSchemaVersion),latitude:ji("number"),longitude:ji("number")};class Fu{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Fu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Fi(e,Fu._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Fu(e.vectorValues);throw new di(hi.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Fu._jsonSchemaVersion="firestore/vectorValue/1.0",Fu._jsonSchema={type:ji("string",Fu._jsonSchemaVersion),vectorValues:ji("object")};const Bu=new RegExp("[~\\*/\\[\\]]");function qu(e,t,n){if(t.search(Bu)>=0)throw Hu("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new Vu(...t.split("."))._internalPath}catch(r){throw Hu("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Hu(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a="Function ".concat(t,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(s)),c+=")"),new di(hi.INVALID_ARGUMENT,a+e+c)}class Wu{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Nu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ku(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(zu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ku extends Wu{data(){return super.data()}}function zu(e,t){return"string"==typeof t?qu(e,t):t instanceof Vu?t._internalPath:t._delegate._internalPath}class Gu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xu extends Wu{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Ju(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(zu("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new di(hi.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Xu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Xu._jsonSchemaVersion="firestore/documentSnapshot/1.0",Xu._jsonSchema={type:ji("string",Xu._jsonSchemaVersion),bundleSource:ji("string","DocumentSnapshot"),bundleName:ji("string"),bundle:ji("string")};class Ju extends Xu{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Qu{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Gu(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Ju(this._firestore,this._userDataWriter,n.key,n,new Gu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new di(hi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Ju(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Gu(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Ju(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Gu(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Yu(t.type),doc:r,oldIndex:s,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new di(hi.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Qu._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ii.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Yu(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ai(61501,{type:e})}}Qu._jsonSchemaVersion="firestore/querySnapshot/1.0",Qu._jsonSchema={type:ji("string",Qu._jsonSchemaVersion),bundleSource:ji("string","QuerySnapshot"),bundleName:ji("string"),bundle:ji("string")};new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){ei=e}(et),Je(new F("firestore",(e,n)=>{let{instanceIdentifier:r,options:s}=n;const i=e.getProvider("app").getImmediate(),o=new Mu(new vi(e.getProvider("auth-internal")),new bi(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new di(hi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $o(e.options.projectId,t)}(i,r),i);return s=c({useFetchStreams:t},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),rt(Ys,$s,e),rt(Ys,$s,"esm2020")}();const $u=tt({apiKey:"AIzaSyARejpqxkZ93sHesMHa0UtS22ZfrwMtHeQ",authDomain:"chatbot-app-40e20.firebaseapp.com",projectId:"chatbot-app-40e20",storageBucket:"chatbot-app-40e20.appspot.com",messagingSenderId:"328659930938",appId:"1:328659930938:web:2372ae540b69222e314a03"});(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt();const t=Qe(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Qe(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(P(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Et(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Ns,persistence:[Br,br,Ar]}),r=y("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(s=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ls)return;const r=null===t||void 0===t?void 0:t.token;Ms!==r&&(Ms=r,await fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){j(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){j(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var s;const i=m("auth");i&&Wn(n,"http://".concat(i))})($u),function(e,t){const n="object"==typeof e?e:nt(),r="string"==typeof e?e:t||Yo,s=Qe(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const e=(e=>{const t=m(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})("firestore");e&&Ru(s,...e)}}($u),new ar;n(579);function Zu(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n}function eh(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}let th=function(){const{crypto:e}=globalThis;if(null!==e&&void 0!==e&&e.randomUUID)return th=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^n()&15>>+e/4).toString(16))};function nh(e){return"object"===typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const rh=e=>{if(e instanceof Error)return e;if("object"===typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(t){}try{return new Error(JSON.stringify(e))}catch(n){}}return new Error(e)};class sh extends Error{}class ih extends sh{constructor(e,t,n,r){super("".concat(ih.makeMessage(e,t,n))),this.status=e,this.headers=r,this.requestID=null===r||void 0===r?void 0:r.get("x-request-id"),this.error=t;const s=t;this.code=null===s||void 0===s?void 0:s.code,this.param=null===s||void 0===s?void 0:s.param,this.type=null===s||void 0===s?void 0:s.type}static makeMessage(e,t,n){const r=null!==t&&void 0!==t&&t.message?"string"===typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?"".concat(e," ").concat(r):e?"".concat(e," status code (no body)"):r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new ah({message:n,cause:rh(t)});const s=null===t||void 0===t?void 0:t.error;return 400===e?new lh(e,s,n,r):401===e?new uh(e,s,n,r):403===e?new hh(e,s,n,r):404===e?new dh(e,s,n,r):409===e?new fh(e,s,n,r):422===e?new ph(e,s,n,r):429===e?new gh(e,s,n,r):e>=500?new mh(e,s,n,r):new ih(e,s,n,r)}}class oh extends ih{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(void 0,void 0,e||"Request was aborted.",void 0)}}class ah extends ih{constructor(e){let{message:t,cause:n}=e;super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class ch extends ah{constructor(){let{message:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({message:null!==e&&void 0!==e?e:"Request timed out."})}}class lh extends ih{}class uh extends ih{}class hh extends ih{}class dh extends ih{}class fh extends ih{}class ph extends ih{}class gh extends ih{}class mh extends ih{}class vh extends sh{constructor(){super("Could not parse response content as the length limit was reached")}}class yh extends sh{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class wh extends Error{constructor(e){super(e)}}const _h=/^[a-z][a-z0-9+.-]*:/i;let bh=e=>(bh=Array.isArray,bh(e)),Eh=bh;function Ih(e){return"object"!==typeof e?{}:null!==e&&void 0!==e?e:{}}function Sh(e){return null!=e&&"object"===typeof e&&!Array.isArray(e)}const Th=e=>new Promise(t=>setTimeout(t,e)),Ah="6.9.1";const kh=()=>{const e="undefined"!==typeof Deno&&null!=Deno.build?"deno":"undefined"!==typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call("undefined"!==typeof globalThis.process?globalThis.process:0)?"node":"unknown";var t,n,r,s,i;if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ah,"X-Stainless-OS":Rh(Deno.build.os),"X-Stainless-Arch":Ch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"===typeof Deno.version?Deno.version:null!==(t=null===(n=Deno.version)||void 0===n?void 0:n.deno)&&void 0!==t?t:"unknown"};if("undefined"!==typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ah,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:".concat(EdgeRuntime),"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ah,"X-Stainless-OS":Rh(null!==(r=globalThis.process.platform)&&void 0!==r?r:"unknown"),"X-Stainless-Arch":Ch(null!==(s=globalThis.process.arch)&&void 0!==s?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!==(i=globalThis.process.version)&&void 0!==i?i:"unknown"};const o=function(){if("undefined"===typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){const n=e[1]||0,r=e[2]||0,s=e[3]||0;return{browser:t,version:"".concat(n,".").concat(r,".").concat(s)}}}return null}();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ah,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"browser:".concat(o.browser),"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ah,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const Ch=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?"other:".concat(e):"unknown",Rh=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?"Other:".concat(e):"Unknown";let Oh;function Nh(){const e=globalThis.ReadableStream;if("undefined"===typeof e)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new e(...n)}function Ph(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Nh({start(){},async pull(e){const{done:n,value:r}=await t.next();n?e.close():e.enqueue(r)},async cancel(){var e;await(null===(e=t.return)||void 0===e?void 0:e.call(t))}})}function xh(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return null!==e&&void 0!==e&&e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Dh=e=>{let{headers:t,body:n}=e;return{bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(n)}},Lh="RFC3986",Mh=e=>String(e),Uh={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:Mh},Vh="RFC1738";let jh=(e,t)=>{var n;return jh=null!==(n=Object.hasOwn)&&void 0!==n?n:Function.prototype.call.bind(Object.prototype.hasOwnProperty),jh(e,t)};const Fh=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();const Bh=1024;function qh(e,t){if(bh(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const Hh={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},Wh=function(e,t){Array.prototype.push.apply(e,bh(t)?t:[t])};let Kh;const zh={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,r,s)=>{if(0===e.length)return e;let i=e;if("symbol"===typeof e?i=Symbol.prototype.toString.call(e):"string"!==typeof e&&(i=String(e)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let o="";for(let a=0;a<i.length;a+=Bh){const e=i.length>=Bh?i.slice(a,a+Bh):i,t=[];for(let n=0;n<e.length;++n){let r=e.charCodeAt(n);45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||s===Vh&&(40===r||41===r)?t[t.length]=e.charAt(n):r<128?t[t.length]=Fh[r]:r<2048?t[t.length]=Fh[192|r>>6]+Fh[128|63&r]:r<55296||r>=57344?t[t.length]=Fh[224|r>>12]+Fh[128|r>>6&63]+Fh[128|63&r]:(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t[t.length]=Fh[240|r>>18]+Fh[128|r>>12&63]+Fh[128|r>>6&63]+Fh[128|63&r])}o+=t.join("")}return o},encodeValuesOnly:!1,format:Lh,formatter:Mh,indices:!1,serializeDate:e=>(null!==Kh&&void 0!==Kh?Kh:Kh=Function.prototype.call.bind(Date.prototype.toISOString))(e),skipNulls:!1,strictNullHandling:!1};const Gh={};function Xh(e,t,n,r,s,i,o,a,c,l,u,h,d,f,p,g,m,v){let y=e,w=v,_=0,b=!1;for(;void 0!==(w=w.get(Gh))&&!b;){const t=w.get(e);if(_+=1,"undefined"!==typeof t){if(t===_)throw new RangeError("Cyclic object value");b=!0}"undefined"===typeof w.get(Gh)&&(_=0)}if("function"===typeof l?y=l(t,y):y instanceof Date?y=null===d||void 0===d?void 0:d(y):"comma"===n&&bh(y)&&(y=qh(y,function(e){return e instanceof Date?null===d||void 0===d?void 0:d(e):e})),null===y){if(i)return c&&!g?c(t,zh.encoder,m,"key",f):t;y=""}if("string"===typeof(E=y)||"number"===typeof E||"boolean"===typeof E||"symbol"===typeof E||"bigint"===typeof E||function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}(y)){if(c){const e=g?t:c(t,zh.encoder,m,"key",f);return[(null===p||void 0===p?void 0:p(e))+"="+(null===p||void 0===p?void 0:p(c(y,zh.encoder,m,"value",f)))]}return[(null===p||void 0===p?void 0:p(t))+"="+(null===p||void 0===p?void 0:p(String(y)))]}var E;const I=[];if("undefined"===typeof y)return I;let S;if("comma"===n&&bh(y))g&&c&&(y=qh(y,c)),S=[{value:y.length>0?y.join(",")||null:void 0}];else if(bh(l))S=l;else{const e=Object.keys(y);S=u?e.sort(u):e}const T=a?String(t).replace(/\./g,"%2E"):String(t),A=r&&bh(y)&&1===y.length?T+"[]":T;if(s&&bh(y)&&0===y.length)return A+"[]";for(let k=0;k<S.length;++k){const t=S[k],w="object"===typeof t&&"undefined"!==typeof t.value?t.value:y[t];if(o&&null===w)continue;const b=h&&a?t.replace(/\./g,"%2E"):t,E=bh(y)?"function"===typeof n?n(A,b):A:A+(h?"."+b:"["+b+"]");v.set(e,_);const T=new WeakMap;T.set(Gh,v),Wh(I,Xh(w,E,n,r,s,i,o,a,"comma"===n&&g&&bh(y)?null:c,l,u,h,d,f,p,g,m,T))}return I}function Jh(e){let t=e;const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zh;if("undefined"!==typeof e.allowEmptyArrays&&"boolean"!==typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if("undefined"!==typeof e.encodeDotInKeys&&"boolean"!==typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||zh.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Lh;if("undefined"!==typeof e.format){if(!jh(Uh,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=Uh[n];let s,i=zh.filter;if(("function"===typeof e.filter||bh(e.filter))&&(i=e.filter),s=e.arrayFormat&&e.arrayFormat in Hh?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":zh.arrayFormat,"commaRoundTrip"in e&&"boolean"!==typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o="undefined"===typeof e.allowDots?!0===!!e.encodeDotInKeys||zh.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:zh.addQueryPrefix,allowDots:o,allowEmptyArrays:"boolean"===typeof e.allowEmptyArrays?!!e.allowEmptyArrays:zh.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:zh.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:"undefined"===typeof e.delimiter?zh.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:zh.encode,encodeDotInKeys:"boolean"===typeof e.encodeDotInKeys?e.encodeDotInKeys:zh.encodeDotInKeys,encoder:"function"===typeof e.encoder?e.encoder:zh.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:zh.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:zh.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:zh.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:zh.strictNullHandling}}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});let r,s;"function"===typeof n.filter?(s=n.filter,t=s("",t)):bh(n.filter)&&(s=n.filter,r=s);const i=[];if("object"!==typeof t||null===t)return"";const o=Hh[n.arrayFormat],a="comma"===o&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const c=new WeakMap;for(let h=0;h<r.length;++h){const e=r[h];n.skipNulls&&null===t[e]||Wh(i,Xh(t[e],e,o,a,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const l=i.join(n.delimiter);let u=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),l.length>0?u+l:""}function Qh(e){var t,n,r,s=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);s--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Yh(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Yh(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Yh=function(e){this.s=e,this.n=e.next},Yh.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Yh(e)}function $h(e,t){this.v=e,this.k=t}function Zh(e){return new $h(e,0)}function ed(e){return function(){return new td(e.apply(this,arguments))}}function td(e){var t,n;function r(t,n){try{var i=e[t](n),o=i.value,a=o instanceof $h;Promise.resolve(a?o.v:o).then(function(n){if(a){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}s(i.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){s("throw",e)}}function s(e,s){switch(e){case"return":t.resolve({value:s,done:!0});break;case"throw":t.reject(s);break;default:t.resolve({value:s,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,s){return new Promise(function(i,o){var a={key:e,arg:s,resolve:i,reject:o,next:null};n?n=n.next=a:(t=n=a,r(e,s))})},"function"!=typeof e.return&&(this.return=void 0)}let nd,rd;function sd(e){let t;return(null!==nd&&void 0!==nd?nd:(t=new globalThis.TextEncoder,nd=t.encode.bind(t)))(e)}function id(e){let t;return(null!==rd&&void 0!==rd?rd:(t=new globalThis.TextDecoder,rd=t.decode.bind(t)))(e)}var od,ad;td.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},td.prototype.next=function(e){return this._invoke("next",e)},td.prototype.throw=function(e){return this._invoke("throw",e)},td.prototype.return=function(e){return this._invoke("return",e)};class cd{constructor(){od.set(this,void 0),ad.set(this,void 0),Zu(this,od,new Uint8Array,"f"),Zu(this,ad,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"===typeof e?sd(e):e;Zu(this,od,function(e){let t=0;for(const s of e)t+=s.length;const n=new Uint8Array(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return n}([eh(this,od,"f"),t]),"f");const n=[];let r;for(;null!=(r=ld(eh(this,od,"f"),eh(this,ad,"f")));){if(r.carriage&&null==eh(this,ad,"f")){Zu(this,ad,r.index,"f");continue}if(null!=eh(this,ad,"f")&&(r.index!==eh(this,ad,"f")+1||r.carriage)){n.push(id(eh(this,od,"f").subarray(0,eh(this,ad,"f")-1))),Zu(this,od,eh(this,od,"f").subarray(eh(this,ad,"f")),"f"),Zu(this,ad,null,"f");continue}const e=null!==eh(this,ad,"f")?r.preceding-1:r.preceding,t=id(eh(this,od,"f").subarray(0,e));n.push(t),Zu(this,od,eh(this,od,"f").subarray(r.index),"f"),Zu(this,ad,null,"f")}return n}flush(){return eh(this,od,"f").length?this.decode("\n"):[]}}function ld(e,t){for(let n=null!==t&&void 0!==t?t:0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function ud(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}od=new WeakMap,ad=new WeakMap,cd.NEWLINE_CHARS=new Set(["\n","\r"]),cd.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const hd={off:0,error:200,warn:300,info:400,debug:500},dd=(e,t,n)=>{var r,s;if(e)return r=hd,s=e,Object.prototype.hasOwnProperty.call(r,s)?e:void vd(n).warn("".concat(t," was set to ").concat(JSON.stringify(e),", expected one of ").concat(JSON.stringify(Object.keys(hd))))};function fd(){}function pd(e,t,n){return!t||hd[e]>hd[n]?fd:t[e].bind(t)}const gd={error:fd,warn:fd,info:fd,debug:fd};let md=new WeakMap;function vd(e){var t;const n=e.logger,r=null!==(t=e.logLevel)&&void 0!==t?t:"off";if(!n)return gd;const s=md.get(n);if(s&&s[0]===r)return s[1];const i={error:pd("error",n,r),warn:pd("warn",n,r),info:pd("info",n,r),debug:pd("debug",n,r)};return md.set(n,[r,i]),i}const yd=e=>(e.options&&(e.options=c({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(e=>{let[t,n]=e;return[t,"authorization"===t.toLowerCase()||"cookie"===t.toLowerCase()||"set-cookie"===t.toLowerCase()?"***":n]}))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);var wd,_d,bd;class Ed{constructor(e,t,n){this.iterator=e,wd.set(this,void 0),this.controller=t,Zu(this,wd,n,"f")}static fromSSEResponse(e,t,n){let r=!1;const s=n?vd(n):console;function i(){return i=ed(function*(){if(r)throw new sh("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{var i,o=!1,a=!1;try{for(var c,l=Qh(function(e,t){return Id.apply(this,arguments)}(e,t));o=!(c=yield Zh(l.next())).done;o=!1){const t=c.value;if(!n)if(t.data.startsWith("[DONE]"))n=!0;else if(null!==t.event&&t.event.startsWith("thread.")){let e;try{e=JSON.parse(t.data)}catch(u){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),u}if("error"==t.event)throw new ih(void 0,e.error,e.message,void 0);yield{event:t.event,data:e}}else{let n;try{n=JSON.parse(t.data)}catch(u){throw s.error("Could not parse message into JSON:",t.data),s.error("From chunk:",t.raw),u}if(n&&n.error)throw new ih(void 0,n.error,void 0,e.headers);yield n}}}catch(h){a=!0,i=h}finally{try{o&&null!=l.return&&(yield Zh(l.return()))}finally{if(a)throw i}}n=!0}catch(u){if(nh(u))return;throw u}finally{n||t.abort()}}),i.apply(this,arguments)}return new Ed(function(){return i.apply(this,arguments)},t,n)}static fromReadableStream(e,t,n){let r=!1;function s(){return(s=ed(function*(){const t=new cd,n=xh(e);var r,s=!1,i=!1;try{for(var o,a=Qh(n);s=!(o=yield Zh(a.next())).done;s=!1){const e=o.value;for(const n of t.decode(e))yield n}}catch(c){i=!0,r=c}finally{try{s&&null!=a.return&&(yield Zh(a.return()))}finally{if(i)throw r}}for(const e of t.flush())yield e})).apply(this,arguments)}function i(){return i=ed(function*(){if(r)throw new sh("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{var n,i=!1,o=!1;try{for(var a,c=Qh(function(){return s.apply(this,arguments)}());i=!(a=yield Zh(c.next())).done;i=!1){const t=a.value;e||t&&(yield JSON.parse(t))}}catch(l){o=!0,n=l}finally{try{i&&null!=c.return&&(yield Zh(c.return()))}finally{if(o)throw n}}e=!0}catch(u){if(nh(u))return;throw u}finally{e||t.abort()}}),i.apply(this,arguments)}return new Ed(function(){return i.apply(this,arguments)},t,n)}[(wd=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){const r=n.next();e.push(r),t.push(r)}return r.shift()}});return[new Ed(()=>r(e),this.controller,eh(this,wd,"f")),new Ed(()=>r(t),this.controller,eh(this,wd,"f"))]}toReadableStream(){const e=this;let t;return Nh({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const s=sd(JSON.stringify(n)+"\n");e.enqueue(s)}catch(n){e.error(n)}},async cancel(){var e,n;await(null===(e=(n=t).return)||void 0===e?void 0:e.call(n))}})}}function Id(){return Id=ed(function*(e,t){if(!e.body){if(t.abort(),"undefined"!==typeof globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new sh("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new sh("Attempted to iterate over a response with no body")}const n=new Td,r=new cd,s=xh(e.body);var i,o=!1,a=!1;try{for(var c,l=Qh(function(e){return Sd.apply(this,arguments)}(s));o=!(c=yield Zh(l.next())).done;o=!1){const e=c.value;for(const t of r.decode(e)){const e=n.decode(t);e&&(yield e)}}}catch(u){a=!0,i=u}finally{try{o&&null!=l.return&&(yield Zh(l.return()))}finally{if(a)throw i}}for(const h of r.flush()){const e=n.decode(h);e&&(yield e)}}),Id.apply(this,arguments)}function Sd(){return(Sd=ed(function*(e){let t=new Uint8Array;var n,r=!1,s=!1;try{for(var i,o=Qh(e);r=!(i=yield Zh(o.next())).done;r=!1){const e=i.value;{if(null==e)continue;const n=e instanceof ArrayBuffer?new Uint8Array(e):"string"===typeof e?sd(e):e;let r,s=new Uint8Array(t.length+n.length);for(s.set(t),s.set(n,t.length),t=s;-1!==(r=ud(t));)yield t.slice(0,r),t=t.slice(r)}}}catch(a){s=!0,n=a}finally{try{r&&null!=o.return&&(yield Zh(o.return()))}finally{if(s)throw n}}t.length>0&&(yield t)})).apply(this,arguments)}class Td{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===t?this.event=r:"data"===t&&this.data.push(r),null}}async function Ad(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:s,startTime:i}=t,o=await(async r=>{if(t.options.stream)return vd(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller,e):Ed.fromSSEResponse(n,t.controller,e);if(204===n.status)return null;if(t.options.__binaryResponse)return n;const s=n.headers.get("content-type"),i=null===s||void 0===s||null===(r=s.split(";")[0])||void 0===r?void 0:r.trim();if((null===i||void 0===i?void 0:i.includes("application/json"))||(null===i||void 0===i?void 0:i.endsWith("+json"))){return kd(await n.json(),n)}return await n.text()})();return vd(e).debug("[".concat(r,"] response parsed"),yd({retryOfRequestLogID:s,url:n.url,status:n.status,body:o,durationMs:Date.now()-i})),o}function kd(e,t){return!e||"object"!==typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Cd extends Promise{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ad;super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=n,_d.set(this,void 0),Zu(this,_d,e,"f")}_thenUnwrap(e){return new Cd(eh(this,_d,"f"),this.responsePromise,async(t,n)=>kd(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eh(this,_d,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}_d=new WeakMap;class Rd{constructor(e,t,n,r){bd.set(this,void 0),Zu(this,bd,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new sh("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eh(this,bd,"f").requestAPIList(this.constructor,e)}iterPages(){var e=this;return ed(function*(){let t=e;for(yield t;t.hasNextPage();)t=yield Zh(t.getNextPage()),yield t})()}[(bd=new WeakMap,Symbol.asyncIterator)](){var e=this;return ed(function*(){var t,n=!1,r=!1;try{for(var s,i=Qh(e.iterPages());n=!(s=yield Zh(i.next())).done;n=!1){const e=s.value;for(const t of e.getPaginatedItems())yield t}}catch(o){r=!0,t=o}finally{try{n&&null!=i.return&&(yield Zh(i.return()))}finally{if(r)throw t}}})()}}class Od extends Cd{constructor(e,t,n){super(e,t,async(e,t)=>new n(e,t.response,await Ad(e,t),t.options))}[Symbol.asyncIterator](){var e=this;return ed(function*(){const t=yield Zh(e);var n,r=!1,s=!1;try{for(var i,o=Qh(t);r=!(i=yield Zh(o.next())).done;r=!1){const e=i.value;yield e}}catch(a){s=!0,n=a}finally{try{r&&null!=o.return&&(yield Zh(o.return()))}finally{if(s)throw n}}})()}}class Nd extends Rd{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){var e;return null!==(e=this.data)&&void 0!==e?e:[]}nextPageRequestOptions(){return null}}class Pd extends Rd{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){var e;return null!==(e=this.data)&&void 0!==e?e:[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;const t=this.getPaginatedItems(),n=null===(e=t[t.length-1])||void 0===e?void 0:e.id;return n?c(c({},this.options),{},{query:c(c({},Ih(this.options.query)),{},{after:n})}):null}}class xd extends Rd{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){var e;return null!==(e=this.data)&&void 0!==e?e:[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?c(c({},this.options),{},{query:c(c({},Ih(this.options.query)),{},{after:e})}):null}}const Dd=()=>{if("undefined"===typeof File){var e;const{process:t}=globalThis,n="string"===typeof(null===t||void 0===t||null===(e=t.versions)||void 0===e?void 0:e.node)&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Ld(e,t,n){return Dd(),new File(e,null!==t&&void 0!==t?t:"unknown_file",n)}function Md(e){return("object"===typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const Ud=e=>null!=e&&"object"===typeof e&&"function"===typeof e[Symbol.asyncIterator],Vd=async(e,t)=>Hd(e.body)?c(c({},e),{},{body:await Bd(e.body,t)}):e,jd=async(e,t)=>c(c({},e),{},{body:await Bd(e.body,t)}),Fd=new WeakMap;const Bd=async(e,t)=>{if(!await function(e){const t="function"===typeof e?e:e.fetch,n=Fd.get(t);if(n)return n;const r=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,n=new FormData;return n.toString()!==await new e(n).text()}catch(e){return!0}})();return Fd.set(t,r),r}(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(e=>{let[t,r]=e;return Wd(n,t,r)})),n},qd=e=>e instanceof Blob&&"name"in e,Hd=e=>{if((e=>"object"===typeof e&&null!==e&&(e instanceof Response||Ud(e)||qd(e)))(e))return!0;if(Array.isArray(e))return e.some(Hd);if(e&&"object"===typeof e)for(const t in e)if(Hd(e[t]))return!0;return!1},Wd=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError('Received null for "'.concat(t,"\"; to pass null in FormData, you must use the string 'null'"));if("string"===typeof n||"number"===typeof n||"boolean"===typeof n)e.append(t,String(n));else if(n instanceof Response)e.append(t,Ld([await n.blob()],Md(n)));else if(Ud(n))e.append(t,Ld([await new Response(Ph(n)).blob()],Md(n)));else if(qd(n))e.append(t,n,Md(n));else if(Array.isArray(n))await Promise.all(n.map(n=>Wd(e,t+"[]",n)));else{if("object"!==typeof n)throw new TypeError("Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ".concat(n," instead"));await Promise.all(Object.entries(n).map(n=>{let[r,s]=n;return Wd(e,"".concat(t,"[").concat(r,"]"),s)}))}}},Kd=e=>null!=e&&"object"===typeof e&&"number"===typeof e.size&&"string"===typeof e.type&&"function"===typeof e.text&&"function"===typeof e.slice&&"function"===typeof e.arrayBuffer;async function zd(e){let t=[];if("string"===typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Kd(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!Ud(e)){var n;const t=null===e||void 0===e||null===(n=e.constructor)||void 0===n?void 0:n.name;throw new Error("Unexpected data type: ".concat(typeof e).concat(t?"; constructor: ".concat(t):"").concat(function(e){if("object"!==typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return"; props: [".concat(t.map(e=>'"'.concat(e,'"')).join(", "),"]")}(e)))}var r,s=!1,i=!1;try{for(var o,a=Qh(e);s=!(o=await a.next()).done;s=!1){const e=o.value;t.push(...await zd(e))}}catch(c){i=!0,r=c}finally{try{s&&null!=a.return&&await a.return()}finally{if(i)throw r}}}return t}class Gd{constructor(e){this._client=e}}function Xd(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function Jd(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Qd=Object.freeze(Object.create(null)),Yd=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jd;return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];if(1===t.length)return t[0];let i=!1;const o=[],a=t.reduce((t,n,s)=>{var a,c,l;/[?#]/.test(n)&&(i=!0);const u=r[s];let h=(i?encodeURIComponent:e)(""+u);return s!==r.length&&(null==u||"object"===typeof u&&u.toString===(null===(a=Object.getPrototypeOf(null!==(c=Object.getPrototypeOf(null!==(l=u.hasOwnProperty)&&void 0!==l?l:Qd))&&void 0!==c?c:Qd))||void 0===a?void 0:a.toString))&&(h=u+"",o.push({start:t.length+n.length,length:h.length,error:"Value of type ".concat(Object.prototype.toString.call(u).slice(8,-1)," is not a valid path parameter")})),t+n+(s===r.length?"":h)},""),c=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let u;for(;null!==(u=l.exec(c));)o.push({start:u.index,length:u[0].length,error:'Value "'.concat(u[0],"\" can't be safely passed as a path parameter")});if(o.sort((e,t)=>e.start-t.start),o.length>0){let e=0;const t=o.reduce((t,n)=>{const r=" ".repeat(n.start-e),s="^".repeat(n.length);return e=n.start+n.length,t+r+s},"");throw new sh("Path parameters result in path with invalid segments:\n".concat(o.map(e=>e.error).join("\n"),"\n").concat(a,"\n").concat(t))}return a}},$d=Yd(Jd);var Zd;class ef extends Gd{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Zd||(Zd=Xd(["/chat/completions/","/messages"])),e),Pd,c({query:t},n))}}function tf(e){return void 0!==e&&"function"in e&&void 0!==e.function}function nf(e){return"auto-parseable-response-format"===(null===e||void 0===e?void 0:e.$brand)}function rf(e){return"auto-parseable-tool"===(null===e||void 0===e?void 0:e.$brand)}function sf(e,t){const n=e.choices.map(e=>{var n,r;if("length"===e.finish_reason)throw new vh;if("content_filter"===e.finish_reason)throw new yh;return lf(e.message.tool_calls),c(c({},e),{},{message:c(c(c({},e.message),e.message.tool_calls?{tool_calls:null!==(n=null===(r=e.message.tool_calls)||void 0===r?void 0:r.map(e=>function(e,t){var n;const r=null===(n=e.tools)||void 0===n?void 0:n.find(e=>{var n;return tf(e)&&(null===(n=e.function)||void 0===n?void 0:n.name)===t.function.name});return c(c({},t),{},{function:c(c({},t.function),{},{parsed_arguments:rf(r)?r.$parseRaw(t.function.arguments):null!==r&&void 0!==r&&r.function.strict?JSON.parse(t.function.arguments):null})})}(t,e)))&&void 0!==n?n:void 0}:void 0),{},{parsed:e.message.content&&!e.message.refusal?of(t,e.message.content):null})})});return c(c({},e),{},{choices:n})}function of(e,t){var n,r;if("json_schema"!==(null===(n=e.response_format)||void 0===n?void 0:n.type))return null;if("json_schema"===(null===(r=e.response_format)||void 0===r?void 0:r.type)){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function af(e,t){var n;if(!e||!("tools"in e)||!e.tools)return!1;const r=null===(n=e.tools)||void 0===n?void 0:n.find(e=>{var n;return tf(e)&&(null===(n=e.function)||void 0===n?void 0:n.name)===t.function.name});return tf(r)&&(rf(r)||(null===r||void 0===r?void 0:r.function.strict)||!1)}function cf(e){var t,n;return!!nf(e.response_format)||null!==(t=null===(n=e.tools)||void 0===n?void 0:n.some(e=>rf(e)||"function"===e.type&&!0===e.function.strict))&&void 0!==t&&t}function lf(e){for(const t of e||[])if("function"!==t.type)throw new sh("Currently only `function` tool calls are supported; Received `".concat(t.type,"`"))}const uf=e=>"assistant"===(null===e||void 0===e?void 0:e.role),hf=e=>"tool"===(null===e||void 0===e?void 0:e.role);var df,ff,pf,gf,mf,vf,yf,wf,_f,bf,Ef,If,Sf;class Tf{constructor(){df.add(this),this.controller=new AbortController,ff.set(this,void 0),pf.set(this,()=>{}),gf.set(this,()=>{}),mf.set(this,void 0),vf.set(this,()=>{}),yf.set(this,()=>{}),wf.set(this,{}),_f.set(this,!1),bf.set(this,!1),Ef.set(this,!1),If.set(this,!1),Zu(this,ff,new Promise((e,t)=>{Zu(this,pf,e,"f"),Zu(this,gf,t,"f")}),"f"),Zu(this,mf,new Promise((e,t)=>{Zu(this,vf,e,"f"),Zu(this,yf,t,"f")}),"f"),eh(this,ff,"f").catch(()=>{}),eh(this,mf,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eh(this,df,"m",Sf).bind(this))},0)}_connected(){this.ended||(eh(this,pf,"f").call(this),this._emit("connect"))}get ended(){return eh(this,_f,"f")}get errored(){return eh(this,bf,"f")}get aborted(){return eh(this,Ef,"f")}abort(){this.controller.abort()}on(e,t){return(eh(this,wf,"f")[e]||(eh(this,wf,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=eh(this,wf,"f")[e];if(!n)return this;const r=n.findIndex(e=>e.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(eh(this,wf,"f")[e]||(eh(this,wf,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Zu(this,If,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}async done(){Zu(this,If,!0,"f"),await eh(this,mf,"f")}_emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(eh(this,_f,"f"))return;"end"===e&&(Zu(this,_f,!0,"f"),eh(this,vf,"f").call(this));const s=eh(this,wf,"f")[e];if(s&&(eh(this,wf,"f")[e]=s.filter(e=>!e.once),s.forEach(e=>{let{listener:t}=e;return t(...n)})),"abort"===e){const e=n[0];return eh(this,If,"f")||null!==s&&void 0!==s&&s.length||Promise.reject(e),eh(this,gf,"f").call(this,e),eh(this,yf,"f").call(this,e),void this._emit("end")}if("error"===e){const e=n[0];eh(this,If,"f")||null!==s&&void 0!==s&&s.length||Promise.reject(e),eh(this,gf,"f").call(this,e),eh(this,yf,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Af(e){return"function"===typeof e.parse}ff=new WeakMap,pf=new WeakMap,gf=new WeakMap,mf=new WeakMap,vf=new WeakMap,yf=new WeakMap,wf=new WeakMap,_f=new WeakMap,bf=new WeakMap,Ef=new WeakMap,If=new WeakMap,df=new WeakSet,Sf=function(e){if(Zu(this,bf,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new oh),e instanceof oh)return Zu(this,Ef,!0,"f"),this._emit("abort",e);if(e instanceof sh)return this._emit("error",e);if(e instanceof Error){const t=new sh(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new sh(String(e)))};const kf=["tool_choice","stream"];var Cf,Rf,Of,Nf,Pf,xf,Df,Lf;const Mf=10;class Uf extends Tf{constructor(){super(...arguments),Cf.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var t;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=null===(t=e.choices[0])||void 0===t?void 0:t.message;return n&&this._addMessage(n),e}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),hf(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(uf(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionToolCall",n.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new sh("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eh(this,Cf,"m",Rf).call(this)}async finalMessage(){return await this.done(),eh(this,Cf,"m",Of).call(this)}async finalFunctionToolCall(){return await this.done(),eh(this,Cf,"m",Nf).call(this)}async finalFunctionToolCallResult(){return await this.done(),eh(this,Cf,"m",Pf).call(this)}async totalUsage(){return await this.done(),eh(this,Cf,"m",xf).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=eh(this,Cf,"m",Of).call(this);t&&this._emit("finalMessage",t);const n=eh(this,Cf,"m",Rf).call(this);n&&this._emit("finalContent",n);const r=eh(this,Cf,"m",Nf).call(this);r&&this._emit("finalFunctionToolCall",r);const s=eh(this,Cf,"m",Pf).call(this);null!=s&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eh(this,Cf,"m",xf).call(this))}async _createChatCompletion(e,t,n){const r=null===n||void 0===n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eh(this,Cf,"m",Df).call(this,t);const s=await e.chat.completions.create(c(c({},t),{},{stream:!1}),c(c({},n),{},{signal:this.controller.signal}));return this._connected(),this._addChatCompletion(sf(s,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){var s;const i="tool",{tool_choice:o="auto",stream:a}=t,l=r(t,kf),u="string"!==typeof o&&"function"===o.type&&(null===o||void 0===o||null===(s=o.function)||void 0===s?void 0:s.name),{maxChatCompletions:h=Mf}=n||{},d=t.tools.map(e=>{if(rf(e)){if(!e.$callback)throw new sh("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),f={};for(const r of d)"function"===r.type&&(f[r.function.name||r.function.function.name]=r.function);const p="tools"in t?d.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const r of t.messages)this._addMessage(r,!1);for(let r=0;r<h;++r){var g,m;const t=null===(g=(await this._createChatCompletion(e,c(c({},l),{},{tool_choice:o,tools:p,messages:[...this.messages]}),n)).choices[0])||void 0===g?void 0:g.message;if(!t)throw new sh("missing message in ChatCompletion response");if(null===(m=t.tool_calls)||void 0===m||!m.length)return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:r}=e.function,s=f[n];if(!s){const e="Invalid tool_call: ".concat(JSON.stringify(n),". Available options are: ").concat(Object.keys(f).map(e=>JSON.stringify(e)).join(", "),". Please try again");this._addMessage({role:i,tool_call_id:t,content:e});continue}if(u&&u!==n){const e="Invalid tool_call: ".concat(JSON.stringify(n),". ").concat(JSON.stringify(u)," requested. Please try again");this._addMessage({role:i,tool_call_id:t,content:e});continue}let o;try{o=Af(s)?await s.parse(r):r}catch(v){const e=v instanceof Error?v.message:String(v);this._addMessage({role:i,tool_call_id:t,content:e});continue}const a=await s.function(o,this),c=eh(this,Cf,"m",Lf).call(this,a);if(this._addMessage({role:i,tool_call_id:t,content:c}),u)return}}}}Cf=new WeakSet,Rf=function(){var e;return null!==(e=eh(this,Cf,"m",Of).call(this).content)&&void 0!==e?e:null},Of=function(){let e=this.messages.length;for(;e-- >0;){const r=this.messages[e];if(uf(r)){var t,n;return c(c({},r),{},{content:null!==(t=r.content)&&void 0!==t?t:null,refusal:null!==(n=r.refusal)&&void 0!==n?n:null})}}throw new sh("stream ended without producing a ChatCompletionMessage with role=assistant")},Nf=function(){for(let n=this.messages.length-1;n>=0;n--){var e;const r=this.messages[n];var t;if(uf(r)&&null!==r&&void 0!==r&&null!==(e=r.tool_calls)&&void 0!==e&&e.length)return null===(t=r.tool_calls.filter(e=>"function"===e.type).at(-1))||void 0===t?void 0:t.function}},Pf=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(hf(t)&&null!=t.content&&"string"===typeof t.content&&this.messages.some(e=>{var n;return"assistant"===e.role&&(null===(n=e.tool_calls)||void 0===n?void 0:n.some(e=>"function"===e.type&&e.id===t.tool_call_id))}))return t.content}},xf=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Df=function(e){if(null!=e.n&&e.n>1)throw new sh("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Lf=function(e){return"string"===typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Vf extends Uf{static runTools(e,t,n){const r=new Vf,s=c(c({},n),{},{headers:c(c({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"runTools"})});return r._run(()=>r._runTools(e,t,s)),r}_addMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super._addMessage(e,t),uf(e)&&e.content&&this._emit("content",e.content)}}const jf={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511};class Ff extends Error{}class Bf extends Error{}const qf=(e,t)=>{const n=e.length;let r=0;const s=e=>{throw new Ff("".concat(e," at position ").concat(r))},i=e=>{throw new Bf("".concat(e," at position ").concat(r))},o=()=>(h(),r>=n&&s("Unexpected end of input"),'"'===e[r]?a():"{"===e[r]?c():"["===e[r]?l():"null"===e.substring(r,r+4)||jf.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):"true"===e.substring(r,r+4)||jf.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):"false"===e.substring(r,r+5)||jf.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):"Infinity"===e.substring(r,r+8)||jf.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):"-Infinity"===e.substring(r,r+9)||jf.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):"NaN"===e.substring(r,r+3)||jf.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):u()),a=()=>{const o=r;let a=!1;for(r++;r<n&&('"'!==e[r]||a&&"\\"===e[r-1]);)a="\\"===e[r]&&!a,r++;if('"'==e.charAt(r))try{return JSON.parse(e.substring(o,++r-Number(a)))}catch(c){i(String(c))}else if(jf.STR&t)try{return JSON.parse(e.substring(o,r-Number(a))+'"')}catch(c){return JSON.parse(e.substring(o,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,h();const i={};try{for(;"}"!==e[r];){if(h(),r>=n&&jf.OBJ&t)return i;const s=a();h(),r++;try{const e=o();Object.defineProperty(i,s,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(c){if(jf.OBJ&t)return i;throw c}h(),","===e[r]&&r++}}catch(c){if(jf.OBJ&t)return i;s("Expected '}' at end of object")}return r++,i},l=()=>{r++;const n=[];try{for(;"]"!==e[r];)n.push(o()),h(),","===e[r]&&r++}catch(i){if(jf.ARR&t)return n;s("Expected ']' at end of array")}return r++,n},u=()=>{if(0===r){"-"===e&&jf.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(a){if(jf.NUM&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(a){}i(String(a))}}const o=r;for("-"===e[r]&&r++;e[r]&&!",]}".includes(e[r]);)r++;r!=n||jf.NUM&t||s("Unterminated number literal");try{return JSON.parse(e.substring(o,r))}catch(a){"-"===e.substring(o,r)&&jf.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(o,e.lastIndexOf("e")))}catch(a){i(String(a))}}},h=()=>{for(;r<n&&" \n\r\t".includes(e[r]);)r++};return o()},Hf=e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jf.ALL;if("string"!==typeof e)throw new TypeError("expecting str, got ".concat(typeof e));if(!e.trim())throw new Error("".concat(e," is empty"));return qf(e.trim(),t)}(e,jf.ALL^jf.NUM),Wf=["choices"],Kf=["delta","finish_reason","index","logprobs"],zf=["content","refusal"],Gf=["content","refusal","function_call","role","tool_calls"],Xf=["index","id","type","function"],Jf=["id","choices","created","model","system_fingerprint"],Qf=["message","finish_reason","index","logprobs"],Yf=["content","function_call","tool_calls"],$f=["function","type","id"],Zf=["arguments","name"];var ep,tp,np,rp,sp,ip,op,ap,cp,lp,up,hp,dp,fp,pp;class gp extends Uf{constructor(e){super(),ep.add(this),tp.set(this,void 0),np.set(this,void 0),rp.set(this,void 0),Zu(this,tp,e,"f"),Zu(this,np,[],"f")}get currentChatCompletionSnapshot(){return eh(this,rp,"f")}static fromReadableStream(e){const t=new gp(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new gp(t);return r._run(()=>r._runChatCompletion(e,c(c({},t),{},{stream:!0}),c(c({},n),{},{headers:c(c({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"stream"})}))),r}async _createChatCompletion(e,t,n){var r;super._createChatCompletion;const s=null===n||void 0===n?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),eh(this,ep,"m",sp).call(this);const i=await e.chat.completions.create(c(c({},t),{},{stream:!0}),c(c({},n),{},{signal:this.controller.signal}));this._connected();var o,a=!1,l=!1;try{for(var u,h=Qh(i);a=!(u=await h.next()).done;a=!1){const e=u.value;eh(this,ep,"m",op).call(this,e)}}catch(d){l=!0,o=d}finally{try{a&&null!=h.return&&await h.return()}finally{if(l)throw o}}if(null!==(r=i.controller.signal)&&void 0!==r&&r.aborted)throw new oh;return this._addChatCompletion(eh(this,ep,"m",lp).call(this))}async _fromReadableStream(e,t){var n;const r=null===t||void 0===t?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eh(this,ep,"m",sp).call(this),this._connected();const s=Ed.fromReadableStream(e,this.controller);let i;var o,a=!1,c=!1;try{for(var l,u=Qh(s);a=!(l=await u.next()).done;a=!1){const e=l.value;i&&i!==e.id&&this._addChatCompletion(eh(this,ep,"m",lp).call(this)),eh(this,ep,"m",op).call(this,e),i=e.id}}catch(h){c=!0,o=h}finally{try{a&&null!=u.return&&await u.return()}finally{if(c)throw o}}if(null!==(n=s.controller.signal)&&void 0!==n&&n.aborted)throw new oh;return this._addChatCompletion(eh(this,ep,"m",lp).call(this))}[(tp=new WeakMap,np=new WeakMap,rp=new WeakMap,ep=new WeakSet,sp=function(){this.ended||Zu(this,rp,void 0,"f")},ip=function(e){let t=eh(this,np,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eh(this,np,"f")[e.index]=t,t)},op=function(e){if(this.ended)return;const t=eh(this,ep,"m",hp).call(this,e);this._emit("chunk",e,t);for(const E of e.choices){var n,r,s,i,o,a,c,l;const e=t.choices[E.index];var u,h,d,f,p,g;if(null!=E.delta.content&&"assistant"===(null===(n=e.message)||void 0===n?void 0:n.role)&&null!==(r=e.message)&&void 0!==r&&r.content&&(this._emit("content",E.delta.content,e.message.content),this._emit("content.delta",{delta:E.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=E.delta.refusal&&"assistant"===(null===(s=e.message)||void 0===s?void 0:s.role)&&null!==(i=e.message)&&void 0!==i&&i.refusal&&this._emit("refusal.delta",{delta:E.delta.refusal,snapshot:e.message.refusal}),null!=(null===(o=E.logprobs)||void 0===o?void 0:o.content)&&"assistant"===(null===(a=e.message)||void 0===a?void 0:a.role))this._emit("logprobs.content.delta",{content:null===(u=E.logprobs)||void 0===u?void 0:u.content,snapshot:null!==(h=null===(d=e.logprobs)||void 0===d?void 0:d.content)&&void 0!==h?h:[]});if(null!=(null===(c=E.logprobs)||void 0===c?void 0:c.refusal)&&"assistant"===(null===(l=e.message)||void 0===l?void 0:l.role))this._emit("logprobs.refusal.delta",{refusal:null===(f=E.logprobs)||void 0===f?void 0:f.refusal,snapshot:null!==(p=null===(g=e.logprobs)||void 0===g?void 0:g.refusal)&&void 0!==p?p:[]});const I=eh(this,ep,"m",ip).call(this,e);e.finish_reason&&(eh(this,ep,"m",cp).call(this,e),null!=I.current_tool_call_index&&eh(this,ep,"m",ap).call(this,e,I.current_tool_call_index));for(const t of null!==(m=E.delta.tool_calls)&&void 0!==m?m:[]){var m;I.current_tool_call_index!==t.index&&(eh(this,ep,"m",cp).call(this,e),null!=I.current_tool_call_index&&eh(this,ep,"m",ap).call(this,e,I.current_tool_call_index)),I.current_tool_call_index=t.index}for(const t of null!==(v=E.delta.tool_calls)&&void 0!==v?v:[]){var v,y;const n=null===(y=e.message.tool_calls)||void 0===y?void 0:y[t.index];var w,_,b;if(null!==n&&void 0!==n&&n.type)if("function"===(null===n||void 0===n?void 0:n.type))this._emit("tool_calls.function.arguments.delta",{name:null===(w=n.function)||void 0===w?void 0:w.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:null!==(_=null===(b=t.function)||void 0===b?void 0:b.arguments)&&void 0!==_?_:""});else yp(null===n||void 0===n?void 0:n.type)}}},ap=function(e,t){var n;if(eh(this,ep,"m",ip).call(this,e).done_tool_calls.has(t))return;const r=null===(n=e.message.tool_calls)||void 0===n?void 0:n[t];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if("function"===r.type){var s;const e=null===(s=eh(this,tp,"f"))||void 0===s||null===(s=s.tools)||void 0===s?void 0:s.find(e=>tf(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:rf(e)?e.$parseRaw(r.function.arguments):null!==e&&void 0!==e&&e.function.strict?JSON.parse(r.function.arguments):null})}else r.type},cp=function(e){var t,n;const r=eh(this,ep,"m",ip).call(this,e);if(e.message.content&&!r.content_done){r.content_done=!0;const t=eh(this,ep,"m",up).call(this);this._emit("content.done",{content:e.message.content,parsed:t?t.$parseRaw(e.message.content):null})}e.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),null!==(t=e.logprobs)&&void 0!==t&&t.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),null!==(n=e.logprobs)&&void 0!==n&&n.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},lp=function(){if(this.ended)throw new sh("stream has ended, this shouldn't happen");const e=eh(this,rp,"f");if(!e)throw new sh("request ended without sending any chunks");return Zu(this,rp,void 0,"f"),Zu(this,np,[],"f"),function(e,t){const{id:n,choices:s,created:i,model:o,system_fingerprint:a}=e,l=r(e,Jf),u=c(c({},l),{},{id:n,choices:s.map(t=>{var n;let{message:s,finish_reason:i,index:o,logprobs:a}=t,l=r(t,Qf);if(!i)throw new sh("missing finish_reason for choice ".concat(o));const{content:u=null,function_call:h,tool_calls:d}=s,f=r(s,Yf),p=s.role;if(!p)throw new sh("missing role for choice ".concat(o));if(h){var g;const{arguments:e,name:t}=h;if(null==e)throw new sh("missing function_call.arguments for choice ".concat(o));if(!t)throw new sh("missing function_call.name for choice ".concat(o));return c(c({},l),{},{message:{content:u,function_call:{arguments:e,name:t},role:p,refusal:null!==(g=s.refusal)&&void 0!==g?g:null},finish_reason:i,index:o,logprobs:a})}var m;return c(c({},l),{},d?{index:o,finish_reason:i,logprobs:a,message:c(c({},f),{},{role:p,content:u,refusal:null!==(m=s.refusal)&&void 0!==m?m:null,tool_calls:d.map((t,n)=>{const{function:s,type:i,id:a}=t,l=r(t,$f),u=s||{},{arguments:h,name:d}=u,f=r(u,Zf);if(null==a)throw new sh("missing choices[".concat(o,"].tool_calls[").concat(n,"].id\n").concat(mp(e)));if(null==i)throw new sh("missing choices[".concat(o,"].tool_calls[").concat(n,"].type\n").concat(mp(e)));if(null==d)throw new sh("missing choices[".concat(o,"].tool_calls[").concat(n,"].function.name\n").concat(mp(e)));if(null==h)throw new sh("missing choices[".concat(o,"].tool_calls[").concat(n,"].function.arguments\n").concat(mp(e)));return c(c({},l),{},{id:a,type:i,function:c(c({},f),{},{name:d,arguments:h})})})})}:{message:c(c({},f),{},{content:u,role:p,refusal:null!==(n=s.refusal)&&void 0!==n?n:null}),finish_reason:i,index:o,logprobs:a})}),created:i,model:o,object:"chat.completion"},a?{system_fingerprint:a}:{});return function(e,t){return t&&cf(t)?sf(e,t):c(c({},e),{},{choices:e.choices.map(e=>(lf(e.message.tool_calls),c(c({},e),{},{message:c(c({},e.message),{},{parsed:null},e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0)})))})}(u,t)}(e,eh(this,tp,"f"))},up=function(){var e;const t=null===(e=eh(this,tp,"f"))||void 0===e?void 0:e.response_format;return nf(t)?t:null},hp=function(e){var t,n,s,i;let o=eh(this,rp,"f");const{choices:a}=e,l=r(e,Wf);o?Object.assign(o,l):o=Zu(this,rp,c(c({},l),{},{choices:[]}),"f");for(const m of e.choices){const{delta:e,finish_reason:a,index:l,logprobs:v=null}=m,y=r(m,Kf);{let m=o.choices[l];if(m||(m=o.choices[l]=c({finish_reason:a,index:l,message:{},logprobs:v},y)),v)if(m.logprobs){const{content:e,refusal:s}=v,i=r(v,zf);var u,h;if(vp(i),Object.assign(m.logprobs,i),e)null!==(u=(t=m.logprobs).content)&&void 0!==u||(t.content=[]),m.logprobs.content.push(...e);if(s)null!==(h=(n=m.logprobs).refusal)&&void 0!==h||(n.refusal=[]),m.logprobs.refusal.push(...s)}else m.logprobs=Object.assign({},v);if(a&&(m.finish_reason=a,eh(this,tp,"f")&&cf(eh(this,tp,"f")))){if("length"===a)throw new vh;if("content_filter"===a)throw new yh}if(Object.assign(m,y),!e)continue;const{content:w,refusal:_,function_call:b,role:E,tool_calls:I}=e,S=r(e,Gf);var d;if(vp(S),Object.assign(m.message,S),_&&(m.message.refusal=(m.message.refusal||"")+_),E&&(m.message.role=E),b)if(m.message.function_call){if(b.name&&(m.message.function_call.name=b.name),b.arguments)null!==(d=(s=m.message.function_call).arguments)&&void 0!==d||(s.arguments=""),m.message.function_call.arguments+=b.arguments}else m.message.function_call=b;if(w&&(m.message.content=(m.message.content||"")+w,!m.message.refusal&&eh(this,ep,"m",up).call(this)&&(m.message.parsed=Hf(m.message.content))),I){m.message.tool_calls||(m.message.tool_calls=[]);for(const e of I){var f,p,g;const{index:t,id:n,type:s,function:o}=e,a=r(e,Xf),c=null!==(f=(i=m.message.tool_calls)[t])&&void 0!==f?f:i[t]={};Object.assign(c,a),n&&(c.id=n),s&&(c.type=s),o&&(null!==(p=c.function)&&void 0!==p||(c.function={name:null!==(g=o.name)&&void 0!==g?g:"",arguments:""})),null!==o&&void 0!==o&&o.name&&(c.function.name=o.name),null!==o&&void 0!==o&&o.arguments&&(c.function.arguments+=o.arguments,af(eh(this,tp,"f"),c)&&(c.function.parsed_arguments=Hf(c.function.arguments)))}}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ed(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function mp(e){return JSON.stringify(e)}function vp(e){}function yp(e){}class wp extends gp{static fromReadableStream(e){const t=new wp(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new wp(t),s=c(c({},n),{},{headers:c(c({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"runTools"})});return r._run(()=>r._runTools(e,t,s)),r}}class _p extends Gd{constructor(){super(...arguments),this.messages=new ef(this._client)}create(e,t){var n;return this._client.post("/chat/completions",c(c({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}))}retrieve(e,t){return this._client.get($d(dp||(dp=Xd(["/chat/completions/",""])),e),t)}update(e,t,n){return this._client.post($d(fp||(fp=Xd(["/chat/completions/",""])),e),c({body:t},n))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/chat/completions",Pd,c({query:e},t))}delete(e,t){return this._client.delete($d(pp||(pp=Xd(["/chat/completions/",""])),e),t)}parse(e,t){return function(e){for(const t of null!==e&&void 0!==e?e:[]){if("function"!==t.type)throw new sh("Currently only `function` tool types support auto-parsing; Received `".concat(t.type,"`"));if(!0!==t.function.strict)throw new sh("The `".concat(t.function.name,"` tool is not marked with `strict: true`. Only strict function tools can be auto-parsed"))}}(e.tools),this._client.chat.completions.create(e,c(c({},t),{},{headers:c(c({},null===t||void 0===t?void 0:t.headers),{},{"X-Stainless-Helper-Method":"chat.completions.parse"})}))._thenUnwrap(t=>sf(t,e))}runTools(e,t){return e.stream?wp.runTools(this._client,e,t):Vf.runTools(this._client,e,t)}stream(e,t){return gp.createChatCompletion(this._client,e,t)}}_p.Messages=ef;class bp extends Gd{constructor(){super(...arguments),this.completions=new _p(this._client)}}bp.Completions=_p;const Ep=Symbol("brand.privateNullableHeaders");function*Ip(e){if(!e)return;if(Ep in e){const{values:t,nulls:n}=e;yield*t.entries();for(const e of n)yield[e,null];return}let t,n=!1;e instanceof Headers?t=e.entries():Eh(e)?t=e:(n=!0,t=Object.entries(null!==e&&void 0!==e?e:{}));for(let r of t){const e=r[0];if("string"!==typeof e)throw new TypeError("expected header name to be a string");const t=Eh(r[1])?r[1]:[r[1]];let s=!1;for(const r of t)void 0!==r&&(n&&!s&&(s=!0,yield[e,null]),yield[e,r])}}const Sp=e=>{const t=new Headers,n=new Set;for(const r of e){const e=new Set;for(const[s,i]of Ip(r)){const r=s.toLowerCase();e.has(r)||(t.delete(s),e.add(r)),null===i?(t.delete(s),n.add(r)):(t.append(s,i),n.delete(r))}}return{[Ep]:!0,values:t,nulls:n}};class Tp extends Gd{create(e,t){return this._client.post("/audio/speech",c(c({body:e},t),{},{headers:Sp([{Accept:"application/octet-stream"},null===t||void 0===t?void 0:t.headers]),__binaryResponse:!0}))}}class Ap extends Gd{create(e,t){var n;return this._client.post("/audio/transcriptions",jd(c(c({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n,__metadata:{model:e.model}}),this._client))}}class kp extends Gd{create(e,t){return this._client.post("/audio/translations",jd(c(c({body:e},t),{},{__metadata:{model:e.model}}),this._client))}}class Cp extends Gd{constructor(){super(...arguments),this.transcriptions=new Ap(this._client),this.translations=new kp(this._client),this.speech=new Tp(this._client)}}var Rp,Op,Np,Pp,xp,Dp,Lp,Mp,Up;Cp.Transcriptions=Ap,Cp.Translations=kp,Cp.Speech=Tp;class Vp extends Gd{create(e,t){return this._client.post("/batches",c({body:e},t))}retrieve(e,t){return this._client.get($d(Rp||(Rp=Xd(["/batches/",""])),e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/batches",Pd,c({query:e},t))}cancel(e,t){return this._client.post($d(Op||(Op=Xd(["/batches/","/cancel"])),e),t)}}class jp extends Gd{create(e,t){return this._client.post("/assistants",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}retrieve(e,t){return this._client.get($d(Np||(Np=Xd(["/assistants/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}update(e,t,n){return this._client.post($d(Pp||(Pp=Xd(["/assistants/",""])),e),c(c({body:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/assistants",Pd,c(c({query:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}delete(e,t){return this._client.delete($d(xp||(xp=Xd(["/assistants/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}}class Fp extends Gd{create(e,t){return this._client.post("/realtime/sessions",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}}class Bp extends Gd{create(e,t){return this._client.post("/realtime/transcription_sessions",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}}class qp extends Gd{constructor(){super(...arguments),this.sessions=new Fp(this._client),this.transcriptionSessions=new Bp(this._client)}}qp.Sessions=Fp,qp.TranscriptionSessions=Bp;class Hp extends Gd{create(e,t){return this._client.post("/chatkit/sessions",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"chatkit_beta=v1"},null===t||void 0===t?void 0:t.headers])}))}cancel(e,t){return this._client.post($d(Dp||(Dp=Xd(["/chatkit/sessions/","/cancel"])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"chatkit_beta=v1"},null===t||void 0===t?void 0:t.headers])}))}}class Wp extends Gd{retrieve(e,t){return this._client.get($d(Lp||(Lp=Xd(["/chatkit/threads/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"chatkit_beta=v1"},null===t||void 0===t?void 0:t.headers])}))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/chatkit/threads",xd,c(c({query:e},t),{},{headers:Sp([{"OpenAI-Beta":"chatkit_beta=v1"},null===t||void 0===t?void 0:t.headers])}))}delete(e,t){return this._client.delete($d(Mp||(Mp=Xd(["/chatkit/threads/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"chatkit_beta=v1"},null===t||void 0===t?void 0:t.headers])}))}listItems(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Up||(Up=Xd(["/chatkit/threads/","/items"])),e),xd,c(c({query:t},n),{},{headers:Sp([{"OpenAI-Beta":"chatkit_beta=v1"},null===n||void 0===n?void 0:n.headers])}))}}class Kp extends Gd{constructor(){super(...arguments),this.sessions=new Hp(this._client),this.threads=new Wp(this._client)}}Kp.Sessions=Hp,Kp.Threads=Wp;const zp=["thread_id"];var Gp,Xp,Jp,Qp,Yp,$p,Zp;class eg extends Gd{create(e,t,n){return this._client.post($d(Gp||(Gp=Xd(["/threads/","/messages"])),e),c(c({body:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get($d(Xp||(Xp=Xd(["/threads/","/messages/",""])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}update(e,t,n){const{thread_id:s}=t,i=r(t,zp);return this._client.post($d(Jp||(Jp=Xd(["/threads/","/messages/",""])),s,e),c(c({body:i},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Qp||(Qp=Xd(["/threads/","/messages"])),e),Pd,c(c({query:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}delete(e,t,n){const{thread_id:r}=t;return this._client.delete($d(Yp||(Yp=Xd(["/threads/","/messages/",""])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}}const tg=["thread_id","run_id"],ng=["thread_id"];class rg extends Gd{retrieve(e,t,n){const{thread_id:s,run_id:i}=t,o=r(t,tg);return this._client.get($d($p||($p=Xd(["/threads/","/runs/","/steps/",""])),s,i,e),c(c({query:o},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}list(e,t,n){const{thread_id:s}=t,i=r(t,ng);return this._client.getAPIList($d(Zp||(Zp=Xd(["/threads/","/runs/","/steps"])),s,e),Pd,c(c({query:i},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}}const sg=e=>{var t,n,r,s;return"undefined"!==typeof globalThis.process?null!==(t=null===(n=globalThis.process.env)||void 0===n||null===(n=n[e])||void 0===n?void 0:n.trim())&&void 0!==t?t:void 0:"undefined"!==typeof globalThis.Deno?null===(r=globalThis.Deno.env)||void 0===r||null===(s=r.get)||void 0===s||null===(s=s.call(r,e))||void 0===s?void 0:s.trim():void 0};var ig,og,ag,cg,lg,ug,hg,dg,fg,pg,gg,mg,vg,yg,wg,_g,bg,Eg,Ig,Sg,Tg,Ag,kg,Cg,Rg,Og,Ng,Pg,xg;class Dg extends Tf{constructor(){super(...arguments),ig.add(this),ag.set(this,[]),cg.set(this,{}),lg.set(this,{}),ug.set(this,void 0),hg.set(this,void 0),dg.set(this,void 0),fg.set(this,void 0),pg.set(this,void 0),gg.set(this,void 0),mg.set(this,void 0),vg.set(this,void 0),yg.set(this,void 0)}[(ag=new WeakMap,cg=new WeakMap,lg=new WeakMap,ug=new WeakMap,hg=new WeakMap,dg=new WeakMap,fg=new WeakMap,pg=new WeakMap,gg=new WeakMap,mg=new WeakMap,vg=new WeakMap,yg=new WeakMap,ig=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new og;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var n;const r=null===t||void 0===t?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Ed.fromReadableStream(e,this.controller);var i,o=!1,a=!1;try{for(var c,l=Qh(s);o=!(c=await l.next()).done;o=!1){const e=c.value;eh(this,ig,"m",wg).call(this,e)}}catch(u){a=!0,i=u}finally{try{o&&null!=l.return&&await l.return()}finally{if(a)throw i}}if(null!==(n=s.controller.signal)&&void 0!==n&&n.aborted)throw new oh;return this._addRun(eh(this,ig,"m",_g).call(this))}toReadableStream(){return new Ed(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const s=new og;return s._run(()=>s._runToolAssistantStream(e,t,n,c(c({},r),{},{headers:c(c({},null===r||void 0===r?void 0:r.headers),{},{"X-Stainless-Helper-Method":"stream"})}))),s}async _createToolAssistantStream(e,t,n,r){var s;const i=null===r||void 0===r?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o=c(c({},n),{},{stream:!0}),a=await e.submitToolOutputs(t,o,c(c({},r),{},{signal:this.controller.signal}));this._connected();var l,u=!1,h=!1;try{for(var d,f=Qh(a);u=!(d=await f.next()).done;u=!1){const e=d.value;eh(this,ig,"m",wg).call(this,e)}}catch(p){h=!0,l=p}finally{try{u&&null!=f.return&&await f.return()}finally{if(h)throw l}}if(null!==(s=a.controller.signal)&&void 0!==s&&s.aborted)throw new oh;return this._addRun(eh(this,ig,"m",_g).call(this))}static createThreadAssistantStream(e,t,n){const r=new og;return r._run(()=>r._threadAssistantStream(e,t,c(c({},n),{},{headers:c(c({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"stream"})}))),r}static createAssistantStream(e,t,n,r){const s=new og;return s._run(()=>s._runAssistantStream(e,t,n,c(c({},r),{},{headers:c(c({},null===r||void 0===r?void 0:r.headers),{},{"X-Stainless-Helper-Method":"stream"})}))),s}currentEvent(){return eh(this,mg,"f")}currentRun(){return eh(this,vg,"f")}currentMessageSnapshot(){return eh(this,ug,"f")}currentRunStepSnapshot(){return eh(this,yg,"f")}async finalRunSteps(){return await this.done(),Object.values(eh(this,cg,"f"))}async finalMessages(){return await this.done(),Object.values(eh(this,lg,"f"))}async finalRun(){if(await this.done(),!eh(this,hg,"f"))throw Error("Final run was not received.");return eh(this,hg,"f")}async _createThreadAssistantStream(e,t,n){var r;const s=null===n||void 0===n?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i=c(c({},t),{},{stream:!0}),o=await e.createAndRun(i,c(c({},n),{},{signal:this.controller.signal}));this._connected();var a,l=!1,u=!1;try{for(var h,d=Qh(o);l=!(h=await d.next()).done;l=!1){const e=h.value;eh(this,ig,"m",wg).call(this,e)}}catch(f){u=!0,a=f}finally{try{l&&null!=d.return&&await d.return()}finally{if(u)throw a}}if(null!==(r=o.controller.signal)&&void 0!==r&&r.aborted)throw new oh;return this._addRun(eh(this,ig,"m",_g).call(this))}async _createAssistantStream(e,t,n,r){var s;const i=null===r||void 0===r?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o=c(c({},n),{},{stream:!0}),a=await e.create(t,o,c(c({},r),{},{signal:this.controller.signal}));this._connected();var l,u=!1,h=!1;try{for(var d,f=Qh(a);u=!(d=await f.next()).done;u=!1){const e=d.value;eh(this,ig,"m",wg).call(this,e)}}catch(p){h=!0,l=p}finally{try{u&&null!=f.return&&await f.return()}finally{if(h)throw l}}if(null!==(s=a.controller.signal)&&void 0!==s&&s.aborted)throw new oh;return this._addRun(eh(this,ig,"m",_g).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let t=e[n];if(null!==t&&void 0!==t)if("index"!==n&&"type"!==n){if("string"===typeof t&&"string"===typeof r)t+=r;else if("number"===typeof t&&"number"===typeof r)t+=r;else{if(!Sh(t)||!Sh(r)){if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"===typeof e||"number"===typeof e)){t.push(...r);continue}for(const e of r){if(!Sh(e))throw new Error("Expected array delta entry to be an object but got: ".concat(e));const n=e.index;if(null==n)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!==typeof n)throw new Error("Expected array delta entry `index` property to be a number but got ".concat(n));const r=t[n];null==r?t.push(e):t[n]=this.accumulateDelta(r,e)}continue}throw Error("Unhandled record type: ".concat(n,", deltaValue: ").concat(r,", accValue: ").concat(t))}t=this.accumulateDelta(t,r)}e[n]=t}else e[n]=r;else e[n]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}og=Dg,wg=function(e){if(!this.ended)switch(Zu(this,mg,e,"f"),eh(this,ig,"m",Ig).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eh(this,ig,"m",kg).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eh(this,ig,"m",Eg).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eh(this,ig,"m",bg).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},_g=function(){if(this.ended)throw new sh("stream has ended, this shouldn't happen");if(!eh(this,hg,"f"))throw Error("Final run has not been received");return eh(this,hg,"f")},bg=function(e){const[t,n]=eh(this,ig,"m",Tg).call(this,e,eh(this,ug,"f"));Zu(this,ug,t,"f"),eh(this,lg,"f")[t.id]=t;for(const r of n){const e=t.content[r.index];"text"==(null===e||void 0===e?void 0:e.type)&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,r=t.content[n.index];if(!r||"text"!=r.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,r.text)}if(n.index!=eh(this,dg,"f")){if(eh(this,fg,"f"))switch(eh(this,fg,"f").type){case"text":this._emit("textDone",eh(this,fg,"f").text,eh(this,ug,"f"));break;case"image_file":this._emit("imageFileDone",eh(this,fg,"f").image_file,eh(this,ug,"f"))}Zu(this,dg,n.index,"f")}Zu(this,fg,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eh(this,dg,"f")){const t=e.data.content[eh(this,dg,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eh(this,ug,"f"));break;case"text":this._emit("textDone",t.text,eh(this,ug,"f"))}}eh(this,ug,"f")&&this._emit("messageDone",e.data),Zu(this,ug,void 0,"f")}},Eg=function(e){const t=eh(this,ig,"m",Sg).call(this,e);switch(Zu(this,yg,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==eh(this,pg,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eh(this,gg,"f")&&this._emit("toolCallDone",eh(this,gg,"f")),Zu(this,pg,e.index,"f"),Zu(this,gg,t.step_details.tool_calls[e.index],"f"),eh(this,gg,"f")&&this._emit("toolCallCreated",eh(this,gg,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Zu(this,yg,void 0,"f");"tool_calls"==e.data.step_details.type&&eh(this,gg,"f")&&(this._emit("toolCallDone",eh(this,gg,"f")),Zu(this,gg,void 0,"f")),this._emit("runStepDone",e.data,t)}},Ig=function(e){eh(this,ag,"f").push(e),this._emit("event",e)},Sg=function(e){switch(e.event){case"thread.run.step.created":return eh(this,cg,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eh(this,cg,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=og.accumulateDelta(t,n.delta);eh(this,cg,"f")[e.data.id]=r}return eh(this,cg,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eh(this,cg,"f")[e.data.id]=e.data}if(eh(this,cg,"f")[e.data.id])return eh(this,cg,"f")[e.data.id];throw new Error("No snapshot available")},Tg=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const e of r.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=eh(this,ig,"m",Ag).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ag=function(e,t){return og.accumulateDelta(t,e)},kg=function(e){switch(Zu(this,vg,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Zu(this,hg,e.data,"f"),eh(this,gg,"f")&&(this._emit("toolCallDone",eh(this,gg,"f")),Zu(this,gg,void 0,"f"))}};const Lg=["include"],Mg=["thread_id"],Ug=["thread_id"];class Vg extends Gd{constructor(){super(...arguments),this.steps=new rg(this._client)}create(e,t,n){var s;const{include:i}=t,o=r(t,Lg);return this._client.post($d(Cg||(Cg=Xd(["/threads/","/runs"])),e),c(c({query:{include:i},body:o},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers]),stream:null!==(s=t.stream)&&void 0!==s&&s}))}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get($d(Rg||(Rg=Xd(["/threads/","/runs/",""])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}update(e,t,n){const{thread_id:s}=t,i=r(t,Mg);return this._client.post($d(Og||(Og=Xd(["/threads/","/runs/",""])),s,e),c(c({body:i},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Ng||(Ng=Xd(["/threads/","/runs"])),e),Pd,c(c({query:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}cancel(e,t,n){const{thread_id:r}=t;return this._client.post($d(Pg||(Pg=Xd(["/threads/","/runs/","/cancel"])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return Dg.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){var r,s;const i=Sp([null===n||void 0===n?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":null!==(r=null===n||void 0===n||null===(s=n.pollIntervalMs)||void 0===s?void 0:s.toString())&&void 0!==r?r:void 0}]);for(;;){const{data:r,response:s}=await this.retrieve(e,t,c(c({},n),{},{headers:c(c({},null===n||void 0===n?void 0:n.headers),i)})).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(null!==n&&void 0!==n&&n.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Th(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,n){return Dg.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){var s;const{thread_id:i}=t,o=r(t,Ug);return this._client.post($d(xg||(xg=Xd(["/threads/","/runs/","/submit_tool_outputs"])),i,e),c(c({body:o},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers]),stream:null!==(s=t.stream)&&void 0!==s&&s}))}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return Dg.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}}var jg,Fg,Bg,qg,Hg,Wg,Kg,zg,Gg,Xg,Jg,Qg,Yg,$g;Vg.Steps=rg;class Zg extends Gd{constructor(){super(...arguments),this.runs=new Vg(this._client),this.messages=new eg(this._client)}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.post("/threads",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}retrieve(e,t){return this._client.get($d(jg||(jg=Xd(["/threads/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}update(e,t,n){return this._client.post($d(Fg||(Fg=Xd(["/threads/",""])),e),c(c({body:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}delete(e,t){return this._client.delete($d(Bg||(Bg=Xd(["/threads/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}createAndRun(e,t){var n;return this._client.post("/threads/runs",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers]),stream:null!==(n=e.stream)&&void 0!==n&&n}))}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Dg.createThreadAssistantStream(e,this._client.beta.threads,t)}}Zg.Runs=Vg,Zg.Messages=eg;class em extends Gd{constructor(){super(...arguments),this.realtime=new qp(this._client),this.chatkit=new Kp(this._client),this.assistants=new jp(this._client),this.threads=new Zg(this._client)}}em.Realtime=qp,em.ChatKit=Kp,em.Assistants=jp,em.Threads=Zg;class tm extends Gd{create(e,t){var n;return this._client.post("/completions",c(c({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}))}}class nm extends Gd{retrieve(e,t,n){const{container_id:r}=t;return this._client.get($d(qg||(qg=Xd(["/containers/","/files/","/content"])),r,e),c(c({},n),{},{headers:Sp([{Accept:"application/binary"},null===n||void 0===n?void 0:n.headers]),__binaryResponse:!0}))}}class rm extends Gd{constructor(){super(...arguments),this.content=new nm(this._client)}create(e,t,n){return this._client.post($d(Hg||(Hg=Xd(["/containers/","/files"])),e),jd(c({body:t},n),this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get($d(Wg||(Wg=Xd(["/containers/","/files/",""])),r,e),n)}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Kg||(Kg=Xd(["/containers/","/files"])),e),Pd,c({query:t},n))}delete(e,t,n){const{container_id:r}=t;return this._client.delete($d(zg||(zg=Xd(["/containers/","/files/",""])),r,e),c(c({},n),{},{headers:Sp([{Accept:"*/*"},null===n||void 0===n?void 0:n.headers])}))}}rm.Content=nm;class sm extends Gd{constructor(){super(...arguments),this.files=new rm(this._client)}create(e,t){return this._client.post("/containers",c({body:e},t))}retrieve(e,t){return this._client.get($d(Gg||(Gg=Xd(["/containers/",""])),e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/containers",Pd,c({query:e},t))}delete(e,t){return this._client.delete($d(Xg||(Xg=Xd(["/containers/",""])),e),c(c({},t),{},{headers:Sp([{Accept:"*/*"},null===t||void 0===t?void 0:t.headers])}))}}sm.Files=rm;const im=["include"],om=["conversation_id"];class am extends Gd{create(e,t,n){const{include:s}=t,i=r(t,im);return this._client.post($d(Jg||(Jg=Xd(["/conversations/","/items"])),e),c({query:{include:s},body:i},n))}retrieve(e,t,n){const{conversation_id:s}=t,i=r(t,om);return this._client.get($d(Qg||(Qg=Xd(["/conversations/","/items/",""])),s,e),c({query:i},n))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Yg||(Yg=Xd(["/conversations/","/items"])),e),xd,c({query:t},n))}delete(e,t,n){const{conversation_id:r}=t;return this._client.delete($d($g||($g=Xd(["/conversations/","/items/",""])),r,e),n)}}var cm,lm,um;class hm extends Gd{constructor(){super(...arguments),this.items=new am(this._client)}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.post("/conversations",c({body:e},t))}retrieve(e,t){return this._client.get($d(cm||(cm=Xd(["/conversations/",""])),e),t)}update(e,t,n){return this._client.post($d(lm||(lm=Xd(["/conversations/",""])),e),c({body:t},n))}delete(e,t){return this._client.delete($d(um||(um=Xd(["/conversations/",""])),e),t)}}hm.Items=am;class dm extends Gd{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&vd(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const s=this._client.post("/embeddings",c({body:c(c({},e),{},{encoding_format:r})},t));return n?s:(vd(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!==typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}const fm=["eval_id"];var pm,gm,mm,vm,ym,wm,_m,bm,Em,Im,Sm,Tm,Am,km,Cm,Rm,Om,Nm,Pm,xm,Dm,Lm,Mm,Um,Vm,jm,Fm,Bm,qm,Hm,Wm,Km,zm,Gm,Xm,Jm,Qm,Ym,$m,Zm,ev,tv,nv;class rv extends Gd{retrieve(e,t,n){const{eval_id:r,run_id:s}=t;return this._client.get($d(pm||(pm=Xd(["/evals/","/runs/","/output_items/",""])),r,s,e),n)}list(e,t,n){const{eval_id:s}=t,i=r(t,fm);return this._client.getAPIList($d(gm||(gm=Xd(["/evals/","/runs/","/output_items"])),s,e),Pd,c({query:i},n))}}class sv extends Gd{constructor(){super(...arguments),this.outputItems=new rv(this._client)}create(e,t,n){return this._client.post($d(mm||(mm=Xd(["/evals/","/runs"])),e),c({body:t},n))}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get($d(vm||(vm=Xd(["/evals/","/runs/",""])),r,e),n)}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(ym||(ym=Xd(["/evals/","/runs"])),e),Pd,c({query:t},n))}delete(e,t,n){const{eval_id:r}=t;return this._client.delete($d(wm||(wm=Xd(["/evals/","/runs/",""])),r,e),n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post($d(_m||(_m=Xd(["/evals/","/runs/",""])),r,e),n)}}sv.OutputItems=rv;class iv extends Gd{constructor(){super(...arguments),this.runs=new sv(this._client)}create(e,t){return this._client.post("/evals",c({body:e},t))}retrieve(e,t){return this._client.get($d(bm||(bm=Xd(["/evals/",""])),e),t)}update(e,t,n){return this._client.post($d(Em||(Em=Xd(["/evals/",""])),e),c({body:t},n))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/evals",Pd,c({query:e},t))}delete(e,t){return this._client.delete($d(Im||(Im=Xd(["/evals/",""])),e),t)}}iv.Runs=sv;class ov extends Gd{create(e,t){return this._client.post("/files",jd(c({body:e},t),this._client))}retrieve(e,t){return this._client.get($d(Sm||(Sm=Xd(["/files/",""])),e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/files",Pd,c({query:e},t))}delete(e,t){return this._client.delete($d(Tm||(Tm=Xd(["/files/",""])),e),t)}content(e,t){return this._client.get($d(Am||(Am=Xd(["/files/","/content"])),e),c(c({},t),{},{headers:Sp([{Accept:"application/binary"},null===t||void 0===t?void 0:t.headers]),__binaryResponse:!0}))}async waitForProcessing(e){let{pollInterval:t=5e3,maxWait:n=18e5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new Set(["processed","error","deleted"]),s=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await Th(t),i=await this.retrieve(e),Date.now()-s>n)throw new ch({message:"Giving up on waiting for file ".concat(e," to finish processing after ").concat(n," milliseconds.")});return i}}class av extends Gd{}class cv extends Gd{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",c({body:e},t))}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",c({body:e},t))}}class lv extends Gd{constructor(){super(...arguments),this.graders=new cv(this._client)}}lv.Graders=cv;class uv extends Gd{create(e,t,n){return this._client.getAPIList($d(km||(km=Xd(["/fine_tuning/checkpoints/","/permissions"])),e),Nd,c({body:t,method:"post"},n))}retrieve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.get($d(Cm||(Cm=Xd(["/fine_tuning/checkpoints/","/permissions"])),e),c({query:t},n))}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete($d(Rm||(Rm=Xd(["/fine_tuning/checkpoints/","/permissions/",""])),r,e),n)}}class hv extends Gd{constructor(){super(...arguments),this.permissions=new uv(this._client)}}hv.Permissions=uv;class dv extends Gd{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Om||(Om=Xd(["/fine_tuning/jobs/","/checkpoints"])),e),Pd,c({query:t},n))}}class fv extends Gd{constructor(){super(...arguments),this.checkpoints=new dv(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",c({body:e},t))}retrieve(e,t){return this._client.get($d(Nm||(Nm=Xd(["/fine_tuning/jobs/",""])),e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/fine_tuning/jobs",Pd,c({query:e},t))}cancel(e,t){return this._client.post($d(Pm||(Pm=Xd(["/fine_tuning/jobs/","/cancel"])),e),t)}listEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(xm||(xm=Xd(["/fine_tuning/jobs/","/events"])),e),Pd,c({query:t},n))}pause(e,t){return this._client.post($d(Dm||(Dm=Xd(["/fine_tuning/jobs/","/pause"])),e),t)}resume(e,t){return this._client.post($d(Lm||(Lm=Xd(["/fine_tuning/jobs/","/resume"])),e),t)}}fv.Checkpoints=dv;class pv extends Gd{constructor(){super(...arguments),this.methods=new av(this._client),this.jobs=new fv(this._client),this.checkpoints=new hv(this._client),this.alpha=new lv(this._client)}}pv.Methods=av,pv.Jobs=fv,pv.Checkpoints=hv,pv.Alpha=lv;class gv extends Gd{}class mv extends Gd{constructor(){super(...arguments),this.graderModels=new gv(this._client)}}mv.GraderModels=gv;class vv extends Gd{createVariation(e,t){return this._client.post("/images/variations",jd(c({body:e},t),this._client))}edit(e,t){var n;return this._client.post("/images/edits",jd(c(c({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}),this._client))}generate(e,t){var n;return this._client.post("/images/generations",c(c({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}))}}class yv extends Gd{retrieve(e,t){return this._client.get($d(Mm||(Mm=Xd(["/models/",""])),e),t)}list(e){return this._client.getAPIList("/models",Nd,e)}delete(e,t){return this._client.delete($d(Um||(Um=Xd(["/models/",""])),e),t)}}class wv extends Gd{create(e,t){return this._client.post("/moderations",c({body:e},t))}}class _v extends Gd{accept(e,t,n){return this._client.post($d(Vm||(Vm=Xd(["/realtime/calls/","/accept"])),e),c(c({body:t},n),{},{headers:Sp([{Accept:"*/*"},null===n||void 0===n?void 0:n.headers])}))}hangup(e,t){return this._client.post($d(jm||(jm=Xd(["/realtime/calls/","/hangup"])),e),c(c({},t),{},{headers:Sp([{Accept:"*/*"},null===t||void 0===t?void 0:t.headers])}))}refer(e,t,n){return this._client.post($d(Fm||(Fm=Xd(["/realtime/calls/","/refer"])),e),c(c({body:t},n),{},{headers:Sp([{Accept:"*/*"},null===n||void 0===n?void 0:n.headers])}))}reject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.post($d(Bm||(Bm=Xd(["/realtime/calls/","/reject"])),e),c(c({body:t},n),{},{headers:Sp([{Accept:"*/*"},null===n||void 0===n?void 0:n.headers])}))}}class bv extends Gd{create(e,t){return this._client.post("/realtime/client_secrets",c({body:e},t))}}class Ev extends Gd{constructor(){super(...arguments),this.clientSecrets=new bv(this._client),this.calls=new _v(this._client)}}function Iv(e,t){return t&&function(e){var t;if(nf(null===(t=e.text)||void 0===t?void 0:t.format))return!0;return!1}(t)?Sv(e,t):c(c({},e),{},{output_parsed:null,output:e.output.map(e=>"function_call"===e.type?c(c({},e),{},{parsed_arguments:null}):"message"===e.type?c(c({},e),{},{content:e.content.map(e=>c(c({},e),{},{parsed:null}))}):e)})}function Sv(e,t){const n=e.output.map(e=>{if("function_call"===e.type)return c(c({},e),{},{parsed_arguments:Cv(t,e)});if("message"===e.type){const n=e.content.map(e=>"output_text"===e.type?c(c({},e),{},{parsed:Tv(t,e.text)}):e);return c(c({},e),{},{content:n})}return e}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||Rv(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const e of r.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),r}function Tv(e,t){var n,r;if("json_schema"!==(null===(n=e.text)||void 0===n||null===(n=n.format)||void 0===n?void 0:n.type))return null;if("$parseRaw"in(null===(r=e.text)||void 0===r?void 0:r.format)){var s;return(null===(s=e.text)||void 0===s?void 0:s.format).$parseRaw(t)}return JSON.parse(t)}function Av(e){return"auto-parseable-tool"===(null===e||void 0===e?void 0:e.$brand)}function kv(e,t){return e.find(e=>"function"===e.type&&e.name===t)}function Cv(e,t){var n;const r=kv(null!==(n=e.tools)&&void 0!==n?n:[],t.name);return c(c(c({},t),t),{},{parsed_arguments:Av(r)?r.$parseRaw(t.arguments):null!==r&&void 0!==r&&r.strict?JSON.parse(t.arguments):null})}function Rv(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}Ev.ClientSecrets=bv,Ev.Calls=_v;class Ov extends Tf{constructor(e){super(),qm.add(this),Hm.set(this,void 0),Wm.set(this,void 0),Km.set(this,void 0),Zu(this,Hm,e,"f")}static createResponse(e,t,n){const r=new Ov(t);return r._run(()=>r._createOrRetrieveResponse(e,t,c(c({},n),{},{headers:c(c({},null===n||void 0===n?void 0:n.headers),{},{"X-Stainless-Helper-Method":"stream"})}))),r}async _createOrRetrieveResponse(e,t,n){var r;const s=null===n||void 0===n?void 0:n.signal;let i;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),eh(this,qm,"m",zm).call(this);let o=null;var a;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},c(c({},n),{},{signal:this.controller.signal,stream:!0})),o=null!==(a=t.starting_after)&&void 0!==a?a:null):i=await e.responses.create(c(c({},t),{},{stream:!0}),c(c({},n),{},{signal:this.controller.signal}));this._connected();var l,u=!1,h=!1;try{for(var d,f=Qh(i);u=!(d=await f.next()).done;u=!1){const e=d.value;eh(this,qm,"m",Gm).call(this,e,o)}}catch(p){h=!0,l=p}finally{try{u&&null!=f.return&&await f.return()}finally{if(h)throw l}}if(null!==(r=i.controller.signal)&&void 0!==r&&r.aborted)throw new oh;return eh(this,qm,"m",Xm).call(this)}[(Hm=new WeakMap,Wm=new WeakMap,Km=new WeakMap,qm=new WeakSet,zm=function(){this.ended||Zu(this,Wm,void 0,"f")},Gm=function(e,t){if(this.ended)return;const n=(e,n)=>{(null==t||n.sequence_number>t)&&this._emit(e,n)},r=eh(this,qm,"m",Jm).call(this,e);switch(n("event",e),e.type){case"response.output_text.delta":{const t=r.output[e.output_index];if(!t)throw new sh("missing output at index ".concat(e.output_index));if("message"===t.type){const r=t.content[e.content_index];if(!r)throw new sh("missing content at index ".concat(e.content_index));if("output_text"!==r.type)throw new sh("expected content to be 'output_text', got ".concat(r.type));n("response.output_text.delta",c(c({},e),{},{snapshot:r.text}))}break}case"response.function_call_arguments.delta":{const t=r.output[e.output_index];if(!t)throw new sh("missing output at index ".concat(e.output_index));"function_call"===t.type&&n("response.function_call_arguments.delta",c(c({},e),{},{snapshot:t.arguments}));break}default:n(e.type,e)}},Xm=function(){if(this.ended)throw new sh("stream has ended, this shouldn't happen");const e=eh(this,Wm,"f");if(!e)throw new sh("request ended without sending any events");Zu(this,Wm,void 0,"f");const t=function(e,t){return Iv(e,t)}(e,eh(this,Hm,"f"));return Zu(this,Km,t,"f"),t},Jm=function(e){let t=eh(this,Wm,"f");if(!t){if("response.created"!==e.type)throw new sh("When snapshot hasn't been set yet, expected 'response.created' event, got ".concat(e.type));return t=Zu(this,Wm,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new sh("missing output at index ".concat(e.output_index));const r=n.type,s=e.part;"message"===r&&"reasoning_text"!==s.type?n.content.push(s):"reasoning"===r&&"reasoning_text"===s.type&&(n.content||(n.content=[]),n.content.push(s));break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new sh("missing output at index ".concat(e.output_index));if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new sh("missing content at index ".concat(e.content_index));if("output_text"!==t.type)throw new sh("expected content to be 'output_text', got ".concat(t.type));t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new sh("missing output at index ".concat(e.output_index));"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.reasoning_text.delta":{const r=t.output[e.output_index];if(!r)throw new sh("missing output at index ".concat(e.output_index));if("reasoning"===r.type){var n;const t=null===(n=r.content)||void 0===n?void 0:n[e.content_index];if(!t)throw new sh("missing content at index ".concat(e.content_index));if("reasoning_text"!==t.type)throw new sh("expected content to be 'reasoning_text', got ".concat(t.type));t.text+=e.delta}break}case"response.completed":Zu(this,Wm,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",n=>{const r=t.shift();r?r.resolve(n):e.push(n)}),this.on("end",()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),this.on("error",e=>{n=!0;for(const n of t)n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise((e,n)=>t.push({resolve:e,reject:n})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=eh(this,Km,"f");if(!e)throw new sh("stream ended without producing a ChatCompletion");return e}}class Nv extends Gd{list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(Qm||(Qm=Xd(["/responses/","/input_items"])),e),Pd,c({query:t},n))}}class Pv extends Gd{count(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.post("/responses/input_tokens",c({body:e},t))}}class xv extends Gd{constructor(){super(...arguments),this.inputItems=new Nv(this._client),this.inputTokens=new Pv(this._client)}create(e,t){var n;return this._client.post("/responses",c(c({body:e},t),{},{stream:null!==(n=e.stream)&&void 0!==n&&n}))._thenUnwrap(e=>("object"in e&&"response"===e.object&&Rv(e),e))}retrieve(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return this._client.get($d(Ym||(Ym=Xd(["/responses/",""])),e),c(c({query:n},r),{},{stream:null!==(t=null===n||void 0===n?void 0:n.stream)&&void 0!==t&&t}))._thenUnwrap(e=>("object"in e&&"response"===e.object&&Rv(e),e))}delete(e,t){return this._client.delete($d($m||($m=Xd(["/responses/",""])),e),c(c({},t),{},{headers:Sp([{Accept:"*/*"},null===t||void 0===t?void 0:t.headers])}))}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>Sv(t,e))}stream(e,t){return Ov.createResponse(this._client,e,t)}cancel(e,t){return this._client.post($d(Zm||(Zm=Xd(["/responses/","/cancel"])),e),t)}}xv.InputItems=Nv,xv.InputTokens=Pv;class Dv extends Gd{create(e,t,n){return this._client.post($d(ev||(ev=Xd(["/uploads/","/parts"])),e),jd(c({body:t},n),this._client))}}class Lv extends Gd{constructor(){super(...arguments),this.parts=new Dv(this._client)}create(e,t){return this._client.post("/uploads",c({body:e},t))}cancel(e,t){return this._client.post($d(tv||(tv=Xd(["/uploads/","/cancel"])),e),t)}complete(e,t,n){return this._client.post($d(nv||(nv=Xd(["/uploads/","/complete"])),e),c({body:t},n))}}Lv.Parts=Dv;const Mv=["vector_store_id"];var Uv,Vv,jv,Fv;class Bv extends Gd{create(e,t,n){return this._client.post($d(Uv||(Uv=Xd(["/vector_stores/","/file_batches"])),e),c(c({body:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get($d(Vv||(Vv=Xd(["/vector_stores/","/file_batches/",""])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post($d(jv||(jv=Xd(["/vector_stores/","/file_batches/","/cancel"])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:s}=t,i=r(t,Mv);return this._client.getAPIList($d(Fv||(Fv=Xd(["/vector_stores/","/file_batches/","/files"])),s,e),Pd,c(c({query:i},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}async poll(e,t,n){var r,s;const i=Sp([null===n||void 0===n?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":null!==(r=null===n||void 0===n||null===(s=n.pollIntervalMs)||void 0===s?void 0:s.toString())&&void 0!==r?r:void 0}]);for(;;){const{data:r,response:s}=await this.retrieve(t,{vector_store_id:e},c(c({},n),{},{headers:i})).withResponse();switch(r.status){case"in_progress":let e=5e3;if(null!==n&&void 0!==n&&n.pollIntervalMs)e=n.pollIntervalMs;else{const t=s.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Th(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,t,n){var r;let{files:s,fileIds:i=[]}=t;if(null==s||0==s.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=null!==(r=null===n||void 0===n?void 0:n.maxConcurrency)&&void 0!==r?r:5,a=Math.min(o,s.length),c=this._client,l=s.values(),u=[...i];const h=Array(a).fill(l).map(async function(e){for(let t of e){const e=await c.files.create({file:t,purpose:"assistants"},n);u.push(e.id)}});return await(async e=>{const t=await Promise.allSettled(e),n=t.filter(e=>"rejected"===e.status);if(n.length){for(const e of n)console.error(e.reason);throw new Error("".concat(n.length," promise(s) failed - see the above errors"))}const r=[];for(const s of t)"fulfilled"===s.status&&r.push(s.value);return r})(h),await this.createAndPoll(e,{file_ids:u})}}const qv=["vector_store_id"];var Hv,Wv,Kv,zv,Gv,Xv,Jv,Qv,Yv,$v,Zv,ey,ty,ny,ry,sy,iy;class oy extends Gd{create(e,t,n){return this._client.post($d(Hv||(Hv=Xd(["/vector_stores/","/files"])),e),c(c({body:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get($d(Wv||(Wv=Xd(["/vector_stores/","/files/",""])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}update(e,t,n){const{vector_store_id:s}=t,i=r(t,qv);return this._client.post($d(Kv||(Kv=Xd(["/vector_stores/","/files/",""])),s,e),c(c({body:i},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}list(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.getAPIList($d(zv||(zv=Xd(["/vector_stores/","/files"])),e),Pd,c(c({query:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete($d(Gv||(Gv=Xd(["/vector_stores/","/files/",""])),r,e),c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){var r,s;const i=Sp([null===n||void 0===n?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":null!==(r=null===n||void 0===n||null===(s=n.pollIntervalMs)||void 0===s?void 0:s.toString())&&void 0!==r?r:void 0}]);for(;;){const r=await this.retrieve(t,{vector_store_id:e},c(c({},n),{},{headers:i})).withResponse(),s=r.data;switch(s.status){case"in_progress":let e=5e3;if(null!==n&&void 0!==n&&n.pollIntervalMs)e=n.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await Th(e);break;case"failed":case"completed":return s}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList($d(Xv||(Xv=Xd(["/vector_stores/","/files/","/content"])),r,e),Nd,c(c({},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}}class ay extends Gd{constructor(){super(...arguments),this.files=new oy(this._client),this.fileBatches=new Bv(this._client)}create(e,t){return this._client.post("/vector_stores",c(c({body:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}retrieve(e,t){return this._client.get($d(Jv||(Jv=Xd(["/vector_stores/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}update(e,t,n){return this._client.post($d(Qv||(Qv=Xd(["/vector_stores/",""])),e),c(c({body:t},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/vector_stores",Pd,c(c({query:e},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}delete(e,t){return this._client.delete($d(Yv||(Yv=Xd(["/vector_stores/",""])),e),c(c({},t),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===t||void 0===t?void 0:t.headers])}))}search(e,t,n){return this._client.getAPIList($d($v||($v=Xd(["/vector_stores/","/search"])),e),Nd,c(c({body:t,method:"post"},n),{},{headers:Sp([{"OpenAI-Beta":"assistants=v2"},null===n||void 0===n?void 0:n.headers])}))}}ay.Files=oy,ay.FileBatches=Bv;class cy extends Gd{create(e,t){return this._client.post("/videos",Vd(c({body:e},t),this._client))}retrieve(e,t){return this._client.get($d(Zv||(Zv=Xd(["/videos/",""])),e),t)}list(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this._client.getAPIList("/videos",xd,c({query:e},t))}delete(e,t){return this._client.delete($d(ey||(ey=Xd(["/videos/",""])),e),t)}downloadContent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return this._client.get($d(ty||(ty=Xd(["/videos/","/content"])),e),c(c({query:t},n),{},{headers:Sp([{Accept:"application/binary"},null===n||void 0===n?void 0:n.headers]),__binaryResponse:!0}))}remix(e,t,n){return this._client.post($d(ny||(ny=Xd(["/videos/","/remix"])),e),Vd(c({body:t},n),this._client))}}class ly extends Gd{constructor(){super(...arguments),ry.add(this)}async unwrap(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._client.webhookSecret,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._client.webhookSecret,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300;if("undefined"===typeof crypto||"function"!==typeof crypto.subtle.importKey||"function"!==typeof crypto.subtle.verify)throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");eh(this,ry,"m",sy).call(this,n);const s=Sp([t]).values,i=eh(this,ry,"m",iy).call(this,s,"webhook-signature"),o=eh(this,ry,"m",iy).call(this,s,"webhook-timestamp"),a=eh(this,ry,"m",iy).call(this,s,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new wh("Invalid webhook timestamp format");const l=Math.floor(Date.now()/1e3);if(l-c>r)throw new wh("Webhook timestamp is too old");if(c>l+r)throw new wh("Webhook timestamp is too new");const u=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),d=a?"".concat(a,".").concat(o,".").concat(e):"".concat(o,".").concat(e),f=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const g of u)try{const e=Buffer.from(g,"base64");if(await crypto.subtle.verify("HMAC",f,e,(new TextEncoder).encode(d)))return}catch(p){continue}throw new wh("The given webhook signature does not match the expected signature")}}ry=new WeakSet,sy=function(e){if("string"!==typeof e||0===e.length)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},iy=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(null===n||void 0===n)throw new Error("Missing required header: ".concat(t));return n};const uy=["baseURL","apiKey","organization","project","webhookSecret"],hy=["signal","method"];var dy,fy,py,gy;class my{constructor(){var e,t,n,s,i,o,a,l,u;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{baseURL:d=sg("OPENAI_BASE_URL"),apiKey:f=sg("OPENAI_API_KEY"),organization:p=(null!==(e=sg("OPENAI_ORG_ID"))&&void 0!==e?e:null),project:g=(null!==(t=sg("OPENAI_PROJECT_ID"))&&void 0!==t?t:null),webhookSecret:m=(null!==(n=sg("OPENAI_WEBHOOK_SECRET"))&&void 0!==n?n:null)}=h,v=r(h,uy);if(dy.add(this),py.set(this,void 0),this.completions=new tm(this),this.chat=new bp(this),this.embeddings=new dm(this),this.files=new ov(this),this.images=new vv(this),this.audio=new Cp(this),this.moderations=new wv(this),this.models=new yv(this),this.fineTuning=new pv(this),this.graders=new mv(this),this.vectorStores=new ay(this),this.webhooks=new ly(this),this.beta=new em(this),this.batches=new Vp(this),this.uploads=new Lv(this),this.responses=new xv(this),this.realtime=new Ev(this),this.conversations=new hm(this),this.evals=new iv(this),this.containers=new sm(this),this.videos=new cy(this),void 0===f)throw new sh("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const y=c(c({apiKey:f,organization:p,project:g,webhookSecret:m},v),{},{baseURL:d||"https://api.openai.com/v1"});if(!y.dangerouslyAllowBrowser&&"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof navigator)throw new sh("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=y.baseURL,this.timeout=null!==(s=y.timeout)&&void 0!==s?s:fy.DEFAULT_TIMEOUT,this.logger=null!==(i=y.logger)&&void 0!==i?i:console;const w="warn";this.logLevel=w,this.logLevel=null!==(o=null!==(a=dd(y.logLevel,"ClientOptions.logLevel",this))&&void 0!==a?a:dd(sg("OPENAI_LOG"),"process.env['OPENAI_LOG']",this))&&void 0!==o?o:w,this.fetchOptions=y.fetchOptions,this.maxRetries=null!==(l=y.maxRetries)&&void 0!==l?l:2,this.fetch=null!==(u=y.fetch)&&void 0!==u?u:function(){if("undefined"!==typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),Zu(this,py,Dh,"f"),this._options=y,this.apiKey="string"===typeof f?f:"Missing Key",this.organization=p,this.project=g,this.webhookSecret=m}withOptions(e){return new this.constructor(c(c({},this._options),{},{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret},e))}defaultQuery(){return this._options.defaultQuery}validateHeaders(e){let{values:t,nulls:n}=e}async authHeaders(e){return Sp([{Authorization:"Bearer ".concat(this.apiKey)}])}stringifyQuery(e){return Jh(e,{arrayFormat:"brackets"})}getUserAgent(){return"".concat(this.constructor.name,"/JS ").concat(Ah)}defaultIdempotencyKey(){return"stainless-node-retry-".concat(th())}makeStatusError(e,t,n,r){return ih.generate(e,t,n,r)}async _callApiKey(){const e=this._options.apiKey;if("function"!==typeof e)return!1;let t;try{t=await e()}catch(n){if(n instanceof sh)throw n;throw new sh("Failed to get token from 'apiKey' function: ".concat(n.message),{cause:n})}if("string"!==typeof t||!t)throw new sh("Expected 'apiKey' function argument to return a string but it returned ".concat(t));return this.apiKey=t,!0}buildURL(e,t,n){const r=!eh(this,dy,"m",gy).call(this)&&n||this.baseURL,s=(e=>_h.test(e))(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(i)||(t=c(c({},i),t)),"object"===typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,t){let{url:n,options:r}=t}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(n=>c({method:e,path:t},n)))}request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Cd(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var r,s;const i=await e,o=null!==(r=i.maxRetries)&&void 0!==r?r:this.maxRetries;null==t&&(t=o),await this.prepareOptions(i);const{req:a,url:c,timeout:l}=await this.buildRequest(i,{retryCount:o-t});await this.prepareRequest(a,{url:c,options:i});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),h=void 0===n?"":", retryOf: ".concat(n),d=Date.now();if(vd(this).debug("[".concat(u,"] sending request"),yd({retryOfRequestLogID:n,method:i.method,url:c,options:i,headers:a.headers})),null!==(s=i.signal)&&void 0!==s&&s.aborted)throw new oh;const f=new AbortController,p=await this.fetchWithTimeout(c,a,l,f).catch(rh),g=Date.now();if(p instanceof globalThis.Error){var m;const e="retrying, ".concat(t," attempts remaining");if(null!==(m=i.signal)&&void 0!==m&&m.aborted)throw new oh;const r=nh(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return vd(this).info("[".concat(u,"] connection ").concat(r?"timed out":"failed"," - ").concat(e)),vd(this).debug("[".concat(u,"] connection ").concat(r?"timed out":"failed"," (").concat(e,")"),yd({retryOfRequestLogID:n,url:c,durationMs:g-d,message:p.message})),this.retryRequest(i,t,null!==n&&void 0!==n?n:u);if(vd(this).info("[".concat(u,"] connection ").concat(r?"timed out":"failed"," - error; no more retries left")),vd(this).debug("[".concat(u,"] connection ").concat(r?"timed out":"failed"," (error; no more retries left)"),yd({retryOfRequestLogID:n,url:c,durationMs:g-d,message:p.message})),r)throw new ch;throw new ah({cause:p})}const v=[...p.headers.entries()].filter(e=>{let[t]=e;return"x-request-id"===t}).map(e=>{let[t,n]=e;return", "+t+": "+JSON.stringify(n)}).join(""),y="[".concat(u).concat(h).concat(v,"] ").concat(a.method," ").concat(c," ").concat(p.ok?"succeeded":"failed"," with status ").concat(p.status," in ").concat(g-d,"ms");if(!p.ok){const e=await this.shouldRetry(p);if(t&&e){const e="retrying, ".concat(t," attempts remaining");return await async function(e){if(null===e||"object"!==typeof e)return;var t,n;if(e[Symbol.asyncIterator])return void await(null===(t=(n=e[Symbol.asyncIterator]()).return)||void 0===t?void 0:t.call(n));const r=e.getReader(),s=r.cancel();r.releaseLock(),await s}(p.body),vd(this).info("".concat(y," - ").concat(e)),vd(this).debug("[".concat(u,"] response error (").concat(e,")"),yd({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,durationMs:g-d})),this.retryRequest(i,t,null!==n&&void 0!==n?n:u,p.headers)}const r=e?"error; no more retries left":"error; not retryable";vd(this).info("".concat(y," - ").concat(r));const s=await p.text().catch(e=>rh(e).message),o=(e=>{try{return JSON.parse(e)}catch(t){return}})(s),a=o?void 0:s;vd(this).debug("[".concat(u,"] response error (").concat(r,")"),yd({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,message:a,durationMs:Date.now()-d}));throw this.makeStatusError(p.status,o,a,p.headers)}return vd(this).info(y),vd(this).debug("[".concat(u,"] response start"),yd({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,durationMs:g-d})),{response:p,options:i,controller:f,requestLogID:u,retryOfRequestLogID:n,startTime:d}}getAPIList(e,t,n){return this.requestAPIList(t,c({method:"get",path:e},n))}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Od(this,n,e)}async fetchWithTimeout(e,t,n,s){const i=t||{},{signal:o,method:a}=i,l=r(i,hy);o&&o.addEventListener("abort",()=>s.abort());const u=setTimeout(()=>s.abort(),n),h=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||"object"===typeof l.body&&null!==l.body&&Symbol.asyncIterator in l.body,d=c(c({signal:s.signal},h?{duplex:"half"}:{}),{},{method:"GET"},l);a&&(d.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(u)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n,r){let s;const i=null===r||void 0===r?void 0:r.get("retry-after-ms");if(i){const e=parseFloat(i);Number.isNaN(e)||(s=e)}const o=null===r||void 0===r?void 0:r.get("retry-after");if(o&&!s){const e=parseFloat(o);s=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(s&&0<=s&&s<6e4)){var a;const n=null!==(a=e.maxRetries)&&void 0!==a?a:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,n)}return await Th(s),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}async buildRequest(e){var t,n,r;let{retryCount:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=c({},e),{method:o,path:a,query:l,defaultBaseURL:u}=i,h=this.buildURL(a,l,u);"timeout"in i&&((e,t)=>{if("number"!==typeof t||!Number.isInteger(t))throw new sh("".concat(e," must be an integer"));if(t<0)throw new sh("".concat(e," must be a positive integer"))})("timeout",i.timeout),i.timeout=null!==(t=i.timeout)&&void 0!==t?t:this.timeout;const{bodyHeaders:d,body:f}=this.buildBody({options:i});return{req:c(c(c(c(c({method:o,headers:await this.buildHeaders({options:e,method:o,bodyHeaders:d,retryCount:s})},i.signal&&{signal:i.signal}),globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"}),f&&{body:f}),null!==(n=this.fetchOptions)&&void 0!==n?n:{}),null!==(r=i.fetchOptions)&&void 0!==r?r:{}),url:h,timeout:i.timeout}}async buildHeaders(e){let{options:t,method:n,bodyHeaders:r,retryCount:s}=e,i={};this.idempotencyHeader&&"get"!==n&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=t.idempotencyKey);const o=Sp([i,c(c(c({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{}),null!==Oh&&void 0!==Oh?Oh:Oh=kh()),{},{"OpenAI-Organization":this.organization,"OpenAI-Project":this.project}),await this.authHeaders(t),this._options.defaultHeaders,r,t.headers]);return this.validateHeaders(o),o.values}buildBody(e){let{options:{body:t,headers:n}}=e;if(!t)return{bodyHeaders:void 0,body:void 0};const r=Sp([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||"string"===typeof t&&r.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:"object"===typeof t&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&"function"===typeof t.next)?{bodyHeaders:void 0,body:Ph(t)}:eh(this,py,"f").call(this,{body:t,headers:r})}}fy=my,py=new WeakMap,dy=new WeakSet,gy=function(){return"https://api.openai.com/v1"!==this.baseURL},my.OpenAI=fy,my.DEFAULT_TIMEOUT=6e5,my.OpenAIError=sh,my.APIError=ih,my.APIConnectionError=ah,my.APIConnectionTimeoutError=ch,my.APIUserAbortError=oh,my.NotFoundError=dh,my.ConflictError=fh,my.RateLimitError=gh,my.BadRequestError=lh,my.AuthenticationError=uh,my.InternalServerError=mh,my.PermissionDeniedError=hh,my.UnprocessableEntityError=ph,my.InvalidWebhookSignatureError=wh,my.toFile=async function(e,t,n){var r;if(Dd(),(e=>null!=e&&"object"===typeof e&&"string"===typeof e.name&&"number"===typeof e.lastModified&&Kd(e))(e=await e))return e instanceof File?e:Ld([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"===typeof e&&"string"===typeof e.url&&"function"===typeof e.blob)(e)){const r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),Ld(await zd(r),t,n)}const s=await zd(e);if(t||(t=Md(e)),null===(r=n)||void 0===r||!r.type){const e=s.find(e=>"object"===typeof e&&"type"in e&&e.type);"string"===typeof e&&(n=c(c({},n),{},{type:e}))}return Ld(s,t,n)},my.Completions=tm,my.Chat=bp,my.Embeddings=dm,my.Files=ov,my.Images=vv,my.Audio=Cp,my.Moderations=wv,my.Models=yv,my.FineTuning=pv,my.Graders=mv,my.VectorStores=ay,my.Webhooks=ly,my.Beta=em,my.Batches=Vp,my.Uploads=Lv,my.Responses=xv,my.Realtime=Ev,my.Conversations=hm,my.Evals=iv,my.Containers=sm,my.Videos=cy;new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"]),new my({apiKey:"YOUR_OPENAI_API_KEY",dangerouslyAllowBrowser:!0})})();
//# sourceMappingURL=main.b4d4d033.js.map